---
title: "Power analysis Helmut's Nature Ecol Evol paper"
author: "Yefeng"
date: "2020/9/21"
output: html_document
subtitle: "check for Shinichi"
---


## Setup

```{r setup, echo = FALSE}
# Tidy
 # rm(list=ls())
 # graphics.off()

# Preparing workspace
knitr::opts_chunk$set(echo = TRUE, include = TRUE)

# Loading packages
pacman::p_load(knitr, # knit markdown
               readxl, 
               readr, 
               metafor, 
               dplyr, 
               tidyverse, 
               janitor, # generate 1-, 2-way table
               patchwork, # layout of plots
               cowplot, 
               ggpubr,
               gridExtra,
               #orchaRd, # forest-like plot
               gridGraphics, # Redraw Base Graphics Using 'grid' Graphics. `gridGraphics` is required to handle base-R plots.
               dabestr,
               here,
               retrodesign
               )

#library(dabestr)

#library(here)

# install.packages("D:/Program Files (x86)/R packages source/retrodesign_0.1.0.zip", repos = NULL, type="source") 



#simulated_plot <- retrodesign::sim_plot(0.5,1)

#png(filename = "./Figures/simulated_plot.png", width = 8, height = 8, units = "in", type = "windows", res = 400)
#simulated_plot
#dev.off()

# Function to calculate power (two-tail) for meta-analysis
power.ma_Shinichi <- function(mu, SE, alpha = 0.05) {
  2-pnorm(qnorm(1-alpha/2)-abs(mu)/SE)-pnorm(qnorm(1-alpha/2)+abs(mu)/SE)
  } # or power.ma_Shinichi1 <- function(mu,SE){1 - pnorm(qnorm(1-0.05/2)-abs(mu)/SE) + pnorm(-qnorm(1-0.05/2)-abs(mu)/SE)}



# Function for power analysis for empirical data point
power.individual_Shinichi <- function(mu, se, alpha = 0.05) {
  2-pnorm(qnorm(1-alpha/2)-abs(mu)/se)-pnorm(qnorm(1-alpha/2)+abs(mu)/se)} # two-tailed power


# Function for Type S error for empirical data point

error_S <- function(mu, se, alpha = 0.05){
  #z <- qnorm(1 - alpha/2) # Z-score or quantile
  p.u <- 1 - pnorm(qnorm(1 - alpha/2) - abs(mu)/se) # upper-tail probability
  p.l <- pnorm(-qnorm(1 - alpha/2) - abs(mu)/se) # lower-tail probability
  power <- p.u + p.l # upper + lower
  errorS <- p.l/power # percentage of the opposite direction
  return(errorS)
} 




mapply(type_s.numeric, effect.R_RR[[1]], sqrt(dat_list[[1]]$var.LRR)) %>% unlist %>% data.frame() %>% head()

# We also can use t-distribution to estimate error
# type.S <- function(mu, se, alpha = 0.05){
#  z <- qt(1 - alpha/2, df=Inf) # Z-score or quantile
#  p.u <- 1 - pt(z - abs(mu)/se, df=Inf) # upper-tail probability
#  p.l <- pt(-z - abs(mu)/se, df=Inf) # lower-tail probability
#  power <- p.u + p.l # upper + lower
#  typeS <- p.l/power # percentage of the opposite direction
#  return(data.frame(power=power,
#                    type_S=typeS))}


# Function for Type M error for empirical data point
error_M <- function(mu, se, alpha = 0.05, N = 10000) {
    est.random <- rnorm(n=N, mean = mu, sd = se)
    # est.random <- mu + se*rnorm(n=N, mean=0, sd=1)
    sig.index <- abs(est.random) > se*qnorm(1 - alpha/2)
    overestimate <- mean(abs(est.random)[sig.index])/abs(mu) # ratio is regardnesss of sign, so we need absolute value
    absolute_error <- overestimate*abs(mu) - abs(mu)
    relative_error <- absolute_error/(overestimate*abs(mu))
  return(abs(overestimate) %>% round(3))
}


error_M2 <- function(mu, se, alpha = 0.05, N = 10000) {
    est.random <- rnorm(n=N, mean = mu, sd = se)
    # est.random <- mu + se*rnorm(n=N, mean=0, sd=1)
    sig.index <- abs(est.random) > se*qnorm(1 - alpha/2)
    overestimate <- mean(abs(est.random)[sig.index])/abs(mu) # ratio is regardnesss of sign, so we need absolute value
    absolute_error <- overestimate*abs(mu) - abs(mu)
    relative_error <- absolute_error/(overestimate*abs(mu))
  return(abs(relative_error) %>% round(3))
}




mapply(type.M, effect.R_RR[[5]], sqrt(dat_list[[5]]$var.LRR))



mapply(type.M, model_est_RR$mu_RR, model_est_RR$SE_RR) -> m.power

    absolute_error <- m.power*abs(model_est_RR$mu_RR) - abs(model_est_RR$mu_RR)
    relative_error <- absolute_error/(m.power*abs(model_est_RR$mu_RR))

```



<!-- **Contents** -->
<!-- We have three sections.  -->

<!-- Section 1: power analysis for 36 lnRR meta-analyses and corresponding  power analysis for individual data point within each meta-analysis -->

<!-- Section 2: power analysis for 12 lnCVR and lnVR meta-analyses and corresponding  power analysis for individual data point within each meta-analysis -->

<!-- Section3: using three three weighting schemes (i.e. WAAP, PET-PEESE, http://environmentalcomputing.net/meta-analysis/) to evaluate publication bias -->




### 1. Power lnRR
Assuming different true effects based on meta-analytic estimate, we calculate two-tailed power for 30 lnRR meta-analytic cases and effect size included in each meta-analysis.

I temporarily kept it: In addition, we also calculate power using four hypothetical true effects (i.e. 1 - 100% mean differences) - 

#### 1.1 MA power calculation

```{r}
Note: I have already saved this section as Rdata, you can run it in your computer or just load(here("data","model_est_RR.RData")) after your check

#***************************************************************#
#                  meta-analysis level power                    #
#***************************************************************#
# TODO - you can do this in one line - consdier using this function list.files() - by using this you can get all the names of files without typing in and loop or spply it through

# my try - list.files(path = "./36_lnRR_data")

#dat_m1_1 <- read.csv(here("data/36_lnRR_data", "m1_1.csv"), header = TRUE)

# Importing data
dat_m1_1 <- read.csv(file = "./36_lnRR_data/m1_1.csv", header = TRUE)
dat_m1_2 <- read.csv(file = "./36_lnRR_data/m1_2.csv", header = TRUE)
dat_m2_1 <- read.csv(file = "./36_lnRR_data/m2_1.csv", header = TRUE)
dat_m2_2 <- read.csv(file = "./36_lnRR_data/m2_2.csv", header = TRUE)
dat_m3_1 <- read.csv(file = "./36_lnRR_data/m3_1.csv", header = TRUE)
dat_m4_1 <- read.csv(file = "./36_lnRR_data/m4_1.csv", header = TRUE)
dat_m5_1 <- read.csv(file = "./36_lnRR_data/m5_1.csv", header = TRUE)
dat_m6_1 <- read.csv(file = "./36_lnRR_data/m6_1.csv", header = TRUE)
dat_m6_2 <- read.csv(file = "./36_lnRR_data/m6_2.csv", header = TRUE)
dat_m6_3 <- read.csv(file = "./36_lnRR_data/m6_3.csv", header = TRUE)
dat_m6_4 <- read.csv(file = "./36_lnRR_data/m6_4.csv", header = TRUE)
dat_m6_5 <- read.csv(file = "./36_lnRR_data/m6_5.csv", header = TRUE)
dat_m7_1 <- read.csv(file = "./36_lnRR_data/m7_1.csv", header = TRUE)
dat_m7_2 <- read.csv(file = "./36_lnRR_data/m7_2.csv", header = TRUE)
dat_m8_1 <- read.csv(file = "./36_lnRR_data/m8_1.csv", header = TRUE)
dat_m9_1 <- read.csv(file = "./36_lnRR_data/m9_1.csv", header = TRUE)
dat_m10_1 <- read.csv(file = "./36_lnRR_data/m10_1.csv", header = TRUE)
dat_m11_1 <- read.csv(file = "./36_lnRR_data/m11_1.csv", header = TRUE)
dat_m12_1 <- read.csv(file = "./36_lnRR_data/m12_1.csv", header = TRUE)
dat_m13_1 <- read.csv(file = "./36_lnRR_data/m13_1.csv", header = TRUE)
dat_m13_2 <- read.csv(file = "./36_lnRR_data/m13_2.csv", header = TRUE)
dat_m14_1 <- read.csv(file = "./36_lnRR_data/m14_1.csv", header = TRUE)
dat_m14_2 <- read.csv(file = "./36_lnRR_data/m14_2.csv", header = TRUE)
dat_m14_3 <- read.csv(file = "./36_lnRR_data/m14_3.csv", header = TRUE)
dat_m15_1 <- read.csv(file = "./36_lnRR_data/m15_1.csv", header = TRUE)
dat_m16_1 <- read.csv(file = "./36_lnRR_data/m16_1.csv", header = TRUE)
dat_m16_2 <- read.csv(file = "./36_lnRR_data/m16_2.csv", header = TRUE)
dat_m20_1 <- read.csv(file = "./36_lnRR_data/m20_1.csv", header = TRUE)
dat_m23_1 <- read.csv(file = "./36_lnRR_data/m23_1.csv", header = TRUE)
dat_m24_1 <- read.csv(file = "./36_lnRR_data/m24_1.csv", header = TRUE) #sep=";"



##Warning: There are some mising values of effect size corresponding variance (i.e. var.LRR) in the following data set: dat_m17_1, dat_m17_2, dat_m18_1, dat_m19_1, dat_m21_1, dat_m22_1. These datasets can not be used to calculate power. Therefore, we deleted these six datasets. Finally, we have 36-6=30 datasets.


#***************************************************************#
#                    power for meta-analytic cases              #
#***************************************************************#

# make a list of data
dat_list <- list(dat_m1_1,
                 dat_m1_2,
                 dat_m2_1,
                 dat_m2_2,
                 dat_m3_1,
                 dat_m4_1,
                 dat_m5_1,
                 dat_m6_1,
                 dat_m6_2,
                 dat_m6_3,
                 dat_m6_4,
                 dat_m6_5,
                 dat_m7_1,
                 dat_m7_2,
                 dat_m8_1,
                 dat_m9_1,
                 dat_m10_1,
                 dat_m11_1,
                 dat_m12_1,
                 dat_m13_1,
                 dat_m13_2,
                 dat_m14_1,
                 dat_m14_2,
                 dat_m14_3,
                 dat_m15_1,
                 dat_m16_1,
                 dat_m16_2,
                 dat_m20_1,
                 dat_m23_1,
                 dat_m24_1)


# prepare "ture" effect of mean (i.e. lnRR) for power analysis - fit multi-level meta-analytic models
model_list_RR <- list() # rep(NA, length(dat_list))
for (i in 1:length(dat_list)) {
 model_list_RR[i] <- rma.mv(data = dat_list[[i]], yi = LRR, V = var.LRR, random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

# calculate the number of total effect sizes - total sample size
ES_number <- NA
ES_number <- mapply(unique, sapply(dat_list, function(x) x$Unit_ID)) 
unlist(ES_number) %>% length() # 3850 this is to show how many global change experiments we use in our analysis 


# get the number of studies (N) and the number of effect sizes (k) from each meta-analysis
N_RR <- NA
N_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Study)))

k_RR <- NA
k_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Unit_ID)))


# As we assume meta-analytic mean as the ture effect, we need to get estimate (mu) and corresponding error (SE)
model_est_RR <- data.frame(MA_case=c("m1_1",
                                      "m1_2",
                                      "m2_1",
                                      "m2_2",
                                      "m3_1",
                                      "m4_1",
                                      "m5_1",
                                      "m6_1",
                                      "m6_2",
                                      "m6_3",
                                      "m6_4",
                                      "m6_5",
                                      "m7_1",
                                      "m7_2",
                                      "m8_1",
                                      "m9_1",
                                      "m10_1",
                                      "m11_1",
                                      "m12_1",
                                      "m13_1",
                                      "m13_2",
                                      "m14_1",
                                      "m14_2",
                                      "m14_3",
                                      "m15_1",
                                      "m16_1",
                                      "m16_2",
                                      "m20_1",
                                      "m23_1",
                                      "m24_1"),
                  mu_RR=sapply(model_list_RR, function(x) x$beta),
                  SE_RR=sapply(model_list_RR, function(x) x$se),
                  ll_NHST=sapply(model_list_RR, function(x) x$ci.lb),
                  ul_NHST=sapply(model_list_RR, function(x) x$ci.ub),
                  p_value=sapply(model_list_RR, function(x) x$pval))


#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_RR$MA.power <- power.ma_Shinichi(mu=model_est_RR$mu,SE=model_est_RR$SE)


#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_RR$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_RR$mu[i],se=model_est_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_RR$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_RR$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_RR$mu[i],se=model_est_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_RR$MA.power.M <- MA.power.M


#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#
MA.power.M2 <- NA
for (i in 1:length(model_est_RR$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_RR$mu[i],se=model_est_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_RR$MA.power.M2 <- MA.power.M2


# save
#write.csv(model_est_RR, file = "./meta-analysis power_RR.csv", row.names = FALSE)


# save(model_est_RR,file = here("data","model_est_RR.RData"))
load(here("data","model_est_RR.RData"))
```


#### 1.2 Individual power calculation

##### 1.2.1 Calculation
```{r}
Note: I also saved this section as Rdata in the data list load(here("data","dat_list.RData"))

#***************************************************************#
#                      individual level power                   #
#***************************************************************#

# We have three approaches for calculating empirical studies within meta-analysis: (i) using meta-analytic estimate (i.e. intercept or fixed effect) as true effect; (ii) using effect size specific effect as true effect (i.e. fixed plus random effect), which accomodate between-study heterogeneity; (iii) postulated (i.e. hypothetical) effect as true effect - 5%, 10%, 20%, 40% difference


#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_RR <- NA
for (i in 1:length(dat_list)) {
  power.F_RR[i] <- power.individual_Shinichi(mu=rep(model_list_RR[[i]]$beta, length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_RR)) {
  dat_list[[i]]$power.F_RR <- power.F_RR[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.S_RR[i] <- mapply(error_S, mu=rep(model_list_RR[[i]]$beta, length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_RR)) {
  dat_list[[i]]$power.F.S_RR <- power.F.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.M_RR[i] <- mapply(error_M, mu=rep(model_list_RR[[i]]$beta, length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_RR)) {
  dat_list[[i]]$power.F.M_RR <- power.F.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.M2_RR[i] <- mapply(error_M2, mu=rep(model_list_RR[[i]]$beta, length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_RR)) {
  dat_list[[i]]$power.F.M2_RR <- power.F.M2_RR[[i]]
}



#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_RR <- NA
for (i in 1:length(model_list_RR)) {
  blups.list_RR[i] <- ranef(model_list_RR[[i]]) %>% list()
}

# get study index - match two components random effect
index.list_RR <- NA # list()
for (i in 1:length(model_list_RR)) {
  index.list_RR[i] <- match(as.character(dat_list[[i]]$Study),rownames(blups.list_RR[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_RR <-NA
for (i in 1:length(model_list_RR)) {
  effect.R_RR[i] <- mapply(sum, model_list_RR[[i]]$beta, blups.list_RR[[i]]$Study[index.list_RR[[i]],1], blups.list_RR[[i]]$Unit_ID[,1]) %>% list()
}

#--------------------- (1) two tailed power ---------------------#
power.R_RR <- NA
for (i in 1:length(dat_list)) {
  power.R_RR[i] <- power.individual_Shinichi(mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR)) %>% list()}

# plot(power_RR[[1]]-power_RR2[[1]]) - check discrepancy
# allocate each set of power into corresponding dataset
for (i in 1:length(power.R_RR)) {
  dat_list[[i]]$power.R_RR <- power.R_RR[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect, which does not account for random effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.S_RR[i] <- mapply(error_S, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.S_RR)) {
  dat_list[[i]]$power.R.S_RR <- power.R.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.M_RR[i] <- mapply(error_M, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.M_RR)) {
  dat_list[[i]]$power.R.M_RR <- power.R.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.M2_RR[i] <- mapply(error_M2, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.M2_RR)) {
  dat_list[[i]]$power.R.M2_RR <- power.R.M2_RR[[i]]
}





#####################################################################
I kept the hypothetical effect currently, in case we need it in future. Just neglect it when checking
#####################################################################

#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d1_power_RR <- NA
for (i in 1:length(dat_list)) {
  d1_power_RR[i] <- power.individual_Shinichi(mu=rep(log(101/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power_RR)) {
  dat_list[[i]]$d1_power_RR <- d1_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d1_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d1_power.S_RR[i] <- mapply(error_S, mu=rep(log(101/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.01) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.S_RR)) {
  dat_list[[i]]$d1_power.S_RR <- d1_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d1_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d1_power.M_RR[i] <- mapply(error_M, mu=rep(log(101/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.01) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M_RR)) {
  dat_list[[i]]$d1_power.M_RR <- d1_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d1_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d1_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(101/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.01) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M2_RR)) {
  dat_list[[i]]$d1_power.M2_RR <- d1_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d5_power_RR <- NA
for (i in 1:length(dat_list)) {
  d5_power_RR[i] <- power.individual_Shinichi(mu=rep(log(105/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power_RR)) {
  dat_list[[i]]$d5_power_RR <- d5_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d5_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d5_power.S_RR[i] <- mapply(error_S, mu=rep(log(105/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.S_RR)) {
  dat_list[[i]]$d5_power.S_RR <- d5_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d5_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d5_power.M_RR[i] <- mapply(error_M, mu=rep(log(105/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M_RR)) {
  dat_list[[i]]$d5_power.M_RR <- d5_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d5_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d5_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(105/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M2_RR)) {
  dat_list[[i]]$d5_power.M2_RR <- d5_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 10% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d10_power_RR <- NA
for (i in 1:length(dat_list)) {
  d10_power_RR[i] <- power.individual_Shinichi(mu=rep(log(110/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power_RR)) {
  dat_list[[i]]$d10_power_RR <- d10_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d10_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d10_power.S_RR[i] <- mapply(error_S, mu=rep(log(110/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.S_RR)) {
  dat_list[[i]]$d10_power.S_RR <- d10_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d10_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d10_power.M_RR[i] <- mapply(error_M, mu=rep(log(110/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M_RR)) {
  dat_list[[i]]$d10_power.M_RR <- d10_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d10_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d10_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(110/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M2_RR)) {
  dat_list[[i]]$d10_power.M2_RR <- d10_power.M2_RR[[i]]
}


#*****************************************************************#
#********************** 20% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d20_power_RR <- NA
for (i in 1:length(dat_list)) {
  d20_power_RR[i] <- power.individual_Shinichi(mu=rep(log(120/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power_RR)) {
  dat_list[[i]]$d20_power_RR <- d20_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d20_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d20_power.S_RR[i] <- mapply(error_S, mu=rep(log(120/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.S_RR)) {
  dat_list[[i]]$d20_power.S_RR <- d20_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d20_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d20_power.M_RR[i] <- mapply(error_M, mu=rep(log(120/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M_RR)) {
  dat_list[[i]]$d20_power.M_RR <- d20_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d20_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d20_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(120/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M2_RR)) {
  dat_list[[i]]$d20_power.M2_RR <- d20_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 30% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d30_power_RR <- NA
for (i in 1:length(dat_list)) {
  d30_power_RR[i] <- power.individual_Shinichi(mu=rep(log(130/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power_RR)) {
  dat_list[[i]]$d30_power_RR <- d30_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d30_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d30_power.S_RR[i] <- mapply(error_S, mu=rep(log(130/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.S_RR)) {
  dat_list[[i]]$d30_power.S_RR <- d30_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d30_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d30_power.M_RR[i] <- mapply(error_M, mu=rep(log(130/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M_RR)) {
  dat_list[[i]]$d30_power.M_RR <- d30_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d30_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d30_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(130/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M2_RR)) {
  dat_list[[i]]$d30_power.M2_RR <- d30_power.M2_RR[[i]]
}


#*****************************************************************#
#********************** 40% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d40_power_RR <- NA
for (i in 1:length(dat_list)) {
  d40_power_RR[i] <- power.individual_Shinichi(mu=rep(log(140/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power_RR)) {
  dat_list[[i]]$d40_power_RR <- d40_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d40_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d40_power.S_RR[i] <- mapply(error_S, mu=rep(log(140/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.S_RR)) {
  dat_list[[i]]$d40_power.S_RR <- d40_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d40_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d40_power.M_RR[i] <- mapply(error_M, mu=rep(log(140/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M_RR)) {
  dat_list[[i]]$d40_power.M_RR <- d40_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d40_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d40_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(140/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M2_RR)) {
  dat_list[[i]]$d40_power.M2_RR <- d40_power.M2_RR[[i]]
}


#*****************************************************************#
#********************** 50% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d50_power_RR <- NA
for (i in 1:length(dat_list)) {
  d50_power_RR[i] <- power.individual_Shinichi(mu=rep(log(150/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power_RR)) {
  dat_list[[i]]$d50_power_RR <- d50_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d50_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d50_power.S_RR[i] <- mapply(error_S, mu=rep(log(150/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.S_RR)) {
  dat_list[[i]]$d50_power.S_RR <- d50_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d50_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d50_power.M_RR[i] <- mapply(error_M, mu=rep(log(150/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M_RR)) {
  dat_list[[i]]$d50_power.M_RR <- d50_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d50_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d50_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(150/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M2_RR)) {
  dat_list[[i]]$d50_power.M2_RR <- d50_power.M2_RR[[i]]
}


#*****************************************************************#
#********************** 60% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d60_power_RR <- NA
for (i in 1:length(dat_list)) {
  d60_power_RR[i] <- power.individual_Shinichi(mu=rep(log(160/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power_RR)) {
  dat_list[[i]]$d60_power_RR <- d60_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d60_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d60_power.S_RR[i] <- mapply(error_S, mu=rep(log(160/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.S_RR)) {
  dat_list[[i]]$d60_power.S_RR <- d60_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d60_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d60_power.M_RR[i] <- mapply(error_M, mu=rep(log(160/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M_RR)) {
  dat_list[[i]]$d60_power.M_RR <- d60_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d60_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d60_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(160/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M2_RR)) {
  dat_list[[i]]$d60_power.M2_RR <- d60_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 70% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d70_power_RR <- NA
for (i in 1:length(dat_list)) {
  d70_power_RR[i] <- power.individual_Shinichi(mu=rep(log(170/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power_RR)) {
  dat_list[[i]]$d70_power_RR <- d70_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d70_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d70_power.S_RR[i] <- mapply(error_S, mu=rep(log(170/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.S_RR)) {
  dat_list[[i]]$d70_power.S_RR <- d70_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d70_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d70_power.M_RR[i] <- mapply(error_M, mu=rep(log(170/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M_RR)) {
  dat_list[[i]]$d70_power.M_RR <- d70_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d70_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d70_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(170/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M2_RR)) {
  dat_list[[i]]$d70_power.M2_RR <- d70_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 80% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d80_power_RR <- NA
for (i in 1:length(dat_list)) {
  d80_power_RR[i] <- power.individual_Shinichi(mu=rep(log(180/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power_RR)) {
  dat_list[[i]]$d80_power_RR <- d80_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d80_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d80_power.S_RR[i] <- mapply(error_S, mu=rep(log(180/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.S_RR)) {
  dat_list[[i]]$d80_power.S_RR <- d80_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d80_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d80_power.M_RR[i] <- mapply(error_M, mu=rep(log(180/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M_RR)) {
  dat_list[[i]]$d80_power.M_RR <- d80_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d80_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d80_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(180/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M2_RR)) {
  dat_list[[i]]$d80_power.M2_RR <- d80_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 90% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d90_power_RR <- NA
for (i in 1:length(dat_list)) {
  d90_power_RR[i] <- power.individual_Shinichi(mu=rep(log(190/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power_RR)) {
  dat_list[[i]]$d90_power_RR <- d90_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d90_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d90_power.S_RR[i] <- mapply(error_S, mu=rep(log(190/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.S_RR)) {
  dat_list[[i]]$d90_power.S_RR <- d90_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d90_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d90_power.M_RR[i] <- mapply(error_M, mu=rep(log(190/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M_RR)) {
  dat_list[[i]]$d90_power.M_RR <- d90_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d90_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d90_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(190/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M2_RR)) {
  dat_list[[i]]$d90_power.M2_RR <- d90_power.M2_RR[[i]]
}



#*****************************************************************#
#********************** 100% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d100_power_RR <- NA
for (i in 1:length(dat_list)) {
  d100_power_RR[i] <- power.individual_Shinichi(mu=rep(log(200/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()
  }

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power_RR)) {
  dat_list[[i]]$d100_power_RR <- d100_power_RR[[i]]
}

#---------------------- (2) type S error -----------------------#
d100_power.S_RR <- NA
for (i in 1:length(dat_list)) {
  d100_power.S_RR[i] <- mapply(error_S, mu=rep(log(200/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.S_RR)) {
  dat_list[[i]]$d100_power.S_RR <- d100_power.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d100_power.M_RR <- NA
for (i in 1:length(dat_list)) {
  d100_power.M_RR[i] <- mapply(error_M, mu=rep(log(200/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M_RR)) {
  dat_list[[i]]$d100_power.M_RR <- d100_power.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
d100_power.M2_RR <- NA
for (i in 1:length(dat_list)) {
  d100_power.M2_RR[i] <- mapply(error_M2, mu=rep(log(200/100), length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M2_RR)) {
  dat_list[[i]]$d100_power.M2_RR <- d100_power.M2_RR[[i]]
}


#save(dat_list,file = here("data","dat_list.RData"))

load(here("data","dat_list.RData"))
```



##### 1.2.2 Mean of individual power

```{r}
Note: this section need to be ran in your computer

#*********************************************************************#
#----------- summary of empirical power for each approach ------------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.F_RR))[6,])  # early version, sapply(mapply(summary, sapply(dat_list, function(x) x$power_RR)), function(x) x[2])


#---------------------- (2) type S error -----------------------#
power.F.S_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.F.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.F.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.F.M2_RR))[6,])




#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.R_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.R.S_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.R.S_RR))[6,])



#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.R.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$power.R.M2_RR))[6,])



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#

#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d1_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d1_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d1_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d1_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d1_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d1_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d1_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d1_power.M2_RR))[6,])


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d5_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d5_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d5_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d5_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d5_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d5_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d5_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d5_power.M2_RR))[6,])



#*****************************************************************#
#********************** 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d10_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d10_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d10_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d10_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d10_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d10_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d10_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d10_power.M2_RR))[6,])



#*****************************************************************#
#********************** 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d20_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d20_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d20_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d20_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d20_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d20_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d20_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d20_power.M2_RR))[6,])



#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d30_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d30_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d30_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d30_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d30_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d30_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d30_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d30_power.M2_RR))[6,])



#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d40_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d40_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d40_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d40_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d40_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d40_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d40_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d40_power.M2_RR))[6,])



#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d50_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d50_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d50_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d50_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d50_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d50_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d50_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d50_power.M2_RR))[6,])




#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d60_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d60_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d60_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d60_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d60_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d60_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d60_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d60_power.M2_RR))[6,])



#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d70_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d70_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d70_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d70_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d70_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d70_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d70_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d70_power.M2_RR))[6,])




#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d80_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d80_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d80_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d80_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d80_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d80_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d80_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d80_power.M2_RR))[6,])




#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d90_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d90_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d90_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d90_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d90_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d90_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d90_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d90_power.M2_RR))[6,])



#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d100_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d100_power_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.S_summary_d100_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d100_power.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d100_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d100_power.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d100_RR <- data.frame(MA_case=model_est_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list, function(x) x$d100_power.M2_RR))[6,])
```


##### 1.2.3 SE of individual power

```{r}
Note: this section need to be ran in your computer

#*********************************************************************#
#--------- calculate standard error for each type of power -----------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_RR
se.F_mean <- NA
for (i in 1:length(dat_list)) {
  se.F_mean[i] <- sd(dat_list[[i]]$power.F_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.F_RR[!is.na(dat_list[[i]]$power.F_RR)]))
}

power.F_summary_RR$se.F_mean <- se.F_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_RR
se.F.S_mean <- NA
for (i in 1:length(dat_list)) {
  se.F.S_mean[i] <- sd(dat_list[[i]]$power.F.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.F.S_RR[!is.na(dat_list[[i]]$power.F.S_RR)]))
}

power.F.S_summary_RR$se.F.S_mean <- se.F.S_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_RR
se.F.M_mean <- NA
for (i in 1:length(dat_list)) {
  se.F.M_mean[i] <- sd(dat_list[[i]]$power.F.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.F.M_RR[!is.na(dat_list[[i]]$power.F.M_RR)]))
}

power.F.M_summary_RR$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(dat_list)) {
  se.F.M2_mean[i] <- sd(dat_list[[i]]$power.F.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.F.M2_RR[!is.na(dat_list[[i]]$power.F.M2_RR)]))
}

power.F.M2_summary_RR$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_RR
se.R_mean <- NA
for (i in 1:length(dat_list)) {
  se.R_mean[i] <- sd(dat_list[[i]]$power.R_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.R_RR[!is.na(dat_list[[i]]$power.R_RR)]))
}

power.R_summary_RR$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_RR
se.R.S_mean <- NA
for (i in 1:length(dat_list)) {
  se.R.S_mean[i] <- sd(dat_list[[i]]$power.R.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.R.S_RR[!is.na(dat_list[[i]]$power.R.S_RR)]))
}

power.R.S_summary_RR$se.R.S_mean <- se.R.S_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_RR
se.R.M_mean <- NA
for (i in 1:length(dat_list)) {
  se.R.M_mean[i] <- sd(dat_list[[i]]$power.R.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.R.M_RR[!is.na(dat_list[[i]]$power.R.M_RR)]))
}

power.R.M_summary_RR$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(dat_list)) {
  se.R.M2_mean[i] <- sd(dat_list[[i]]$power.R.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$power.R.M2_RR[!is.na(dat_list[[i]]$power.R.M2_RR)]))
}

power.R.M2_summary_RR$se.R.M2_mean <- se.R.M2_mean



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d1_power_RR
se.d1_mean <- NA
for (i in 1:length(dat_list)) {
  se.d1_mean[i] <- sd(dat_list[[i]]$d1_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d1_power_RR[!is.na(dat_list[[i]]$d1_power_RR)]))
}

power_summary_d1_RR$se.d1_mean <- se.d1_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d1_power.S_RR
se.d1_mean <- NA
for (i in 1:length(dat_list)) {
  se.d1_mean[i] <- sd(dat_list[[i]]$d1_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d1_power.S_RR[!is.na(dat_list[[i]]$d1_power.S_RR)]))
}

power.S_summary_d1_RR$se.d1_mean <- se.d1_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d1_power.M_RR
se.d1_mean <- NA
for (i in 1:length(dat_list)) {
  se.d1_mean[i] <- sd(dat_list[[i]]$d1_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d1_power.M_RR[!is.na(dat_list[[i]]$d1_power.M_RR)]))
}

power.M_summary_d1_RR$se.d1_mean <- se.d1_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d1_power.M2_RR
se.d1_mean <- NA
for (i in 1:length(dat_list)) {
  se.d1_mean[i] <- sd(dat_list[[i]]$d1_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d1_power.M2_RR[!is.na(dat_list[[i]]$d1_power.M2_RR)]))
}

power.M2_summary_d1_RR$se.d1_mean <- se.d1_mean


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d5_power_RR
se.d5_mean <- NA
for (i in 1:length(dat_list)) {
  se.d5_mean[i] <- sd(dat_list[[i]]$d5_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d5_power_RR[!is.na(dat_list[[i]]$d5_power_RR)]))
}

power_summary_d5_RR$se.d5_mean <- se.d5_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d5_power.S_RR
se.d5_mean <- NA
for (i in 1:length(dat_list)) {
  se.d5_mean[i] <- sd(dat_list[[i]]$d5_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d5_power.S_RR[!is.na(dat_list[[i]]$d5_power.S_RR)]))
}

power.S_summary_d5_RR$se.d5_mean <- se.d5_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d5_power.M_RR
se.d5_mean <- NA
for (i in 1:length(dat_list)) {
  se.d5_mean[i] <- sd(dat_list[[i]]$d5_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d5_power.M_RR[!is.na(dat_list[[i]]$d5_power.M_RR)]))
}

power.M_summary_d5_RR$se.d5_mean <- se.d5_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d5_power.M2_RR
se.d5_mean <- NA
for (i in 1:length(dat_list)) {
  se.d5_mean[i] <- sd(dat_list[[i]]$d5_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d5_power.M2_RR[!is.na(dat_list[[i]]$d5_power.M2_RR)]))
}

power.M2_summary_d5_RR$se.d5_mean <- se.d5_mean



#*****************************************************************#
#********************** 10% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d10_power_RR
se.d10_mean <- NA
for (i in 1:length(dat_list)) {
  se.d10_mean[i] <- sd(dat_list[[i]]$d10_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d10_power_RR[!is.na(dat_list[[i]]$d10_power_RR)]))
}

power_summary_d10_RR$se.d10_mean <- se.d10_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d10_power.S_RR
se.d10_mean <- NA
for (i in 1:length(dat_list)) {
  se.d10_mean[i] <- sd(dat_list[[i]]$d10_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d10_power.S_RR[!is.na(dat_list[[i]]$d10_power.S_RR)]))
}

power.S_summary_d10_RR$se.d10_mean <- se.d10_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d10_power.M_RR
se.d10_mean <- NA
for (i in 1:length(dat_list)) {
  se.d10_mean[i] <- sd(dat_list[[i]]$d10_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d10_power.M_RR[!is.na(dat_list[[i]]$d10_power.M_RR)]))
}

power.M_summary_d10_RR$se.d10_mean <- se.d10_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d10_power.M2_RR
se.d10_mean <- NA
for (i in 1:length(dat_list)) {
  se.d10_mean[i] <- sd(dat_list[[i]]$d10_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d10_power.M2_RR[!is.na(dat_list[[i]]$d10_power.M2_RR)]))
}

power.M2_summary_d10_RR$se.d10_mean <- se.d10_mean



#*****************************************************************#
#********************** 20% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d20_power_RR
se.d20_mean <- NA
for (i in 1:length(dat_list)) {
  se.d20_mean[i] <- sd(dat_list[[i]]$d20_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d20_power_RR[!is.na(dat_list[[i]]$d20_power_RR)]))
}

power_summary_d20_RR$se.d20_mean <- se.d20_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d20_power.S_RR
se.d20_mean <- NA
for (i in 1:length(dat_list)) {
  se.d20_mean[i] <- sd(dat_list[[i]]$d20_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d20_power.S_RR[!is.na(dat_list[[i]]$d20_power.S_RR)]))
}

power.S_summary_d20_RR$se.d20_mean <- se.d20_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d20_power.M_RR
se.d20_mean <- NA
for (i in 1:length(dat_list)) {
  se.d20_mean[i] <- sd(dat_list[[i]]$d20_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d20_power.M_RR[!is.na(dat_list[[i]]$d20_power.M_RR)]))
}

power.M_summary_d20_RR$se.d20_mean <- se.d20_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d20_power.M2_RR
se.d20_mean <- NA
for (i in 1:length(dat_list)) {
  se.d20_mean[i] <- sd(dat_list[[i]]$d20_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d20_power.M2_RR[!is.na(dat_list[[i]]$d20_power.M2_RR)]))
}

power.M2_summary_d20_RR$se.d20_mean <- se.d20_mean



#*****************************************************************#
#********************** 30% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d30_power_RR
se.d30_mean <- NA
for (i in 1:length(dat_list)) {
  se.d30_mean[i] <- sd(dat_list[[i]]$d30_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d30_power_RR[!is.na(dat_list[[i]]$d30_power_RR)]))
}

power_summary_d30_RR$se.d30_mean <- se.d30_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d30_power.S_RR
se.d30_mean <- NA
for (i in 1:length(dat_list)) {
  se.d30_mean[i] <- sd(dat_list[[i]]$d30_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d30_power.S_RR[!is.na(dat_list[[i]]$d30_power.S_RR)]))
}

power.S_summary_d30_RR$se.d30_mean <- se.d30_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d30_power.M_RR
se.d30_mean <- NA
for (i in 1:length(dat_list)) {
  se.d30_mean[i] <- sd(dat_list[[i]]$d30_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d30_power.M_RR[!is.na(dat_list[[i]]$d30_power.M_RR)]))
}

power.M_summary_d30_RR$se.d30_mean <- se.d30_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d30_power.M2_RR
se.d30_mean <- NA
for (i in 1:length(dat_list)) {
  se.d30_mean[i] <- sd(dat_list[[i]]$d30_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d30_power.M2_RR[!is.na(dat_list[[i]]$d30_power.M2_RR)]))
}

power.M2_summary_d30_RR$se.d30_mean <- se.d30_mean


#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d40_power_RR
se.d40_mean <- NA
for (i in 1:length(dat_list)) {
  se.d40_mean[i] <- sd(dat_list[[i]]$d40_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d40_power_RR[!is.na(dat_list[[i]]$d40_power_RR)]))
}

power_summary_d40_RR$se.d40_mean <- se.d40_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d40_power.S_RR
se.d40_mean <- NA
for (i in 1:length(dat_list)) {
  se.d40_mean[i] <- sd(dat_list[[i]]$d40_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d40_power.S_RR[!is.na(dat_list[[i]]$d40_power.S_RR)]))
}

power.S_summary_d40_RR$se.d40_mean <- se.d40_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d40_power.M_RR
se.d40_mean <- NA
for (i in 1:length(dat_list)) {
  se.d40_mean[i] <- sd(dat_list[[i]]$d40_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d40_power.M_RR[!is.na(dat_list[[i]]$d40_power.M_RR)]))
}

power.M_summary_d40_RR$se.d40_mean <- se.d40_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d40_power.M2_RR
se.d40_mean <- NA
for (i in 1:length(dat_list)) {
  se.d40_mean[i] <- sd(dat_list[[i]]$d40_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d40_power.M2_RR[!is.na(dat_list[[i]]$d40_power.M2_RR)]))
}

power.M2_summary_d40_RR$se.d40_mean <- se.d40_mean



#*****************************************************************#
#********************** 50% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d50_power_RR
se.d50_mean <- NA
for (i in 1:length(dat_list)) {
  se.d50_mean[i] <- sd(dat_list[[i]]$d50_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d50_power_RR[!is.na(dat_list[[i]]$d50_power_RR)]))
}

power_summary_d50_RR$se.d50_mean <- se.d50_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d50_power.S_RR
se.d50_mean <- NA
for (i in 1:length(dat_list)) {
  se.d50_mean[i] <- sd(dat_list[[i]]$d50_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d50_power.S_RR[!is.na(dat_list[[i]]$d50_power.S_RR)]))
}

power.S_summary_d50_RR$se.d50_mean <- se.d50_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d50_power.M_RR
se.d50_mean <- NA
for (i in 1:length(dat_list)) {
  se.d50_mean[i] <- sd(dat_list[[i]]$d50_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d50_power.M_RR[!is.na(dat_list[[i]]$d50_power.M_RR)]))
}

power.M_summary_d50_RR$se.d50_mean <- se.d50_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d50_power.M2_RR
se.d50_mean <- NA
for (i in 1:length(dat_list)) {
  se.d50_mean[i] <- sd(dat_list[[i]]$d50_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d50_power.M2_RR[!is.na(dat_list[[i]]$d50_power.M2_RR)]))
}

power.M2_summary_d50_RR$se.d50_mean <- se.d50_mean



#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d60_power_RR
se.d60_mean <- NA
for (i in 1:length(dat_list)) {
  se.d60_mean[i] <- sd(dat_list[[i]]$d60_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d60_power_RR[!is.na(dat_list[[i]]$d60_power_RR)]))
}

power_summary_d60_RR$se.d60_mean <- se.d60_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d60_power.S_RR
se.d60_mean <- NA
for (i in 1:length(dat_list)) {
  se.d60_mean[i] <- sd(dat_list[[i]]$d60_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d60_power.S_RR[!is.na(dat_list[[i]]$d60_power.S_RR)]))
}

power.S_summary_d60_RR$se.d60_mean <- se.d60_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d60_power.M_RR
se.d60_mean <- NA
for (i in 1:length(dat_list)) {
  se.d60_mean[i] <- sd(dat_list[[i]]$d60_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d60_power.M_RR[!is.na(dat_list[[i]]$d60_power.M_RR)]))
}

power.M_summary_d60_RR$se.d60_mean <- se.d60_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d60_power.M2_RR
se.d60_mean <- NA
for (i in 1:length(dat_list)) {
  se.d60_mean[i] <- sd(dat_list[[i]]$d60_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d60_power.M2_RR[!is.na(dat_list[[i]]$d60_power.M2_RR)]))
}

power.M2_summary_d60_RR$se.d60_mean <- se.d60_mean



#*****************************************************************#
#********************** 70% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d70_power_RR
se.d70_mean <- NA
for (i in 1:length(dat_list)) {
  se.d70_mean[i] <- sd(dat_list[[i]]$d70_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d70_power_RR[!is.na(dat_list[[i]]$d70_power_RR)]))
}

power_summary_d70_RR$se.d70_mean <- se.d70_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d70_power.S_RR
se.d70_mean <- NA
for (i in 1:length(dat_list)) {
  se.d70_mean[i] <- sd(dat_list[[i]]$d70_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d70_power.S_RR[!is.na(dat_list[[i]]$d70_power.S_RR)]))
}

power.S_summary_d70_RR$se.d70_mean <- se.d70_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d70_power.M_RR
se.d70_mean <- NA
for (i in 1:length(dat_list)) {
  se.d70_mean[i] <- sd(dat_list[[i]]$d70_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d70_power.M_RR[!is.na(dat_list[[i]]$d70_power.M_RR)]))
}

power.M_summary_d70_RR$se.d70_mean <- se.d70_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d70_power.M2_RR
se.d70_mean <- NA
for (i in 1:length(dat_list)) {
  se.d70_mean[i] <- sd(dat_list[[i]]$d70_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d70_power.M2_RR[!is.na(dat_list[[i]]$d70_power.M2_RR)]))
}

power.M2_summary_d70_RR$se.d70_mean <- se.d70_mean




#*****************************************************************#
#********************** 80% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d80_power_RR
se.d80_mean <- NA
for (i in 1:length(dat_list)) {
  se.d80_mean[i] <- sd(dat_list[[i]]$d80_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d80_power_RR[!is.na(dat_list[[i]]$d80_power_RR)]))
}

power_summary_d80_RR$se.d80_mean <- se.d80_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d80_power.S_RR
se.d80_mean <- NA
for (i in 1:length(dat_list)) {
  se.d80_mean[i] <- sd(dat_list[[i]]$d80_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d80_power.S_RR[!is.na(dat_list[[i]]$d80_power.S_RR)]))
}

power.S_summary_d80_RR$se.d80_mean <- se.d80_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d80_power.M_RR
se.d80_mean <- NA
for (i in 1:length(dat_list)) {
  se.d80_mean[i] <- sd(dat_list[[i]]$d80_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d80_power.M_RR[!is.na(dat_list[[i]]$d80_power.M_RR)]))
}

power.M_summary_d80_RR$se.d80_mean <- se.d80_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d80_power.M2_RR
se.d80_mean <- NA
for (i in 1:length(dat_list)) {
  se.d80_mean[i] <- sd(dat_list[[i]]$d80_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d80_power.M2_RR[!is.na(dat_list[[i]]$d80_power.M2_RR)]))
}

power.M2_summary_d80_RR$se.d80_mean <- se.d80_mean



#*****************************************************************#
#********************** 90% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d90_power_RR
se.d90_mean <- NA
for (i in 1:length(dat_list)) {
  se.d90_mean[i] <- sd(dat_list[[i]]$d90_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d90_power_RR[!is.na(dat_list[[i]]$d90_power_RR)]))
}

power_summary_d90_RR$se.d90_mean <- se.d90_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d90_power.S_RR
se.d90_mean <- NA
for (i in 1:length(dat_list)) {
  se.d90_mean[i] <- sd(dat_list[[i]]$d90_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d90_power.S_RR[!is.na(dat_list[[i]]$d90_power.S_RR)]))
}

power.S_summary_d90_RR$se.d90_mean <- se.d90_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d90_power.M_RR
se.d90_mean <- NA
for (i in 1:length(dat_list)) {
  se.d90_mean[i] <- sd(dat_list[[i]]$d90_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d90_power.M_RR[!is.na(dat_list[[i]]$d90_power.M_RR)]))
}

power.M_summary_d90_RR$se.d90_mean <- se.d90_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d90_power.M2_RR
se.d90_mean <- NA
for (i in 1:length(dat_list)) {
  se.d90_mean[i] <- sd(dat_list[[i]]$d90_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d90_power.M2_RR[!is.na(dat_list[[i]]$d90_power.M2_RR)]))
}

power.M2_summary_d90_RR$se.d90_mean <- se.d90_mean



#*****************************************************************#
#********************** 100% mean differences *********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d100_power_RR
se.d100_mean <- NA
for (i in 1:length(dat_list)) {
  se.d100_mean[i] <- sd(dat_list[[i]]$d100_power_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d100_power_RR[!is.na(dat_list[[i]]$d100_power_RR)]))
}

power_summary_d100_RR$se.d100_mean <- se.d100_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable d100_power.S_RR
se.d100_mean <- NA
for (i in 1:length(dat_list)) {
  se.d100_mean[i] <- sd(dat_list[[i]]$d100_power.S_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d100_power.S_RR[!is.na(dat_list[[i]]$d100_power.S_RR)]))
}

power.S_summary_d100_RR$se.d100_mean <- se.d100_mean

#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d100_power.M_RR
se.d100_mean <- NA
for (i in 1:length(dat_list)) {
  se.d100_mean[i] <- sd(dat_list[[i]]$d100_power.M_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d100_power.M_RR[!is.na(dat_list[[i]]$d100_power.M_RR)]))
}

power.M_summary_d100_RR$se.d100_mean <- se.d100_mean

#---------------- (4) type M error (relative error) --------------#
# standard error of variable d100_power.M2_RR
se.d100_mean <- NA
for (i in 1:length(dat_list)) {
  se.d100_mean[i] <- sd(dat_list[[i]]$d100_power.M2_RR, na.rm=TRUE) / sqrt(length(dat_list[[i]]$d100_power.M2_RR[!is.na(dat_list[[i]]$d100_power.M2_RR)]))
}

power.M2_summary_d100_RR$se.d100_mean <- se.d100_mean
```


### 1.3 Weighted regression

#### 1.3.1 MA power

```{r}
# Add k and N to the dataset
N_RR <- NA
N_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Study)))

k_RR <- NA
k_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Unit_ID)))

model_est_RR$k <- k_RR



# https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/confint

# rma(yi = Mean, sei = se.R_mean, test = “t”)) This will give you I2 etc - this may be good

#--------------------- (1) two tailed power ---------------------#
#MMA_MA_RR <- rma(data = model_est_RR, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")

MMA_MA_RR <- lm(MA.power~1, weights = k, data = model_est_RR) 
summary(MMA_MA_RR)

#---------------------- (2) type S error -----------------------#
#MMA_MA.S_RR <- rma(data = model_est_RR, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")

MMA_MA.S_RR <- lm(MA.power.S~1, weights = k, data = model_est_RR) 

summary(MMA_MA.S_RR)

#-------------- (3) type M error (overestimate ratio) -------------#
# MMA_MA.M_RR <- rma(data = model_est_RR, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")

MMA_MA.M_RR <- lm(MA.power.M~1, weights = k, data = model_est_RR) 

summary(MMA_MA.M_RR)

```


#### 1.3.2 Individual power
```{r}

#*********************************************************************#
#-------------------- meta-meta-analysis on power --------------------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

# add study ID
power.F_summary_RR$Study <- c(1,1,2,2,3,4,5,6,6,6,6,6,7,7,8,9,10,11,11,13,13,14,14,14,15,16,16,17,18,19)

# add N and k
N_RR <- NA
for (i in 1:length(dat_list)) {
  n_RR[i] <- dat_list[[i]]$Unit_ID %>% length()
}

k_RR <- NA
for (i in 1:length(dat_list)) {
  k_RR[i] <- dat_list[[i]]$Study %>% length()
}

power.F_summary_RR$N <- N_RR
power.F_summary_RR$k <- k_RR

# add labels for study type (experiment vs. observational)
approach_RR <- c("E","E","E","E","E","E","E","O","O","O","O","O","E","E","E","O","O","O","B","O","O","E","E","E","E","E","E","E","B","O")

# add labels for treatment
#treatment_RR <- c("Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pu","Pr","Pu","Pu","Pu","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr")

# add labels for stressor categories
stressor_RR <- c("BD_loss","BD_loss","Fert","Fert","Warm","Fert","Fert","LUC","LUC","LUC","LUC","LUC","Fert","Fert","Precip","LUC","Warm","Inv","Fire","Fire","Fire","Warm","Warm","Warm","BD_loss","BD_loss","BD_loss","Acid","Inv","Inv")

stressor_RR %>% as.data.frame() # check the correctness

moderator_RR <- cbind(approach_RR, treatment_RR, stressor_RR)
power.F_summary_RR <- cbind(power.F_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F_summary_RR$approach_RR <- factor(power.F_summary_RR$approach_RR, levels=c("O", "E", "B"))


# run rma model 
I guess you want to use add stressor as a new column for each data point within meta-analyses and use lmer to run the model - stressor as the fixed effect)

#--------------------- (1) two tailed power ---------------------#
MMA_power.F_RR.approach <- with(power.F_summary_RR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_RR.stressor <- with(power.F_summary_RR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F_RR <- with(power.F_summary_RR, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))

# MMA_power.F_RR2 <- with(power.F_summary_RR, rma.mv (yi = Mean, V = se.F_mean, random = list(~1|Study/MA_case), method = "REML", test = "t"))

# MMA_power.F_RR3 <- with(power.F_summary_RR, rma.MV(yi = Mean, v = se.F_mean, random = list(~1|Study, ~1|MA_case), method = "REML", test = "t"))


#---------------------- (2) type S error -----------------------#
power.F.S_summary_RR <- cbind(power.F.S_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_RR$approach_RR <- factor(power.F.S_summary_RR$approach_RR, levels=c("O", "E", "B"))


MMA_power.F.S_RR.approach <- with(power.F.S_summary_RR, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_RR.stressor <- with(power.F.S_summary_RR, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F.S_RR <- with(power.F.S_summary_RR, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))



#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_RR <- cbind(power.F.M_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_RR$approach_RR <- factor(power.F.M_summary_RR$approach_RR, levels=c("O", "E", "B"))

MMA_power.F.M_RR.approach <- with(power.F.M_summary_RR, rma(yi = Mean, sei = se.F.M_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_RR.stressor <- with(power.F.M_summary_RR, rma(yi = Mean, sei = se.F.M_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F.M_RR <- with(power.F.M_summary_RR, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t")) 

MMA_power.F.M2_RR <- with(power.F.M2_summary_RR, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))



#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#


#--------------------- (1) two tailed power ---------------------#
power.R_summary_RR <- cbind(power.R_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R_summary_RR$approach_RR <- factor(power.R_summary_RR$approach_RR, levels=c("O", "E", "B"))

MMA_power.R_RR.approach <- with(power.R_summary_RR, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R_RR.stressor <- with(power.R_summary_RR, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 


MMA_power.R_RR <- with(power.R_summary_RR, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))



#---------------------- (2) type S error -----------------------#
power.R.S_summary_RR <- cbind(power.R.S_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R.S_summary_RR$approach_RR <- factor(power.R.S_summary_RR$approach_RR, levels=c("O", "E", "B"))


MMA_power.R.S_RR.approach <- with(power.R.S_summary_RR, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.S_RR.stressor <- with(power.R.S_summary_RR, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.R.S_RR <- with(power.R.S_summary_RR, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))



#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_RR <- cbind(power.R.M_summary_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R.M_summary_RR$approach_RR <- factor(power.R.M_summary_RR$approach_RR, levels=c("O", "E", "B"))

MMA_power.R.M_RR.approach <- with(power.R.M_summary_RR, rma(yi = Mean, sei = se.R.M_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.M_RR.stressor <- with(power.R.M_summary_RR, rma(yi = Mean, sei = se.R.M_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.R.M_RR <- with(power.R.M_summary_RR, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.R.M2_RR <- with(power.R.M2_summary_RR, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))


















#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#

#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

MMA_power_RR_d1 <- with(power_summary_d1_RR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d1 <- with(power.S_summary_d1_RR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d1 <- with(power.M_summary_d1_RR, rma(yi = Median, sei = se.d1_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d1 <- with(power.M2_summary_d1_RR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

MMA_power_RR_d5 <- with(power_summary_d5_RR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d5 <- with(power.S_summary_d5_RR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d5 <- with(power.M_summary_d5_RR, rma(yi = Median, sei = se.d5_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d5 <- with(power.M2_summary_d5_RR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 10% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d10 <- with(power_summary_d10_RR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d10 <- with(power.S_summary_d10_RR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d10 <- with(power.M_summary_d10_RR, rma(yi = Median, sei = se.d10_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d10 <- with(power.M2_summary_d10_RR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 20% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d20 <- with(power_summary_d20_RR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d20 <- with(power.S_summary_d20_RR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d20 <- with(power.M_summary_d20_RR, rma(yi = Median, sei = se.d20_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d20 <- with(power.M2_summary_d20_RR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))




#*****************************************************************#
#********************** 30% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d30 <- with(power_summary_d30_RR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d30 <- with(power.S_summary_d30_RR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d30 <- with(power.M_summary_d30_RR, rma(yi = Median, sei = se.d30_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d30 <- with(power.M2_summary_d30_RR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 40% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d40 <- with(power_summary_d40_RR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d40 <- with(power.S_summary_d40_RR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d40 <- with(power.M_summary_d40_RR, rma(yi = Median, sei = se.d40_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d40 <- with(power.M2_summary_d40_RR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 50% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d50 <- with(power_summary_d50_RR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d50 <- with(power.S_summary_d50_RR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d50 <- with(power.M_summary_d50_RR, rma(yi = Median, sei = se.d50_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d50 <- with(power.M2_summary_d50_RR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 60% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d60 <- with(power_summary_d60_RR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d60 <- with(power.S_summary_d60_RR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d60 <- with(power.M_summary_d60_RR, rma(yi = Median, sei = se.d60_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d60 <- with(power.M2_summary_d60_RR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 70% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d70 <- with(power_summary_d70_RR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d70 <- with(power.S_summary_d70_RR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d70 <- with(power.M_summary_d70_RR, rma(yi = Median, sei = se.d70_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d70 <- with(power.M2_summary_d70_RR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 80% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d80 <- with(power_summary_d80_RR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d80 <- with(power.S_summary_d80_RR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d80 <- with(power.M_summary_d80_RR, rma(yi = Median, sei = se.d80_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d80 <- with(power.M2_summary_d80_RR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))




#*****************************************************************#
#********************** 90% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d90 <- with(power_summary_d90_RR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d90 <- with(power.S_summary_d90_RR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d90 <- with(power.M_summary_d90_RR, rma(yi = Median, sei = se.d90_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d90 <- with(power.M2_summary_d90_RR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))


# some meta-analytic cases have very large type M error, we want to consider them as potential outlier
power.M_summary_RR2 <- power.M_summary_RR %>% subset(power.M_summary_RR$se.M_mean < 100) # remove potential outlier
MMA_power.M_RR <- with(power.M_summary_RR, rma(yi = Mean, sei = se.M_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 100% mean differences *********************#
#*****************************************************************#

MMA_power_RR_d100 <- with(power_summary_d100_RR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.S_RR_d100 <- with(power.S_summary_d100_RR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.M_RR_d100 <- with(power.M_summary_d100_RR, rma(yi = Median, sei = se.d100_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.M2_RR_d100 <- with(power.M2_summary_d100_RR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))


```






### 2. Power adjusted lnRR (i.e. PET-PEESE for lnRR or meta-regression model for SMD)

#### 2.1 Estimate adjusted lnRR (bias-corrected version)

```{r}
Note: I have already saved this section as Rdata, you can run it in your computer or just load(here("data","xx.RData")) after your check

# intercepts from meta-regression using SE as moderator 
load(here("data","model_est_PET_PEESE_RR.sei.intercept.RData")
# slopes from meta-regression using variance as moderator     
load(here("data","model_est_PET_PEESE_RR.sei.slope.RData"))
# intercepts from meta-regression using SE as moderator 
load(here("data","model_est_PET_PEESE_RR.var.intercept.RData"))
# slopes from meta-regression using variance as moderator 
load(here("data","model_est_PET_PEESE_RR.var.slopet.RData"))

#***************************************************************#
#                       PET-PEESE approach                      #
#***************************************************************#

#----------------------------------------------------------------#
#              first-stage: using PET to model SE                #
#----------------------------------------------------------------#


model_list_PET_PEESE_RR.sei <- list() # rep(NA, length(dat_list))
for (i in 1:length(dat_list)) {
 model_list_PET_PEESE_RR.sei[i] <- rma.mv(data = dat_list[[i]], yi = LRR, V = var.LRR, mods = ~ sqrt(var.LRR),random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

# get intercept
model_est_PET_PEESE_RR.sei.intercept <- data.frame(MA_case=model_est_RR$MA_case,
                  mu_RR=sapply(model_list_PET_PEESE_RR.sei, function(x) x$beta[1]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.sei, function(x) x$se[1]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.sei, function(x) x$ci.lb[1]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.sei, function(x) x$ci.ub[1]),
                  p_value=sapply(model_list_PET_PEESE_RR.sei, function(x) x$pval)[c(seq(1,60,2))]) # odd columns for intercept's p-value

#save(model_est_PET_PEESE_RR.sei.intercept,file = here("data","model_est_PET_PEESE_RR.intercept.slope.RData"))
load(here("data","model_est_PET_PEESE_RR.sei.intercept.RData")


# get slope
model_est_PET_PEESE_RR.sei.slope <- data.frame(MA_case=model_est_RR$MA_case,
                  mu_RR=sapply(model_list_PET_PEESE_RR.sei, function(x) x$beta[2]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.sei, function(x) x$se[2]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.sei, function(x) x$ci.lb[2]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.sei, function(x) x$ci.ub[2]),
                  p_value=sapply(model_list_PET_PEESE_RR.sei, function(x) x$pval)[c(seq(2,60,2))]) # even columns for slope's p-value



#save(model_est_PET_PEESE_RR.sei.slope,file = here("data","model_est_PET_PEESE_RR.sei.slope.RData"))
load(here("data","model_est_PET_PEESE_RR.sei.slope.RData"))

#----------------------------------------------------------------#
#        second-stage: using PEESE to model variance (SE^2)      #
#----------------------------------------------------------------#

# 26th meta-analysis has problem in optimization - It means design matrix is not invertible and therefore can't be used to develop a regression model. This results from linearly dependent columns, i.e. strongly correlated variables (https://stats.stackexchange.com/questions/76488/error-system-is-computationally-singular-when-running-a-glm)
# So we have to seperately fit the datsets 1-25, and 27-30, and then combine thme into a list

model_list_PET_PEESE_RR.var1_25 <- list() 
for (i in 1:25) {
 model_list_PET_PEESE_RR.var1_25[i] <- rma.mv(data = dat_list[[i]], yi = LRR, V = var.LRR, mods = ~ var.LRR,random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

model_list_PET_PEESE_RR.var27_30 <- list() 
for (i in 27:30) {
 model_list_PET_PEESE_RR.var27_30[i] <- rma.mv(data = dat_list[[i]], yi = LRR, V = var.LRR, mods = ~ var.LRR,random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

# append(model_list_PET_PEESE_RR.var1_25, model_list_PET_PEESE_RR.var27_30[c(27:30)])

# get intercept1_25
model_est_PET_PEESE_RR.var.intercept1_25 <- data.frame(MA_case=model_est_RR$MA_case[1:25],
                  mu_RR=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$beta[1]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$se[1]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$ci.lb[1]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$ci.ub[1]),
                  p_value=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$pval)[c(seq(1,50,2))]) # odd columns for intercept's p-value

# get intercept26
model_est_PET_PEESE_RR.var.intercept26 <- data.frame(MA_case=model_est_PET_PEESE_RR.sei.intercept$MA_case[26],
                  mu_RR=0,
                  SE_RR=0,
                  ll_NHST=0,
                  ul_NHST=0,
                  p_value=1) # because we could not fit PEESE model, so we can not obtain corresponding estimates. We will use estimates from PET, so here we arbitaryly assume estiamtes from PEESE,

# get intercept27_30
model_est_PET_PEESE_RR.var.intercept27_30 <- data.frame(MA_case=model_est_RR$MA_case[27:30],
                  mu_RR=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$beta[1]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$se[1]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$ci.lb[1]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$ci.ub[1]),
                  p_value=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$pval)[c(seq(1,8,2))]) # odd columns for intercept's p-value


# combine intercept
model_est_PET_PEESE_RR.var.intercept <- rbind(model_est_PET_PEESE_RR.var.intercept1_25, model_est_PET_PEESE_RR.var.intercept26, model_est_PET_PEESE_RR.var.intercept27_30)

# save(model_est_PET_PEESE_RR.var.intercept,file = here("data","model_est_PET_PEESE_RR.var.intercept.RData"))
load(here("data","model_est_PET_PEESE_RR.var.intercept.RData"))

#get slope1_25
model_est_PET_PEESE_RR.var.slope1_25 <- data.frame(MA_case=model_est_RR$MA_case[1:25],
                  mu_RR=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$beta[2]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$se[2]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$ci.lb[2]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$ci.ub[2]),
                  p_value=sapply(model_list_PET_PEESE_RR.var1_25, function(x) x$pval)[c(seq(2,50,2))]) # odd columns for slope's p-value


#get slope26
model_est_PET_PEESE_RR.var.slope26 <- data.frame(MA_case=model_est_PET_PEESE_RR.sei.slope$MA_case[26],
                  mu_RR=0,
                  SE_RR=0,
                  ll_NHST=0,
                  ul_NHST=0,
                  p_value=1) # because we could not fit PEESE model, so w can not obtain corresponding estimates. We will use estimates from PET, so here we arbitaryly assume  estiamtes from PEESE,


#get slope27_30
model_est_PET_PEESE_RR.var.slope27_30 <- data.frame(MA_case=model_est_RR$MA_case[27:30],
                  mu_RR=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$beta[2]),
                  SE_RR=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$se[2]),
                  ll_NHST=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$ci.lb[2]),
                  ul_NHST=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$ci.ub[2]),
                  p_value=sapply(model_list_PET_PEESE_RR.var27_30[27:30], function(x) x$pval)[c(seq(2,8,2))]) # odd columns for slope's p-value


# combine slope
model_est_PET_PEESE_RR.var.slope <- rbind(model_est_PET_PEESE_RR.var.slope1_25, model_est_PET_PEESE_RR.var.slope26, model_est_PET_PEESE_RR.var.slope27_30)

#save(model_est_PET_PEESE_RR.var.slope,file = here("data","model_est_PET_PEESE_RR.var.slope.RData"))
load(here("data","model_est_PET_PEESE_RR.var.slopet.RData"))


# using PET’s intercept (se as moderator) when slope is not sig but PEEESE’s intercept (variance or se^2 as moderator) if PET’s slope is sig

model_est_PET_PEESE_RR.sei.intercept$id <- c(1:30)
model_est_PET_PEESE_RR.sei.slope$id <- c(1:30)
model_est_PET_PEESE_RR.var.intercept$id <- c(1:30)
model_est_PET_PEESE_RR.var.slope$id <- c(1:30)


model_est_PET_PEESE_RR.sei.slope.sig <- model_est_PET_PEESE_RR.sei.slope %>% subset(p_value < 0.05) 

model_est_PET_PEESE_RR.sei.slope.nonsig <- model_est_PET_PEESE_RR.sei.slope %>% subset(p_value > 0.05)

# get location of PET's sig slope and non-sig slope, respectively
location.sig <- which(model_est_PET_PEESE_RR.sei.slope$p_value < 0.05)
location.nonsig <- which(model_est_PET_PEESE_RR.sei.slope$p_value > 0.05)


# get the intercpet from PEESE (when PET’s slope is sig) and PET (when PET’s slope is nonsig)

model_est_PET_PEESE_RR <- rbind(model_est_PET_PEESE_RR.sei.intercept[location.nonsig,],model_est_PET_PEESE_RR.var.intercept[location.sig,]) 

model_est_PET_PEESE_RR <- model_est_PET_PEESE_RR[order(model_est_PET_PEESE_RR$id),] # reorder according to the sequences of meta-analyses

# replace 26th case
model_est_PET_PEESE_RR[26,] <- model_est_PET_PEESE_RR.sei.intercept[26,]

# obtain absolute value
model_est_PET_PEESE_RR2 <- model_est_PET_PEESE_RR
model_est_PET_PEESE_RR2$mu_RR <- abs(model_est_PET_PEESE_RR$mu_RR)

model_est_RR2 <- model_est_RR
model_est_RR2$mu_RR <- abs(model_est_RR$mu_RR)



# make comparision plot to compare original estimates and corrected estimates
# creat a table for paired comparision of meta-analysis overall mean (MAOM) and bias-corrected estimate (cMAOM)
## estimate <- c(rep('MAOM', 15), rep('cMAOM', 15))

dummy <- rep("Dummy", 30)
 wide.data <- 
   tibble::tibble(
     MAOM = model_est_RR2$mu_RR,
     cMAOM = model_est_PET_PEESE_RR2$mu_RR,
     Dummy = dummy, ID = 1:30, MA_case = model_est_PET_PEESE_RR2$MA_case)

include.point <- which((wide.data$`cMAOM` - wide.data$MAOM)<0)

wide.data3 <- wide.data[include.point,]


my.data3 <- 
  wide.data3 %>%
  tidyr::gather(key = Group, value = Measurement, -ID, -Dummy, -MA_case)


two.group.paired3 <- 
  my.data3 %>%
  dabest(Group, Measurement, 
         idx = c("MAOM", "cMAOM"), 
         paired = TRUE, id.col = ID)

paired.plot3 <- two.group.paired3 %>% 
  mean_diff() %>% 
  plot(#rawplot.ylim = c(-2, 1),
       #effsize.ylim = c(-2, 1),
       #rawplot.markersize = 1,
       #rawplot.groupwidth = 0.4,
      rawplot.ylabel = "Meta-analytic estimate (lnRR)",
      effsize.ylabel = "Mean differences (bootstrap resampling)",
      axes.title.fontsize = 14, # default is 14
      palette = c("Dark2")
      )


png(filename = "./Figures/paired.plot3.png", width = 5, height = 4, units = "in", type = "windows", res = 400)
paired.plot3 
dev.off()




# 
# 
# my.data   <- 
#   wide.data %>%
#   tidyr::gather(key = Group, value = Measurement, -ID, -Dummy, -MA_case)
# 
# 
# two.group.paired <- 
#   my.data %>%
#   dabest(Group, Measurement, 
#          idx = c("Naive", "PET-PEESE"), 
#          paired = TRUE, id.col = ID)
# 
# paired.plot <- two.group.paired %>% 
#   mean_diff() %>% 
#   plot(#rawplot.ylim = c(-2, 1),
#        #effsize.ylim = c(-2, 1),
#        #rawplot.markersize = 1,
#        #rawplot.groupwidth = 0.4,
#       rawplot.ylabel = "Meta-analytic estimate (lnRR)",
#       effsize.ylabel = "Mean differences (bootstrap resampling)",
#       axes.title.fontsize = 14, # default is 14
#       palette = c("Dark2")
#       )
# 
# 
# png(filename = "./Figures/paired.plot.png", width = 5, height = 4, units = "in", type = "windows", res = 400)
# paired.plot 
# dev.off()
# 
# 
# 
# 
# 
# model_est_PET_PEESE_RR.var.intercept[26,] <- model_est_PET_PEESE_RR.sei.intercept[26,]
# 
# model_est_PET_PEESE_RR.var.intercept2 <- model_est_PET_PEESE_RR.var.intercept
# 
# model_est_PET_PEESE_RR.var.intercept2$mu_RR <- abs(model_est_PET_PEESE_RR.var.intercept2$mu_RR)
# 
# 
# wide.data2 <- 
#   tibble::tibble(
#     Naive = model_est_RR2$mu_RR,
#     `PET-PEESE` = model_est_PET_PEESE_RR.var.intercept2$mu_RR,
#     Dummy = dummy, ID = 1:30, MA_case = model_est_PET_PEESE_RR.var.intercept2$MA_case)
# 
# 
# my.data2 <- 
#   wide.data2 %>%
#   tidyr::gather(key = Group, value = Measurement, -ID, -Dummy, -MA_case)
# 
# 
# two.group.paired2 <- 
#   my.data2 %>%
#   dabest(Group, Measurement, 
#          idx = c("Naive", "PET-PEESE"), 
#          paired = TRUE, id.col = ID)
# 
# paired.plot2 <- two.group.paired2 %>% 
#   mean_diff() %>% 
#   plot(#rawplot.ylim = c(-2, 1),
#        #effsize.ylim = c(-2, 1),
#        #rawplot.markersize = 1,
#        #rawplot.groupwidth = 0.4,
#       rawplot.ylabel = "Meta-analytic estimate (lnRR)",
#       effsize.ylabel = "Mean differences (bootstrap resampling)",
#       axes.title.fontsize = 14, # default is 14
#       palette = c("Dark2")
#       )
# 
# 
# png(filename = "./Figures/paired.plot2.png", width = 5, height = 4, units = "in", type = "windows", res = 400)
# paired.plot2 
# dev.off()

```



#### 2.2 Compile datasets for adjusted lnRR
We only had 21 meta-analyses showing the correct direction slope. For the left 9 meta-analyses, we used original meta-analysis overall mean

```{r}
Note: just load(here("data","xx.RData")) after your check

# model estimates for adjusted lnRR
load(here("data","model_est_adjusted_RR.RData")
# models for adjusted lnRR
load(here("data","model_list_adjusted_RR.RData") 


# used models: model_list_RR, model_list_PET_PEESE_RR.sei, model_list_PET_PEESE_RR.var1_25, model_list_PET_PEESE_RR.var27_30


# using estimates from model_est_PET_PEESE_RR if in a correct direction of slope. Otherwise it should use estimates from model_est_RR
model_est_adjusted_RR <- data.frame(MA_case=model_est_PET_PEESE_RR$MA_case,
                    mu_RR=c(model_est_PET_PEESE_RR$mu_RR[1],                                            model_est_PET_PEESE_RR$mu_RR[2],
                            model_est_PET_PEESE_RR$mu_RR[3],
                            model_est_RR$mu_RR[4],
                            model_est_RR$mu_RR[5],
                            model_est_RR$mu_RR[6],
                            model_est_PET_PEESE_RR$mu_RR[7],                                            model_est_PET_PEESE_RR$mu_RR[8],
                            model_est_PET_PEESE_RR$mu_RR[9],
                            model_est_RR$mu_RR[10],
                            model_est_PET_PEESE_RR$mu_RR[11],
                            model_est_RR$mu_RR[12],
                            model_est_PET_PEESE_RR$mu_RR[13],
                            model_est_PET_PEESE_RR$mu_RR[14],
                            model_est_PET_PEESE_RR$mu_RR[15],
                            model_est_RR$mu_RR[16],
                            model_est_RR$mu_RR[17],
                            model_est_PET_PEESE_RR$mu_RR[18],
                            model_est_PET_PEESE_RR$mu_RR[19],
                            model_est_PET_PEESE_RR$mu_RR[20],
                            model_est_PET_PEESE_RR$mu_RR[21],
                            model_est_PET_PEESE_RR$mu_RR[22],
                            model_est_PET_PEESE_RR$mu_RR[23],
                            model_est_RR$mu_RR[24],
                            model_est_PET_PEESE_RR$mu_RR[25],
                            model_est_PET_PEESE_RR$mu_RR[26],
                            model_est_PET_PEESE_RR$mu_RR[27],
                            model_est_PET_PEESE_RR$mu_RR[28],
                            model_est_PET_PEESE_RR$mu_RR[29],
                            model_est_RR$mu_RR[30]),
                    
                    SE_RR=c(model_est_PET_PEESE_RR$SE_RR[1],                                            model_est_PET_PEESE_RR$SE_RR[2],
                            model_est_PET_PEESE_RR$SE_RR[3],
                            model_est_RR$SE_RR[4],
                            model_est_RR$SE_RR[5],
                            model_est_RR$SE_RR[6],
                            model_est_PET_PEESE_RR$SE_RR[7],                                            model_est_PET_PEESE_RR$SE_RR[8],
                            model_est_PET_PEESE_RR$SE_RR[9],
                            model_est_RR$SE_RR[10],
                            model_est_PET_PEESE_RR$SE_RR[11],
                            model_est_RR$SE_RR[12],
                            model_est_PET_PEESE_RR$SE_RR[13],
                            model_est_PET_PEESE_RR$SE_RR[14],
                            model_est_PET_PEESE_RR$SE_RR[15],
                            model_est_RR$SE_RR[16],
                            model_est_RR$SE_RR[17],
                            model_est_PET_PEESE_RR$SE_RR[18],
                            model_est_PET_PEESE_RR$SE_RR[19],
                            model_est_PET_PEESE_RR$SE_RR[20],
                            model_est_PET_PEESE_RR$SE_RR[21],
                            model_est_PET_PEESE_RR$SE_RR[22],
                            model_est_PET_PEESE_RR$SE_RR[23],
                            model_est_RR$SE_RR[24],
                            model_est_PET_PEESE_RR$SE_RR[25],
                            model_est_PET_PEESE_RR$SE_RR[26],
                            model_est_PET_PEESE_RR$SE_RR[27],
                            model_est_PET_PEESE_RR$SE_RR[28],
                            model_est_PET_PEESE_RR$SE_RR[29],
                            model_est_RR$SE_RR[30]),
                    
                ll_NHST=c(model_est_PET_PEESE_RR$ll_NHST[1],                                            model_est_PET_PEESE_RR$ll_NHST[2],
                            model_est_PET_PEESE_RR$ll_NHST[3],
                            model_est_RR$ll_NHST[4],
                            model_est_RR$ll_NHST[5],
                            model_est_RR$ll_NHST[6],
                            model_est_PET_PEESE_RR$ll_NHST[7],                                          model_est_PET_PEESE_RR$ll_NHST[8],
                            model_est_PET_PEESE_RR$ll_NHST[9],
                            model_est_RR$ll_NHST[10],
                            model_est_PET_PEESE_RR$ll_NHST[11],
                            model_est_RR$ll_NHST[12],
                            model_est_PET_PEESE_RR$ll_NHST[13],
                            model_est_PET_PEESE_RR$ll_NHST[14],
                            model_est_PET_PEESE_RR$ll_NHST[15],
                            model_est_RR$ll_NHST[16],
                            model_est_RR$ll_NHST[17],
                            model_est_PET_PEESE_RR$ll_NHST[18],
                            model_est_PET_PEESE_RR$ll_NHST[19],
                            model_est_PET_PEESE_RR$ll_NHST[20],
                            model_est_PET_PEESE_RR$ll_NHST[21],
                            model_est_PET_PEESE_RR$ll_NHST[22],
                            model_est_PET_PEESE_RR$ll_NHST[23],
                            model_est_RR$ll_NHST[24],
                            model_est_PET_PEESE_RR$ll_NHST[25],
                            model_est_PET_PEESE_RR$ll_NHST[26],
                            model_est_PET_PEESE_RR$ll_NHST[27],
                            model_est_PET_PEESE_RR$ll_NHST[28],
                            model_est_PET_PEESE_RR$ll_NHST[29],
                            model_est_RR$ll_NHST[30]),
                
                  ul_NHST=c(model_est_PET_PEESE_RR$ul_NHST[1],                                          model_est_PET_PEESE_RR$ul_NHST[2],
                            model_est_PET_PEESE_RR$ul_NHST[3],
                            model_est_RR$ul_NHST[4],
                            model_est_RR$ul_NHST[5],
                            model_est_RR$ul_NHST[6],
                            model_est_PET_PEESE_RR$ul_NHST[7],                                          model_est_PET_PEESE_RR$ul_NHST[8],
                            model_est_PET_PEESE_RR$ul_NHST[9],
                            model_est_RR$ul_NHST[10],
                            model_est_PET_PEESE_RR$ul_NHST[11],
                            model_est_RR$ul_NHST[12],
                            model_est_PET_PEESE_RR$ul_NHST[13],
                            model_est_PET_PEESE_RR$ul_NHST[14],
                            model_est_PET_PEESE_RR$ul_NHST[15],
                            model_est_RR$ul_NHST[16],
                            model_est_RR$ul_NHST[17],
                            model_est_PET_PEESE_RR$ul_NHST[18],
                            model_est_PET_PEESE_RR$ul_NHST[19],
                            model_est_PET_PEESE_RR$ul_NHST[20],
                            model_est_PET_PEESE_RR$ul_NHST[21],
                            model_est_PET_PEESE_RR$ul_NHST[22],
                            model_est_PET_PEESE_RR$ul_NHST[23],
                            model_est_RR$ul_NHST[24],
                            model_est_PET_PEESE_RR$ul_NHST[25],
                            model_est_PET_PEESE_RR$ul_NHST[26],
                            model_est_PET_PEESE_RR$ul_NHST[27],
                            model_est_PET_PEESE_RR$ul_NHST[28],
                            model_est_PET_PEESE_RR$ul_NHST[29],
                            model_est_RR$ul_NHST[30]),
                
                  p_value=c(model_est_PET_PEESE_RR$p_value[1],                                          model_est_PET_PEESE_RR$p_value[2],
                            model_est_PET_PEESE_RR$p_value[3],
                            model_est_RR$p_value[4],
                            model_est_RR$p_value[5],
                            model_est_RR$p_value[6],
                            model_est_PET_PEESE_RR$p_value[7],                                          model_est_PET_PEESE_RR$p_value[8],
                            model_est_PET_PEESE_RR$p_value[9],
                            model_est_RR$p_value[10],
                            model_est_PET_PEESE_RR$p_value[11],
                            model_est_RR$p_value[12],
                            model_est_PET_PEESE_RR$p_value[13],
                            model_est_PET_PEESE_RR$p_value[14],
                            model_est_PET_PEESE_RR$p_value[15],
                            model_est_RR$p_value[16],
                            model_est_RR$p_value[17],
                            model_est_PET_PEESE_RR$p_value[18],
                            model_est_PET_PEESE_RR$p_value[19],
                            model_est_PET_PEESE_RR$p_value[20],
                            model_est_PET_PEESE_RR$p_value[21],
                            model_est_PET_PEESE_RR$p_value[22],
                            model_est_PET_PEESE_RR$p_value[23],
                            model_est_RR$p_value[24],
                            model_est_PET_PEESE_RR$p_value[25],
                            model_est_PET_PEESE_RR$p_value[26],
                            model_est_PET_PEESE_RR$p_value[27],
                            model_est_PET_PEESE_RR$p_value[28],
                            model_est_PET_PEESE_RR$p_value[29],
                            model_est_RR$p_value[30])) 



#save(model_est_adjusted_RR,file = here("data","model_est_adjusted_RR.RData"))
load(here("data","model_est_adjusted_RR.RData")

# get locations from model_est_PET_PEESE_RR.sei.slope.nonsig (models from model_list_PET_PEESE_RR.sei) and model_est_PET_PEESE_RR.sei.slope.sig (models from model_list_PET_PEESE_RR.var1_25 and model_list_PET_PEESE_RR.var27_30)

PET_PEESE_list_RR <- list(model_list_PET_PEESE_RR.var1_25[[1]],
                          model_list_PET_PEESE_RR.var1_25[[2]],
                          model_list_PET_PEESE_RR.var1_25[[3]],
                          model_list_PET_PEESE_RR.sei[[4]],
                          model_list_PET_PEESE_RR.var1_25[[5]],
                          model_list_PET_PEESE_RR.sei[[6]],
                          model_list_PET_PEESE_RR.var1_25[[7]],
                          model_list_PET_PEESE_RR.sei[[8]],
                          model_list_PET_PEESE_RR.sei[[9]],
                          model_list_PET_PEESE_RR.sei[[10]],
                          model_list_PET_PEESE_RR.sei[[11]],
                          model_list_PET_PEESE_RR.sei[[12]],
                          model_list_PET_PEESE_RR.sei[[13]],
                          model_list_PET_PEESE_RR.sei[[14]],
                          model_list_PET_PEESE_RR.sei[[15]],
                          model_list_PET_PEESE_RR.sei[[16]],
                          model_list_PET_PEESE_RR.sei[[17]],
                          model_list_PET_PEESE_RR.sei[[18]],
                          model_list_PET_PEESE_RR.var1_25[[19]],
                          model_list_PET_PEESE_RR.sei[[20]],
                          model_list_PET_PEESE_RR.sei[[21]],
                          model_list_PET_PEESE_RR.sei[[22]],
                          model_list_PET_PEESE_RR.sei[[23]],
                          model_list_PET_PEESE_RR.sei[[24]],
                          model_list_PET_PEESE_RR.sei[[25]],
                          model_list_PET_PEESE_RR.sei[[26]],
                          model_list_PET_PEESE_RR.sei[[27]],
                          model_list_PET_PEESE_RR.sei[[28]],
                          model_list_PET_PEESE_RR.var27_30[[29]],
                          model_list_PET_PEESE_RR.sei[[30]]
                          )



# get locations from my.data3
model_list_adjusted_RR <- list(PET_PEESE_list_RR[[1]],
                               PET_PEESE_list_RR[[2]],
                               PET_PEESE_list_RR[[3]],
                               model_list_RR[[4]],
                               model_list_RR[[5]],
                               model_list_RR[[6]],
                               PET_PEESE_list_RR[[7]],
                               PET_PEESE_list_RR[[8]],
                               PET_PEESE_list_RR[[9]],
                               model_list_RR[[10]],
                               PET_PEESE_list_RR[[11]],
                               model_list_RR[[12]],
                               PET_PEESE_list_RR[[13]],
                               PET_PEESE_list_RR[[14]],
                               PET_PEESE_list_RR[[15]],
                               model_list_RR[[16]],
                               model_list_RR[[17]],
                               PET_PEESE_list_RR[[18]],
                               PET_PEESE_list_RR[[19]],
                               PET_PEESE_list_RR[[20]],
                               PET_PEESE_list_RR[[21]],
                               PET_PEESE_list_RR[[22]],
                               PET_PEESE_list_RR[[23]],
                               model_list_RR[[24]],
                               PET_PEESE_list_RR[[25]],
                               PET_PEESE_list_RR[[26]],
                               PET_PEESE_list_RR[[27]],
                               PET_PEESE_list_RR[[28]],
                               PET_PEESE_list_RR[[29]],
                               model_list_RR[[30]]
                               )

#save(model_list_adjusted_RR,file = here("data","model_list_adjusted_RR.RData"))
load(here("data","model_list_adjusted_RR.RData") 

```




#### 2.3 MA power calculation

```{r}
Note: I have already saved this section as Rdata, you can run it in your computer or just load(here("data","model_est_adjusted_RR.RData") after your check

#***************************************************************#
#             power for 36 meta-analytic cases                  #
#***************************************************************#
# make a list of data
dat_list_adjusted <- list(dat_m1_1,
                 dat_m1_2,
                 dat_m2_1,
                 dat_m2_2,
                 dat_m3_1,
                 dat_m4_1,
                 dat_m5_1,
                 dat_m6_1,
                 dat_m6_2,
                 dat_m6_3,
                 dat_m6_4,
                 dat_m6_5,
                 dat_m7_1,
                 dat_m7_2,
                 dat_m8_1,
                 dat_m9_1,
                 dat_m10_1,
                 dat_m11_1,
                 dat_m12_1,
                 dat_m13_1,
                 dat_m13_2,
                 dat_m14_1,
                 dat_m14_2,
                 dat_m14_3,
                 dat_m15_1,
                 dat_m16_1,
                 dat_m16_2,
                 dat_m20_1,
                 dat_m23_1,
                 dat_m24_1)


#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_adjusted_RR$MA.power <- power.ma_Shinichi(mu=model_est_adjusted_RR$mu,SE=model_est_adjusted_RR$SE)


#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_adjusted_RR$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_adjusted_RR$mu[i],se=model_est_adjusted_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_adjusted_RR$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_adjusted_RR$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_adjusted_RR$mu[i],se=model_est_adjusted_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_adjusted_RR$MA.power.M <- MA.power.M


#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#
MA.power.M2 <- NA
for (i in 1:length(model_est_adjusted_RR$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_adjusted_RR$mu[i],se=model_est_adjusted_RR$SE[i],alpha=0.05) %>% unlist()
}

model_est_adjusted_RR$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_adjusted_RR, file = "./meta-analysis_adjusted_power_RR.csv", row.names = FALSE)
```



#### 2.4 Individual power

#### 2.4.1 Calculation

```{r}
Note: I also saved this section as Rdata in the data list load(here("data","dat_list_adjusted.RData"))

#***************************************************************#
#        power for empirical studies within meta-analysis       #
#***************************************************************#

# We have three approaches for calculating empirical studies within meta-analysis: (i) using meta-analytic estimate (i.e. intercept or fixed effect) as true effect; (ii) using effect size specific effect as true effect (i.e. fixed plus random effect), which accomodate between-study heterogeneity; (iii) postulated (i.e. hypothetical) effect as true effect - 5%, 10%, 20%, 40% difference


#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_RR <- NA
for (i in 1:length(dat_list)) {
  power.F_RR[i] <- power.individual_Shinichi(mu=rep(model_est_adjusted_RR$mu[i], length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_RR)) {
  dat_list_adjusted[[i]]$power.F_RR <- power.F_RR[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.S_RR[i] <- mapply(error_S, mu=rep(model_est_adjusted_RR$mu[i], length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_RR)) {
  dat_list_adjusted[[i]]$power.F.S_RR <- power.F.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.M_RR[i] <- mapply(error_M, mu=rep(model_est_adjusted_RR$mu[i], length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_RR)) {
  dat_list_adjusted[[i]]$power.F.M_RR <- power.F.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_RR <- NA
for (i in 1:length(dat_list)) {
  power.F.M2_RR[i] <- mapply(error_M2, mu=rep(model_est_adjusted_RR$mu[i], length(dat_list[[i]]$var.LRR)), se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_RR)) {
  dat_list_adjusted[[i]]$power.F.M2_RR <- power.F.M2_RR[[i]]
}



#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_RR <- NA
for (i in 1:length(model_list_adjusted_RR)) {
  blups.list_RR[i] <- ranef(model_list_adjusted_RR[[i]]) %>% list()
}

# get study index - match two components random effect
index.list_RR <- NA # list()
for (i in 1:length(model_list_adjusted_RR)) {
  index.list_RR[i] <- match(as.character(dat_list[[i]]$Study),rownames(blups.list_RR[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_RR <-NA
for (i in 1:length(model_list_adjusted_RR)) {
  effect.R_RR[i] <- mapply(sum, model_est_adjusted_RR$mu[i], blups.list_RR[[i]]$Study[index.list_RR[[i]],1], blups.list_RR[[i]]$Unit_ID[,1]) %>% list()
}

#--------------------- (1) two tailed power ---------------------#
power.R_RR <- NA
for (i in 1:length(dat_list)) {
  power.R_RR[i] <- power.individual_Shinichi(mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR)) %>% list()}

# plot(power_RR[[1]]-power_RR2[[1]]) - check discrepancy
# allocate each set of power into corresponding dataset
for (i in 1:length(power.R_RR)) {
  dat_list_adjusted[[i]]$power.R_RR <- power.R_RR[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect, which does not account for random effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.S_RR[i] <- mapply(error_S, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05) %>% list()
}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.S_RR)) {
  dat_list_adjusted[[i]]$power.R.S_RR <- power.R.S_RR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.M_RR[i] <- mapply(error_M, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.M_RR)) {
  dat_list_adjusted[[i]]$power.R.M_RR <- power.R.M_RR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_RR <- NA
for (i in 1:length(dat_list)) {
  power.R.M2_RR[i] <- mapply(error_M2, mu=effect.R_RR[[i]], se=sqrt(dat_list[[i]]$var.LRR), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into corresponding dataset
for (i in 1:length(power.R.M2_RR)) {
  dat_list_adjusted[[i]]$power.R.M2_RR <- power.R.M2_RR[[i]]
}


#save(dat_list_adjusted,file = here("data","dat_list_adjusted.RData"))
load(here("data","dat_list_adjusted.RData"))
```



#### 2.4.2 Mean of individual power 
```{r}
#*********************************************************************#
#----------- summary of empirical power for each approach ------------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F_RR))[6,])  # early version, sapply(mapply(summary, sapply(dat_list_adjusted, function(x) x$power_RR)), function(x) x[2])


#---------------------- (2) type S error -----------------------#
power.F.S_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.S_RR))[6,])


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.F.M2_RR))[6,])




#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R_RR))[6,])


#---------------------- (2) type S error -----------------------#
power.R.S_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.S_RR))[6,])



#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M_RR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted, function(x) x$power.R.M2_RR))[6,])
```

#### 2.4.3 SE of individual power
```{r}
Note: this section need to be ran in your computer

#*********************************************************************#
#--------- calculate standard error for each type of power -----------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_RR
se.F_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.F_mean[i] <- sd(dat_list_adjusted[[i]]$power.F_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.F_RR[!is.na(dat_list_adjusted[[i]]$power.F_RR)]))
}

power.F_summary_adjusted_RR$se.F_mean <- se.F_mean

#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_RR
se.F.S_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.F.S_mean[i] <- sd(dat_list_adjusted[[i]]$power.F.S_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.F.S_RR[!is.na(dat_list_adjusted[[i]]$power.F.S_RR)]))
}

power.F.S_summary_adjusted_RR$se.F.S_mean <- se.F.S_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_RR
se.F.M_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.F.M_mean[i] <- sd(dat_list_adjusted[[i]]$power.F.M_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.F.M_RR[!is.na(dat_list_adjusted[[i]]$power.F.M_RR)]))
}

power.F.M_summary_adjusted_RR$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.F.M2_mean[i] <- sd(dat_list_adjusted[[i]]$power.F.M2_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.F.M2_RR[!is.na(dat_list_adjusted[[i]]$power.F.M2_RR)]))
}

power.F.M2_summary_adjusted_RR$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_RR
se.R_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.R_mean[i] <- sd(dat_list_adjusted[[i]]$power.R_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.R_RR[!is.na(dat_list_adjusted[[i]]$power.R_RR)]))
}

power.R_summary_adjusted_RR$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_RR
se.R.S_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.R.S_mean[i] <- sd(dat_list_adjusted[[i]]$power.R.S_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.R.S_RR[!is.na(dat_list_adjusted[[i]]$power.R.S_RR)]))
}

power.R.S_summary_adjusted_RR$se.R.S_mean <- se.R.S_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_RR
se.R.M_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.R.M_mean[i] <- sd(dat_list_adjusted[[i]]$power.R.M_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.R.M_RR[!is.na(dat_list_adjusted[[i]]$power.R.M_RR)]))
}

power.R.M_summary_adjusted_RR$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(dat_list_adjusted)) {
  se.R.M2_mean[i] <- sd(dat_list_adjusted[[i]]$power.R.M2_RR, na.rm=TRUE) / sqrt(length(dat_list_adjusted[[i]]$power.R.M2_RR[!is.na(dat_list_adjusted[[i]]$power.R.M2_RR)]))
}

power.R.M2_summary_adjusted_RR$se.R.M2_mean <- se.R.M2_mean
```


### 2.5 Weighted regression

#### 2.5.1 MA power

```{r}
# Add k and N to the dataset
N_RR <- NA
N_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Study)))

k_RR <- NA
k_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Unit_ID)))


model_est_adjusted_RR$k <- k_RR

#--------------------- (1) two tailed power ---------------------#
MMA_MA_adjusted_RR <- lm(MA.power~1, weights = k, data = model_est_adjusted_RR) 

summary(MMA_MA_adjusted_RR)

#---------------------- (2) type S error -----------------------#
MMA_MA.S_adjusted_RR <- lm(MA.power.S~1, weights = k, data = model_est_adjusted_RR) 

summary(MMA_MA.S_adjusted_RR)

#-------------- (3) type M error (overestimate ratio) -------------#

MMA_MA.M_adjusted_RR <- lm(MA.power.M~1, weights = k, data = model_est_adjusted_RR) 

summary(MMA_MA.M_adjusted_RR)

```


#### 2.5.2 Individual power

```{r}
#*********************************************************************#
#-------------------- meta-meta-analysis on power --------------------#
#*********************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

# add study ID
power.F_summary_adjusted_RR$Study <- c(1,1,2,2,3,4,5,6,6,6,6,6,7,7,8,9,10,11,11,13,13,14,14,14,15,16,16,17,18,19)

# add N and k
N_RR <- NA
for (i in 1:length(dat_list_adjusted)) {
  n_RR[i] <- dat_list_adjusted[[i]]$Unit_ID %>% length()
}

k_RR <- NA
for (i in 1:length(dat_list_adjusted)) {
  k_RR[i] <- dat_list_adjusted[[i]]$Study %>% length()
}

power.F_summary_adjusted_RR$N <- N_RR
power.F_summary_adjusted_RR$k <- k_RR



approach_RR <- c("E","E","E","E","E","E","E","O","O","O","O","O","E","E","E","O","O","O","B","O","O","E","E","E","E","E","E","E","B","O")

treatment_RR <- c("Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pu","Pr","Pu","Pu","Pu","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr","Pr")

stressor_RR <- c("BD_loss","BD_loss","Fert","Fert","Warm","Fert","Fert","LUC","LUC","LUC","LUC","LUC","Fert","Fert","Precip","LUC","Warm","Inv","Fire","Fire","Fire","Warm","Warm","Warm","BD_loss","BD_loss","BD_loss","Acid","Inv","Inv")

stressor_RR %>% as.data.frame() # check the correctness

moderator_RR <- cbind(approach_RR, treatment_RR, stressor_RR)

power.F_summary_adjusted_RR <- cbind(power.F_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F_summary_adjusted_RR$approach_RR <- factor(power.F_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))


#--------------------- (1) two tailed power ---------------------#
MMA_power.F_adjusted_RR.approach <- with(power.F_summary_adjusted_RR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_adjusted_RR.stressor <- with(power.F_summary_adjusted_RR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F_adjusted_RR <- with(power.F_summary_adjusted_RR, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



#---------------------- (2) type S error -----------------------#
power.F.S_summary_adjusted_RR <- cbind(power.F.S_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_adjusted_RR$approach_RR <- factor(power.F.S_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))


MMA_power.F.S_adjusted_RR.approach <- with(power.F.S_summary_adjusted_RR, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_adjusted_RR.stressor <- with(power.F.S_summary_adjusted_RR, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F.S_adjusted_RR <- with(power.F.S_summary_adjusted_RR, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))



#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_adjusted_RR <- cbind(power.F.M_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_adjusted_RR$approach_RR <- factor(power.F.M_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))

MMA_power.F.M_adjusted_RR.approach <- with(power.F.M_summary_adjusted_RR, rma(yi = Median, sei = se.F.M_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_adjusted_RR.stressor <- with(power.F.M_summary_adjusted_RR, rma(yi = Median, sei = se.F.M_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.F.M_adjusted_RR <- with(power.F.M_summary_adjusted_RR, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t")) 

MMA_power.F.M2_adjusted_RR <- with(power.F.M2_summary_adjusted_RR, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#
power.R_summary_adjusted_RR <- cbind(power.R_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R_summary_adjusted_RR$approach_RR <- factor(power.R_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))


MMA_power.R_adjusted_RR.approach <- with(power.R_summary_adjusted_RR, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R_adjusted_RR.stressor <- with(power.R_summary_adjusted_RR, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 


MMA_power.R_adjusted_RR <- with(power.R_summary_adjusted_RR, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))




power.R.S_summary_adjusted_RR <- cbind(power.R.S_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R.S_summary_adjusted_RR$approach_RR <- factor(power.R.S_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))


MMA_power.R.S_adjusted_RR.approach <- with(power.R.S_summary_adjusted_RR, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.S_adjusted_RR.stressor <- with(power.R.S_summary_adjusted_RR, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.R.S_adjusted_RR <- with(power.R.S_summary_adjusted_RR, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))




power.R.M_summary_adjusted_RR <- cbind(power.R.M_summary_adjusted_RR, moderator_RR)

# convert moderator to factor with desired ordering of levels
power.R.M_summary_adjusted_RR$approach_RR <- factor(power.R.M_summary_adjusted_RR$approach_RR, levels=c("O", "E", "B"))

MMA_power.R.M_adjusted_RR.approach <- with(power.R.M_summary_adjusted_RR, rma(yi = Median, sei = se.R.M_mean,  mods = ~ I(approach_RR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.M_adjusted_RR.stressor <- with(power.R.M_summary_adjusted_RR, rma(yi = Median, sei = se.R.M_mean,  mods = ~ I(stressor_RR) -1, method = "REML", test = "t")) 

MMA_power.R.M_adjusted_RR <- with(power.R.M_summary_adjusted_RR, rma(yi = Median, sei = se.R.M_mean,   method = "REML", test = "t")) # median rather than mean

MMA_power.R.M2_adjusted_RR <- with(power.R.M2_summary_adjusted_RR, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))


```





### Results reporting
```{r}




lnRR <- sapply(dat_list, function(x) x$LRR) %>% unlist

# Make all the effects positive
lnRR <- abs(lnRR)

# Table 1
# Calculate percentiles r
percentiles_lnRR <- quantile(lnRR, prob = c(0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6,0.65,0.7,0.75,0.8,0.85,0.9,0.95)) 

percentiles_lnRR <- as.data.frame(round(percentiles_lnRR,2))



# Percentiles for Cohen's thresholds
quantile(lnRR, prob = c(0.20)) # small
quantile(lnRR, prob = c(0.50)) # medium
quantile(lnRR, prob = c(0.80)) # large



lnRR1 <- data.frame(lnRR)


ggplot(data=lnRR1, aes(lnRR)) + geom_histogram(binwidth=0.25, color='black', fill='skyblue1') +
  geom_vline(aes(xintercept=quantile(lnRR, prob = c(0.25))), color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=quantile(lnRR, prob = c(0.50))), color="red", linetype="dashed", size=1) +
  geom_vline(aes(xintercept=quantile(lnRR, prob = c(0.75))), color="red", linetype="dashed", size=1) +
  scale_x_continuous(breaks=seq(0, 10, 1)) +
  labs(x = "lnRR", y = "Frequency") +
  theme_cowplot()+
  annotate("text", x = -0.1, y = 1200, label = "25th", size=3.5)+
  annotate("text", x = 0.55, y = 1200, label = "50th", size=3.5)+
  annotate("text", x = 1.00, y = 1200, label = "75th", size=3.5) -> percentiles_lnRR.p

png(filename = "./Figures/percentiles_lnRR.p.png", width = 8, height = 5, units = "in", type = "windows", res = 400)
percentiles_lnRR.p
dev.off()


model_est_RR2 <- model_est_RR
model_est_RR2$mu_RR <- abs(model_est_RR2$mu_RR)









# meta-meta-analysis


estimates.CI <- function(model){
  db.mf <- data.frame(round(model$b,3),row.names = 1:nrow(model$b))
  db.mf <- cbind(db.mf,round(model$ci.lb,3),round(model$ci.ub,3),row.names(model$b))
  names(db.mf) <- c("mean","lower","upper","estimate")
  return(db.mf[,c("estimate","mean","lower","upper")])
}

estimates.CI2 <- function(model){
  db.mf <- data.frame(round(model$b,1),row.names = 1:nrow(model$b))
  db.mf <- cbind(db.mf,round(model$ci.lb,1),round(model$ci.ub,1),row.names(model$b))
  names(db.mf) <- c("mean","lower","upper","estimate")
  return(db.mf[,c("estimate","mean","lower","upper")])
}

MMA_power.F_RR
MMA_power.F.S_RR 
MMA_power.F.M_RR
MMA_power.F.M2_RR

MMA_power.R_RR
MMA_power.R.S_RR 
MMA_power.R.M_RR
MMA_power.R.M2_RR

MMA_power.F_adjusted_RR
MMA_power.F.S_adjusted_RR 
MMA_power.F.M_adjusted_RR
MMA_power.F.M2_adjusted_RR


MMA_power.R_adjusted_RR
MMA_power.R.S_adjusted_RR 
MMA_power.R.M_adjusted_RR
MMA_power.R.M2_adjusted_RR

## power ##
estimates.CI(MMA_power.F_RR);estimates.CI(MMA_power.R_RR);estimates.CI(MMA_power.F_adjusted_RR);estimates.CI(MMA_power.R_adjusted_RR)

estimates.CI(MMA_power.F_SMD);estimates.CI(MMA_power.R_SMD);estimates.CI(MMA_power.F_adjusted_SMD);estimates.CI(MMA_power.R_adjusted_SMD)

estimates.CI(MMA_power.F_VR);estimates.CI(MMA_power.R_VR)
estimates.CI(MMA_power.F_CVR);estimates.CI(MMA_power.R_CVR)


estimates.CI(MMA_MA_RR);estimates.CI(MMA_MA_adjusted_RR)
estimates.CI(MMA_MA_SMD);estimates.CI(MMA_MA_adjusted_SMD)
estimates.CI(MMA_MA_VR);estimates.CI(MMA_MA_CVR)


##Type S##
estimates.CI(MMA_power.F.S_RR);estimates.CI(MMA_power.R.S_RR);estimates.CI(MMA_power.F.S_adjusted_RR);estimates.CI(MMA_power.R.S_adjusted_RR)

estimates.CI(MMA_power.F.S_SMD);estimates.CI(MMA_power.R.S_SMD);estimates.CI(MMA_power.F.S_adjusted_SMD);estimates.CI(MMA_power.R.S_adjusted_SMD)

estimates.CI(MMA_power.F.S_VR);estimates.CI(MMA_power.R.S_VR)
estimates.CI(MMA_power.F.S_CVR);estimates.CI(MMA_power.R.S_CVR)


estimates.CI(MMA_MA.S_RR);estimates.CI(MMA_MA.S_adjusted_RR)
estimates.CI(MMA_MA.S_SMD);estimates.CI(MMA_MA.S_adjusted_SMD)
estimates.CI(MMA_MA.S_VR);estimates.CI(MMA_MA.S_CVR)




##Type M##
estimates.CI2(MMA_power.F.M_RR);estimates.CI2(MMA_power.R.M_RR);estimates.CI2(MMA_power.F.M_adjusted_RR);estimates.CI2(MMA_power.R.M_adjusted_RR)

estimates.CI2(MMA_power.F.M_SMD);estimates.CI2(MMA_power.R.M_SMD);estimates.CI2(MMA_power.F.M_adjusted_SMD);estimates.CI2(MMA_power.R.M_adjusted_SMD)

estimates.CI2(MMA_power.F.M_VR);estimates.CI2(MMA_power.R.M_VR)
estimates.CI2(MMA_power.F.M_CVR);estimates.CI2(MMA_power.R.M_CVR)


estimates.CI2(MMA_MA.M_RR);estimates.CI2(MMA_MA.M_adjusted_RR)
estimates.CI2(MMA_MA.M_SMD);estimates.CI2(MMA_MA.M_adjusted_SMD)
estimates.CI2(MMA_MA.M_VR);estimates.CI2(MMA_MA.M_CVR)




## meta-regression
estimates.CI(MMA_power.F_RR.approach);estimates.CI(MMA_power.F_RR.stressor)
estimates.CI(MMA_power.F_adjusted_RR.approach);estimates.CI(MMA_power.F_adjusted_RR.stressor)


estimates.CI2(MMA_power.F.M_RR.approach);estimates.CI2(MMA_power.F.M_RR.stressor)
estimates.CI2(MMA_power.F.M_adjusted_RR.approach);estimates.CI2(MMA_power.F.M_adjusted_RR.stressor)


estimates.CI(MMA_power.F.S_RR.approach);estimates.CI(MMA_power.F.S_RR.stressor)
estimates.CI(MMA_power.F.S_adjusted_RR.approach);estimates.CI(MMA_power.F.S_adjusted_RR.stressor)



estimates.CI(MMA_power.F_CVR.approach);estimates.CI(MMA_power.F_CVR.stressor)
estimates.CI(MMA_power.F_VR.approach);estimates.CI(MMA_power.F_VR.stressor)


estimates.CI2(MMA_power.F.M_CVR.approach);estimates.CI2(MMA_power.F.M_CVR.stressor)
estimates.CI2(MMA_power.F.M_VR.approach);estimates.CI2(MMA_power.F.M_VR.stressor)


estimates.CI(MMA_power.F.S_CVR.approach);estimates.CI(MMA_power.F.S_CVR.stressor)
estimates.CI(MMA_power.F.S_VR.approach);estimates.CI(MMA_power.F.S_VR.stressor)





## adjusted estimates
;estimates.CI(MMA_power.R_RR.stressor);estimates.CI(MMA_power.F_adjusted_RR.stressor);estimates.CI(MMA_power.R_adjusted_RR.stressor)

estimates.CI(MMA_power.R_adjusted_RR.approach)

# lnRR
N_RR <- NA
N_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Study)))

k_RR <- NA
k_RR <- mapply(length, sapply(dat_list, function(x) unique(x$Unit_ID)))

# SMD
N_SMD <- NA
N_SMD <- mapply(length, sapply(SMD, function(x) unique(x$Study)))

k_SMD <- NA
k_SMD <- mapply(length, sapply(SMD, function(x) unique(x$Unit_ID)))

# lnVR
N_VR <- NA
N_VR <- mapply(length, sapply(lnVR, function(x) unique(x$Study)))

k_VR <- NA
k_VR <- mapply(length, sapply(lnVR, function(x) unique(x$Unit_ID)))

# lnCVR
N_CVR <- NA
N_CVR <- mapply(length, sapply(lnCVR, function(x) unique(x$Study)))

k_CVR <- NA
k_CVR <- mapply(length, sapply(lnCVR, function(x) unique(x$Unit_ID)))


MMA_power.F_RR <- with(model_est_RR, rma(yi = mu_RR, sei = SE_RR,   method = "REML", test = "t"))

# meta-analysis level meta-analysis
model_est_RR$k <- k_RR
model_est_adjusted_RR$k <- k_RR

model_est_SMD$k <- k_SMD
model_est_adjusted_SMD$k <- k_SMD

model_est_VR$k <- k_VR
model_est_CVR$k <- k_CVR




# rma(yi = Mean, sei = se.R_mean, test = “t”)) This will give you I2 etc - this may be good


https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/confint

MMA_MA_RR <- rma(data = model_est_RR, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")

#MMA_MA_RR <- lm(MA.power~1, weights = k, data = model_est_RR) %>% summary()

MMA_MA.S_RR <- rma(data = model_est_RR, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
#MMA_MA.S_RR <- lm(MA.power.S~1, weights = k, data = model_est_RR) %>% summary()

MMA_MA.M_RR <- rma(data = model_est_RR, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")


MMA_MA_adjusted_RR <- rma(data = model_est_adjusted_RR, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.S_adjusted_RR <- rma(data = model_est_adjusted_RR, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.M_adjusted_RR <- rma(data = model_est_adjusted_RR, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")


MMA_MA_SMD <- rma(data = model_est_SMD, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.S_SMD <- rma(data = model_est_SMD, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.M_SMD <- rma(data = model_est_SMD, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")


MMA_MA_adjusted_SMD <- rma(data = model_est_adjusted_SMD, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.S_adjusted_SMD <- rma(data = model_est_adjusted_SMD, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.M_adjusted_SMD <- rma(data = model_est_adjusted_SMD, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")


MMA_MA_VR <- rma(data = model_est_VR, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.S_VR <- rma(data = model_est_VR, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.M_VR <- rma(data = model_est_VR, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")



#MMA_MA_CVR <- rma(data = model_est_CVR, yi = MA.power, sei = 1, weights = k,   method = "REML", test = "t")
#MMA_MA_CVR <- lm(MA.power~1, weights = k, data = model_est_CVR) %>% summary()
rma(data = model_est_CVR, yi = MA.power, sei = 1/sqrt(k), method = "FE", test = "t")

MMA_MA.S_CVR <- rma(data = model_est_CVR, yi = MA.power.S, sei = 1/sqrt(k), method = "FE", test = "t")
MMA_MA.M_CVR <- rma(data = model_est_CVR, yi = MA.power.M, sei = 1/sqrt(k), method = "FE", test = "t")



# Median of adequately powered studies
# lnRR
power.F_RR_unlist <-sapply(dat_list, function(x) x$power.F_RR) %>% unlist()
power.F_RR_unlist80 <- which(power.F_RR_unlist>0.8)
100*length(power.F_RR_unlist80)/length(power.F_RR_unlist)

power.R_RR_unlist <- sapply(dat_list, function(x) x$power.R_RR) %>% unlist()
power.R_RR_unlist80 <- which(power.R_RR_unlist>0.8)
100*length(power.R_RR_unlist80)/length(power.R_RR_unlist)


power.F_RR_unlist <- sapply(dat_list_adjusted, function(x) x$power.F_RR) %>% unlist()
power.F_RR_unlist80 <- which(power.F_RR_unlist>0.8)
100*length(power.F_RR_unlist80)/length(power.F_RR_unlist)

power.R_RR_unlist <- sapply(dat_list_adjusted, function(x) x$power.R_RR) %>% unlist()
power.R_RR_unlist80 <- which(power.R_RR_unlist>0.8)
100*length(power.R_RR_unlist80)/length(power.R_RR_unlist)



# SMD
power.F_SMD_unlist <-sapply(SMD, function(x) x$power.F_SMD) %>% unlist()
power.F_SMD_unlist80 <- which(power.F_SMD_unlist>0.8)
100*length(power.F_SMD_unlist80)/length(power.F_SMD_unlist)

power.R_SMD_unlist <- sapply(SMD, function(x) x$power.R_SMD) %>% unlist()
power.R_SMD_unlist80 <- which(power.R_SMD_unlist>0.8)
100*length(power.R_SMD_unlist80)/length(power.R_SMD_unlist)

power.F_SMD_unlist <-power.F_adjusted_SMD %>% unlist()
power.F_SMD_unlist80 <- which(power.F_SMD_unlist>0.8)
100*length(power.F_SMD_unlist80)/length(power.F_SMD_unlist)

power.R_SMD_unlist <-power.R_adjusted_SMD %>% unlist()
power.R_SMD_unlist80 <- which(power.R_SMD_unlist>0.8)
100*length(power.R_SMD_unlist80)/length(power.R_SMD_unlist)



# lnVR
power.F_VR_unlist <-sapply(lnVR, function(x) x$power.F_VR) %>% unlist()
power.F_VR_unlist80 <- which(power.F_VR_unlist>0.8)
100*length(power.F_VR_unlist80)/length(power.F_VR_unlist)

power.R_VR_unlist <- sapply(lnVR, function(x) x$power.R_VR) %>% unlist()
power.R_VR_unlist80 <- which(power.R_VR_unlist>0.8)
100*length(power.R_VR_unlist80)/length(power.R_VR_unlist)


# lnCVR
power.F_CVR_unlist <-sapply(lnCVR, function(x) x$power.F_CVR) %>% unlist()
power.F_CVR_unlist80 <- which(power.F_CVR_unlist>0.8)
100*length(power.F_CVR_unlist80)/length(power.F_CVR_unlist)

power.R_CVR_unlist <- sapply(lnCVR, function(x) x$power.R_CVR) %>% unlist()
power.R_CVR_unlist80 <- which(power.R_CVR_unlist>0.8)
100*length(power.R_CVR_unlist80)/length(power.R_CVR_unlist)



#meta-analysis level
100*length(which(model_est_RR$MA.power>0.8))/length(model_est_RR$MA.power)

100*length(which(model_est_adjusted_RR$MA.power>0.8))/length(model_est_RR$MA.power)

100*length(which(model_est_SMD$MA.power>0.8))/length(model_est_SMD$MA.power)

100*length(which(model_est_adjusted_SMD$MA.power>0.8))/length(model_est_SMD$MA.power)

100*length(which(model_est_VR$MA.power>0.8))/length(model_est_VR$MA.power)

100*length(which(model_est_CVR$MA.power>0.8))/length(model_est_CVR$MA.power)


# meta-meta-analysis
MMA_power.F_SMD
MMA_power.F.S_SMD 
MMA_power.F.M_SMD
MMA_power.F.M2_SMD

MMA_power.R_SMD
MMA_power.R.S_SMD 
MMA_power.R.M_SMD
MMA_power.R.M2_SMD

MMA_power.F_adjusted_SMD
MMA_power.F.S_adjusted_SMD 
MMA_power.F.M_adjusted_SMD
MMA_power.F.M2_adjusted_SMD


MMA_power.R_adjusted_SMD
MMA_power.R.S_adjusted_SMD 
MMA_power.R.M_adjusted_SMD
MMA_power.R.M2_adjusted_SMD





# meta-meta-analysis
MMA_power.F_VR
MMA_power.F.S_VR 
MMA_power.F.M_VR
MMA_power.F.M2_VR

MMA_power.R_VR
MMA_power.R.S_VR 
MMA_power.R.M_VR
MMA_power.R.M2_VR







# meta-meta-analysis
MMA_power.F_CVR
MMA_power.F.S_CVR 
MMA_power.F.M_CVR
MMA_power.F.M2_CVR

MMA_power.R_CVR
MMA_power.R.S_CVR 
MMA_power.R.M_CVR
MMA_power.R.M2_CVR



# meta-regression

MMA_power.F_RR.approach
MMA_power.F.M_RR.approach
MMA_power.F.S_RR.approach

MMA_power.F_RR.stressor
MMA_power.F.M_RR.stressor
MMA_power.F.S_RR.stressor

MMA_power.F_adjusted_RR.approach # summary(MMA_power.F_adjusted_RR.approach,digits=3)
MMA_power.F.M_adjusted_RR.approach
MMA_power.F.S_adjusted_RR.approach


MMA_power.F_adjusted_RR.stressor
MMA_power.F.M_adjusted_RR.stressor
MMA_power.F.S_adjusted_RR.stressor



MMA_power.F_CVR.approach
MMA_power.F.M_CVR.approach
MMA_power.F.S_CVR.approach

MMA_power.F_CVR.stressor
MMA_power.F.M_CVR.stressor
MMA_power.F.S_CVR.stressor



MMA_power.F_VR.approach
MMA_power.F.M_VR.approach
MMA_power.F.S_VR.approach

MMA_power.F_VR.stressor
MMA_power.F.M_VR.stressor
MMA_power.F.S_VR.stressor




d90_power_RR_unlist <- d90_power_RR %>% unlist()
d90_power_RRunlist80 <- which(d90_power_RR_unlist>0.8)
100*length(d90_power_RRunlist80)/length(d90_power_RR_unlist)

d20_power_RR_unlist <- d20_power_RR %>% unlist()
d20_power_RRunlist80 <- which(d20_power_RR_unlist>0.8)
100*length(d20_power_RRunlist80)/length(d20_power_RR_unlist)

      
model_est_RR
power.F_summary_RR

model_est_RR %>% select(MA_case, p_value, MA.power) %>% filter(p_value < 0.05) -> model_est_RR.sig  # find the studies which show significant results
which(model_est_RR.sig$MA.power > 0.8) %>% length


model_est_RR$MA.power.M %>% summary()
MMA_power.F.M_RR


MMA_power.F.S_RR


MMA_power.F_RR
MMA_power.F.S_RR 
MMA_power.F.M_RR
MMA_power.F.M2_RR 

MMA_power.F_RR.approach
MMA_power.F.M_RR.approach
MMA_power.F.S_RR.approach

MMA_power.F_RR.stressor

MMA_power.R_RR
MMA_power.R.S_RR 
MMA_power.R.M_RR
MMA_power.R.M2_RR 


power.F_summary_RR$Median %>% range


MMA_power_RR_d90
MMA_power_RR_d100







power.F_CVR_unlist <- power.F_CVR %>% unlist()
power.F_CVR_unlist80 <- which(power.F_CVR_unlist>0.8)
100*length(power.F_CVR_unlist80)/length(power.F_CVR_unlist)

power.R_CVR_unlist <- power.R_CVR %>% unlist()
power.R_CVR_unlist80 <- which(power.R_CVR_unlist>0.8)
100*length(power.R_CVR_unlist80)/length(power.R_CVR_unlist)

d90_power_CVR_unlist <- d90_power_CVR %>% unlist()
d90_power_CVRunlist80 <- which(d90_power_CVR_unlist>0.8)
100*length(d90_power_CVRunlist80)/length(d90_power_CVR_unlist)

d20_power_CVR_unlist <- d20_power_CVR %>% unlist()
d20_power_CVRunlist80 <- which(d20_power_CVR_unlist>0.8)
100*length(d20_power_CVRunlist80)/length(d20_power_CVR_unlist)

      
model_est_CVR
power.F_summary_CVR

model_est_CVR %>% select(MA_case, p_value, MA.power) %>% filter(p_value < 0.05) -> model_est_CVR.sig  # find the studies which show significant results
which(model_est_CVR.sig$MA.power > 0.8) %>% length


model_est_CVR$MA.power.M %>% summary()
MMA_power.F.M_CVR


model_est_CVR$MA.power.S %>% summary()
MMA_power.F.S_CVR


MMA_power.F_CVR
MMA_power.F.S_CVR 
MMA_power.F.M_CVR
MMA_power.F.M2_CVR 

MMA_power.F_CVR.approach
MMA_power.F.M_CVR.approach
MMA_power.F.S_CVR.approach

MMA_power.R_CVR
MMA_power.R.S_CVR 
MMA_power.R.M_CVR
MMA_power.R.M2_CVR 

power.F_summary_RR$Median %>% range

MMA_power_CVR_d90
MMA_power_CVR_d100






power.F_VR_unlist <- power.F_VR %>% unlist()
power.F_VR_unlist80 <- which(power.F_VR_unlist>0.8)
100*length(power.F_VR_unlist80)/length(power.F_VR_unlist)

power.R_VR_unlist <- power.R_VR %>% unlist()
power.R_VR_unlist80 <- which(power.R_VR_unlist>0.8)
100*length(power.R_VR_unlist80)/length(power.R_VR_unlist)

d90_power_VR_unlist <- d90_power_VR %>% unlist()
d90_power_VRunlist80 <- which(d90_power_VR_unlist>0.8)
100*length(d90_power_VRunlist80)/length(d90_power_VR_unlist)

d20_power_VR_unlist <- d20_power_VR %>% unlist()
d20_power_VRunlist80 <- which(d20_power_VR_unlist>0.8)
100*length(d20_power_VRunlist80)/length(d20_power_VR_unlist)

      
model_est_VR
power.F_summary_VR

model_est_VR %>% select(MA_case, p_value, MA.power) %>% filter(p_value < 0.05) -> model_est_VR.sig  # find the studies which show significant results
which(model_est_VR.sig$MA.power > 0.8) %>% length


model_est_VR$MA.power.M %>% summary()
MMA_power.F.M_VR


MMA_power.F.S_VR


MMA_power.F_VR
MMA_power.F.S_VR 
MMA_power.F.M_VR
MMA_power.F.M2_VR 

MMA_power.F_VR.approach
MMA_power.F.M_VR.approach
MMA_power.F.S_VR.approach

MMA_power.R_VR
MMA_power.R.S_VR 
MMA_power.R.M_VR
MMA_power.R.M2_VR 

power.F_summary_RR$Median %>% range

MMA_power_VR_d90
MMA_power_VR_d100

```




### Fig - lnRR, SMD, lnCVR, lnVR

```{r}
library(metaviz)
library(TOSTER)
library(puniform)
library(dplyr)
library(tidyr)
library(viridis)



library(ggthemes)


intercept_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power.F_summary_RR$Median,
                              effect=rep(c("MAOM"),30),
                              es_cat=rep(c("a.Intercept_es"),30))


intercept_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                              es=model_est_adjusted_RR$mu_RR,
                              power=power.F_summary_adjusted_RR$Median,
                              effect=rep(c("cMAOM"),30),
                            es_cat=rep(c("a.Intercept_es"),30))



blup_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power.R_summary_RR$Median,
                              effect=rep(c("ESSP"),30),
                              es_cat=rep(c("b.BLUP_es"),30))


blup_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                              es=model_est_adjusted_RR$mu_RR,
                              power=power.R_summary_adjusted_RR$Median,
                              effect=rep(c("cESSP"),30),
                              es_cat=rep(c("b.BLUP_es"),30))




d1_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d1_RR$Median,
                              effect=rep(c("1%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))


d5_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d5_RR$Median,
                              effect=rep(c("5%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d10_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d10_RR$Median,
                              effect=rep(c("10%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d20_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d20_RR$Median,
                              effect=rep(c("20%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d30_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d30_RR$Median,
                              effect=rep(c("30%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d40_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d40_RR$Median,
                              effect=rep(c("40%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))


d50_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d50_RR$Median,
                              effect=rep(c("50%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))


d60_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d60_RR$Median,
                              effect=rep(c("60%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))


d70_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d70_RR$Median,
                              effect=rep(c("70%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))


d80_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d80_RR$Median,
                              effect=rep(c("80%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d90_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d90_RR$Median,
                              effect=rep(c("90%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))

d100_RR <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=power_summary_d100_RR$Median,
                              effect=rep(c("100%"),30),
                              es_cat=rep(c("Hypothetical_es"),30))



MA.power_RR <- data.frame(MA_case=model_est_RR$MA_case,
                                 es=model_est_RR$mu_RR,
                                 power=model_est_RR$MA.power,
                                 effect=rep(c("MAOM.MA"),30),
                                 es_cat=rep(c("c.MA.power"),30))

MA.power_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                                 es=model_est_adjusted_RR$mu_RR,
                                 power=model_est_adjusted_RR$MA.power,
                            effect=rep(c("cMAOM.MA"),30),
                                 es_cat=rep(c("c.MA.power"),30))


power_firepower_RR <- rbind(intercept_RR,
                         intercept_adjusted_RR,
                         blup_RR,
                         blup_adjusted_RR,
                         MA.power_RR,
                         MA.power_adjusted_RR
                         #d1_RR,
                         #d5_RR,
                         # d10_RR,
                         # d20_RR,
                         # d30_RR,
                         # d40_RR,
                         # d50_RR,
                         # d60_RR,
                         # d70_RR,
                         # d80_RR,
                         # d90_RR,
                         # d100_RR
                         )

power_firepower_RR$number <- c(1:(6*30)) # for reorder

power_firepower_RR$es <- abs(power_firepower_RR$es)

#power_firepower_RR$power[1] <- 100
#power_firepower_RR$power[2] <- 100


firepower_plot_RR <- ggplot(data = power_firepower_RR) +
  geom_tile(aes(x = reorder(effect,number), y = reorder(MA_case,-es),fill = power)) +
  theme(aspect.ratio = 0.3) +
  scale_fill_gradient2(
    name = "Power",
    low = "#56B4E9",
    mid = "white",
    high = "#CC79A7",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") +
  theme(strip.text.x = element_blank()) +  labs(x ="Global change effect (lnRR)", y = "") + theme(axis.text.x = element_text(size = 10.5, colour = "black"),
                                         axis.text.y = element_text(size = 10.5, colour = "black"),
                                         axis.title.x = element_text(size = 10.5, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10.5),
                                         legend.title = element_text(size=10.5),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/firepower_plot_RR.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
firepower_plot_RR 
dev.off()



firepower_plot <-
  firepower_plot + scale_x_discrete(
    labels = c(
       "ESSP" = "blup_RR",
        "cESSP" = "blup_adjusted_RR",
        "MAOM" = "intercept_RR",
        "cMAOM" = "intercept_adjusted_RR",
        "MAOM.MA" = "MA.power_RR",
        "cMAOM.MA" = "MA.power_adjusted_RR"
    )) + theme(axis.text.x = element_text(size = 12, colour = "black", face = "bold"))



                         
                     




intercept_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power.F_summary_CVR$Median,
                              effect=rep(c("MAOM"),12),
                              es_cat=rep(c("a.Intercept_es"),12))


blup_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power.R_summary_CVR$Median,
                              effect=rep(c("ESSP"),12),
                              es_cat=rep(c("b.BLUP_es"),12))

d1_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d1_CVR$Median,
                              effect=rep(c("1%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d5_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d5_CVR$Median,
                              effect=rep(c("5%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d10_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d10_CVR$Median,
                              effect=rep(c("10%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d20_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d20_CVR$Median,
                              effect=rep(c("20%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d30_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d30_CVR$Median,
                              effect=rep(c("30%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d40_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d40_CVR$Median,
                              effect=rep(c("40%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d50_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d50_CVR$Median,
                              effect=rep(c("50%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d60_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d60_CVR$Median,
                              effect=rep(c("60%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d70_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d70_CVR$Median,
                              effect=rep(c("70%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d80_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d80_CVR$Median,
                              effect=rep(c("80%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d90_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d90_CVR$Median,
                              effect=rep(c("90%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d100_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                              es=model_est_CVR$mu_CVR,
                              power=power_summary_d100_CVR$Median,
                              effect=rep(c("100%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


MA.power_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                                 es=model_est_CVR$mu_CVR,
                                 power=model_est_CVR$MA.power,
                                 effect=rep(c("MAOM.MA"),12),
                                 es_cat=rep(c("c.MA.power"),12))


power_firepower_CVR <- rbind(intercept_CVR,
                         blup_CVR,
                         MA.power_CVR
                         # d1_CVR,
                         # d5_CVR,
                         # d10_CVR,
                         # d20_CVR,
                         # d30_CVR,
                         # d40_CVR,
                         # d50_CVR,
                         # d60_CVR,
                         # d70_CVR,
                         # d80_CVR,
                         # d90_CVR,
                         # d100_CVR
                         )

power_firepower_CVR$number <- c(1:(3*12)) # for reorder
power_firepower_CVR$es <- abs(power_firepower_CVR$es)


firepower_plot_CVR <- ggplot(data = power_firepower_CVR) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = MA_case,
    fill = power
  )) +
  theme(aspect.ratio = 0.3) +
  scale_fill_gradient2(
    name = "Power",
    low = "#56B4E9",
    mid = "white",
    high = "#CC79A7",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") +
  theme(strip.text.x = element_blank()) + labs(x ="Heteroscedasticity (lnCVR)", y = "") + theme(axis.text.x = element_text(size = 10.5, colour = "black"),
                                         axis.text.y = element_text(size = 10.5, colour = "black"),
                                         axis.title.x = element_text(size = 10.5, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10.5),
                                         legend.title = element_text(size=10.5),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/firepower_plot_CVR.png", width = 6, height = 6, units = "in", type = "windows", res = 400)
firepower_plot_CVR 
dev.off()





intercept_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power.F_summary_VR$Median,
                              effect=rep(c("MAOM"),12),
                              es_cat=rep(c("a.Intercept_es"),12))


blup_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power.R_summary_VR$Median,
                              effect=rep(c("ESSP"),12),
                              es_cat=rep(c("b.BLUP_es"),12))

d1_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d1_VR$Median,
                              effect=rep(c("1%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d5_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d5_VR$Median,
                              effect=rep(c("5%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d10_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d10_VR$Median,
                              effect=rep(c("10%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d20_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d20_VR$Median,
                              effect=rep(c("20%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d30_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d30_VR$Median,
                              effect=rep(c("30%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d40_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d40_VR$Median,
                              effect=rep(c("40%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d50_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d50_VR$Median,
                              effect=rep(c("50%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d60_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d60_VR$Median,
                              effect=rep(c("60%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d70_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d70_VR$Median,
                              effect=rep(c("70%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d80_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d80_VR$Median,
                              effect=rep(c("80%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d90_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d90_VR$Median,
                              effect=rep(c("90%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d100_VR <- data.frame(MA_case=model_est_VR$MA_case,
                              es=model_est_VR$mu_VR,
                              power=power_summary_d100_VR$Median,
                              effect=rep(c("100%"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


MA.power_VR <- data.frame(MA_case=model_est_VR$MA_case,
                                 es=model_est_VR$mu_VR,
                                 power=model_est_VR$MA.power,
                                 effect=rep(c("MAOM.MA"),12),
                                 es_cat=rep(c("c.MA.power"),12))


power_firepower_VR <- rbind(intercept_VR,
                         blup_VR,
                         MA.power_VR
                         # d1_VR,
                         # d5_VR,
                         # d10_VR,
                         # d20_VR,
                         # d30_VR,
                         # d40_VR,
                         # d50_VR,
                         # d60_VR,
                         # d70_VR,
                         # d80_VR,
                         # d90_VR,
                         # d100_VR
                         )

power_firepower_VR$number <- c(1:(3*12)) # for reorder
power_firepower_VR$es <- abs(power_firepower_VR$es)


firepower_plot_VR <- ggplot(data = power_firepower_VR) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = MA_case,
    fill = power
  )) +
  theme(aspect.ratio = 0.3) +
  scale_fill_gradient2(
    name = "Power",
    low = "#56B4E9",
    mid = "white",
    high = "#CC79A7",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") +
  theme(strip.text.x = element_blank()) + labs(x ="Heteroscedasticity (lnVR)", y = "") + theme(axis.text.x = element_text(size = 10.5, colour = "black"),
                                         axis.text.y = element_text(size = 10.5, colour = "black"),
                                         axis.title.x = element_text(size = 10.5, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10.5),
                                         legend.title = element_text(size=10.5),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/firepower_plot_VR.png", width = 6, height = 6, units = "in", type = "windows", res = 400)
firepower_plot_VR 
dev.off()



firepower_plot_CVR_VR <- ggarrange(firepower_plot_CVR, firepower_plot_VR , heights = c(5,5), widths = c(5,5), nrow = 1, ncol = 2, align = "h")

png(filename = "./Figures/firepower_plot_CVR_VR.png", width = 10, height = 6, units = "in", type = "windows", res = 400)
firepower_plot_CVR_VR
dev.off()


intercept_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power.F_summary_SMD$Median,
                              effect=rep(c("MAOM"),12),
                              es_cat=rep(c("a.Intercept_es"),12))

intercept_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                              es=model_est_adjusted_SMD$mu_SMD,
                            power=power.F_summary_adjusted_SMD$Median,
                              effect=rep(c("cMAOM"),12),
                            es_cat=rep(c("a.Intercept_es"),12))




blup_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power.R_summary_SMD$Median,
                              effect=rep(c("ESSP"),12),
                              es_cat=rep(c("b.BLUP_es"),12))




blup_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                              es=model_est_adjusted_SMD$mu_SMD,
                            power=power.R_summary_adjusted_SMD$Median,
                              effect=rep(c("cESSP"),12),
                              es_cat=rep(c("b.BLUP_es"),12))



d0.1_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.1_SMD$Median,
                              effect=rep(c("0.1"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d0.2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.2_SMD$Median,
                              effect=rep(c("0.2"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d0.3_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.3_SMD$Median,
                              effect=rep(c("0.3"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d0.4_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.4_SMD$Median,
                              effect=rep(c("0.4"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d0.5_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.5_SMD$Median,
                              effect=rep(c("0.5"),12),
                              es_cat=rep(c("Hypothetical_es"),12))

d0.6_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.6_SMD$Median,
                              effect=rep(c("0.6"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d0.7_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.7_SMD$Median,
                              effect=rep(c("0.7"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d0.8_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.8_SMD$Median,
                              effect=rep(c("0.8"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d0.9_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d0.9_SMD$Median,
                              effect=rep(c("0.9"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


d1.0_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                              es=model_est_SMD$mu_SMD,
                              power=power_summary_d1.0_SMD$Median,
                              effect=rep(c("1.0"),12),
                              es_cat=rep(c("Hypothetical_es"),12))


MA.power_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                                 es=model_est_SMD$mu_SMD,
                                 power=model_est_SMD$MA.power,
                                 effect=rep(c("MAOM.MA"),12),
                                 es_cat=rep(c("c.MA.power"),12))


MA.power_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                                 es=model_est_adjusted_SMD$mu_SMD,
                                 power=model_est_adjusted_SMD$MA.power,
                            effect=rep(c("cMAOM.MA"),12),
                                 es_cat=rep(c("c.MA.power"),12))



power_firepower_SMD <- rbind( intercept_SMD,
                         intercept_adjusted_SMD,
                         blup_SMD,
                         blup_adjusted_SMD,
                         MA.power_SMD,
                         MA.power_adjusted_SMD
                         # d0.1_SMD,
                         # d0.2_SMD,
                         # d0.3_SMD,
                         # d0.4_SMD,
                         # d0.5_SMD,
                         # d0.6_SMD,
                         # d0.7_SMD,
                         # d0.8_SMD,
                         # d0.9_SMD,
                         # d1.0_SMD
                         )

power_firepower_SMD$number <- c(1:(6*12)) # for reorder

power_firepower_SMD$es <- abs(power_firepower_SMD$es)



firepower_plot_SMD <- ggplot(data = power_firepower_SMD) +
  geom_tile(aes(x = reorder(effect,number), y = reorder(MA_case,-es),fill = power)) +
  theme(aspect.ratio = 0.3) +
  scale_fill_gradient2(
    name = "Power",
    low = "#56B4E9",
    mid = "white",
    high = "#CC79A7",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") +
  theme(strip.text.x = element_blank()) + labs(x ="Global change effect (SMD)", y = "") + theme(axis.text.x = element_text(size = 10.5, colour = "black"),
                                         axis.text.y = element_text(size = 10.5, colour = "black"),
                                         axis.title.x = element_text(size = 10.5, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10.5),
                                         legend.title = element_text(size=10.5),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/firepower_plot_SMD.png", width = 8, height = 6, units = "in", type = "windows", res = 400)
firepower_plot_SMD 
dev.off()





intercept_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=c(power.F_summary_SMD$Median[1],
                              power.F_summary_SMD$Median[2],
                              power.F_summary_SMD$Median[3],
                              power.F_summary_SMD$Median[4],
                              100,
                              100,
                              power.F_summary_SMD$Median[5],
                              power.F_summary_SMD$Median[6],
                              power.F_summary_SMD$Median[7],
                              power.F_summary_SMD$Median[8],
                              power.F_summary_SMD$Median[9],
                              power.F_summary_SMD$Median[10],
                              100,
                              100,
                              100,
                              power.F_summary_SMD$Median[11],
                              100,
                              power.F_summary_SMD$Median[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                              effect=rep(c("Intercept (SMD)"),30),
                              es_cat=rep(c("Intercept_es"),30))

intercept_adjusted_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
          power=c(power.F_summary_adjusted_SMD$Median[1],
                              power.F_summary_adjusted_SMD$Median[2],
                              power.F_summary_adjusted_SMD$Median[3],
                              power.F_summary_adjusted_SMD$Median[4],
                              100,
                              100,
                              power.F_summary_adjusted_SMD$Median[5],
                              power.F_summary_adjusted_SMD$Median[6],
                              power.F_summary_adjusted_SMD$Median[7],
                              power.F_summary_adjusted_SMD$Median[8],
                              power.F_summary_adjusted_SMD$Median[9],
                              power.F_summary_adjusted_SMD$Median[10],
                              100,
                              100,
                              100,
                              power.F_summary_adjusted_SMD$Median[11],
                              100,
                              power.F_summary_adjusted_SMD$Median[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                              effect=rep(c("Intercept (adjusted SMD)"),30),
                            es_cat=rep(c("Intercept_es"),30))




blup_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                              power=c(power.R_summary_adjusted_SMD$Median[1],
                              power.R_summary_SMD$Median[2],
                              power.R_summary_SMD$Median[3],
                              power.R_summary_SMD$Median[4],
                              100,
                              100,
                              power.R_summary_SMD$Median[5],
                              power.R_summary_SMD$Median[6],
                              power.R_summary_SMD$Median[7],
                              power.R_summary_SMD$Median[8],
                              power.R_summary_SMD$Median[9],
                              power.R_summary_SMD$Median[10],
                              100,
                              100,
                              100,
                              power.R_summary_SMD$Median[11],
                              100,
                              power.R_summary_SMD$Median[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                              effect=rep(c("BLUP (SMD)"),30),
                              es_cat=rep(c("BLUP_es"),30))




blup_adjusted_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                      power=c(power.R_summary_adjusted_SMD$Median[1],
                              power.R_summary_adjusted_SMD$Median[2],
                              power.R_summary_adjusted_SMD$Median[3],
                              power.R_summary_adjusted_SMD$Median[4],
                              100,
                              100,
                              power.R_summary_adjusted_SMD$Median[5],
                              power.R_summary_adjusted_SMD$Median[6],
                              power.R_summary_adjusted_SMD$Median[7],
                              power.R_summary_adjusted_SMD$Median[8],
                              power.R_summary_adjusted_SMD$Median[9],
                              power.R_summary_adjusted_SMD$Median[10],
                              100,
                              100,
                              100,
                              power.R_summary_adjusted_SMD$Median[11],
                              100,
                              power.R_summary_adjusted_SMD$Median[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                      effect=rep(c("BLUP (adjusted SMD)"),30),
                              es_cat=rep(c("BLUP_es"),30))


MA.power_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                                 power=c(model_est_SMD$MA.power[1],
                              model_est_SMD$MA.power[2],
                              model_est_SMD$MA.power[3],
                              model_est_SMD$MA.power[4],
                              100,
                              100,
                              model_est_SMD$MA.power[5],
                              model_est_SMD$MA.power[6],
                              model_est_SMD$MA.power[7],
                              model_est_SMD$MA.power[8],
                              model_est_SMD$MA.power[9],
                              model_est_SMD$MA.power[10],
                              100,
                              100,
                              100,
                              model_est_SMD$MA.power[11],
                              100,
                              model_est_SMD$MA.power[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                                 effect=rep(c("MA (SMD)"),30),
                                 es_cat=rep(c("MA.power"),30))


MA.power_adjusted_SMD2 <- data.frame(MA_case=model_est_RR$MA_case,
                              es=model_est_RR$mu_RR,
                                 power=c(model_est_adjusted_SMD$MA.power[1],
                              model_est_adjusted_SMD$MA.power[2],
                              model_est_adjusted_SMD$MA.power[3],
                              model_est_adjusted_SMD$MA.power[4],
                              100,
                              100,
                              model_est_adjusted_SMD$MA.power[5],
                              model_est_adjusted_SMD$MA.power[6],
                              model_est_adjusted_SMD$MA.power[7],
                              model_est_adjusted_SMD$MA.power[8],
                              model_est_adjusted_SMD$MA.power[9],
                              model_est_adjusted_SMD$MA.power[10],
                              100,
                              100,
                              100,
                              model_est_adjusted_SMD$MA.power[11],
                              100,
                              model_est_adjusted_SMD$MA.power[12],
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100,
                              100),
                            effect=rep(c("MA (adjusted SMD)"),30),
                                 es_cat=rep(c("MA.power"),30))

power_firepower_RR_SMD <- rbind(intercept_RR,
                         intercept_adjusted_RR,
                         intercept_SMD2,
                         intercept_adjusted_SMD2,
                         blup_RR,
                         blup_adjusted_RR,
                         blup_SMD2,
                         blup_adjusted_SMD2,
                         MA.power_RR,
                         MA.power_adjusted_RR,
                         MA.power_SMD2,
                         MA.power_adjusted_SMD2
                          )



power_firepower_RR_SMD$number <- c(1:(12*30)) # for reorder

power_firepower_RR_SMD$es <- abs(power_firepower_RR_SMD$es)



firepower_plot_RR_SMD <- ggplot(data = power_firepower_RR_SMD) +
  geom_tile(aes(x = reorder(effect,number), y = reorder(MA_case,-es),fill = power)) +
  theme(aspect.ratio = 0.3) +
  scale_fill_gradient2(
    name = "Power",
    low = "#56B4E9",
    mid = "white",
    high = "#CC79A7",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") +
  theme(strip.text.x = element_blank()) # remove the text in strip.x

firepower_plot_RR_SMD <- firepower_plot_RR_SMD + labs(x ="Effect size", y = "") + theme(axis.text.x = element_text(size = 10.5, colour = "black"),
                                         axis.text.y = element_text(size = 10.5, colour = "black"),
                                         axis.title.x = element_text(size = 10.5, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10.5),
                                         legend.title = element_text(size=10.5),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/firepower_plot_RR_SMD.png", width = 18, height = 8, units = "in", type = "windows", res = 400)
firepower_plot_RR_SMD 
dev.off()










MA.type2_RR <- data.frame(MA_case=model_est_RR$MA_case,
                                 es=model_est_RR$mu_RR,
                                 error=1-model_est_RR$MA.power,
                                 effect=rep(c("Type 2"),30),
                                 es_cat=rep(c("MA.error2"),30))

MA.type2_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                                 es=model_est_adjusted_RR$mu_RR,                                 error=1-model_est_adjusted_RR$MA.power,
                                 effect=rep(c("Corrected Type 2"),30),                                 es_cat=rep(c("MA.error2"),30))


MA.typeS_RR <- data.frame(MA_case=model_est_RR$MA_case,
                                 es=model_est_RR$mu_RR,
                                 error=model_est_RR$MA.power.S,
                                 effect=rep(c("Type S"),30),
                                 es_cat=rep(c("MA.errorS"),30))


MA.typeS_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                                 es=model_est_adjusted_RR$mu_RR,
                               error=model_est_adjusted_RR$MA.power.S,
                                 effect=rep(c("Corrected Type S"),30),                                 es_cat=rep(c("MA.errorS"),30))

MA.typeM_RR <- data.frame(MA_case=model_est_RR$MA_case,
                                 es=model_est_RR$mu_RR,
                                 error=model_est_RR$MA.power.M2,
                                 effect=rep(c("Type M"),30),
                                 es_cat=rep(c("MA.errorM"),30))


MA.typeM_adjusted_RR <- data.frame(MA_case=model_est_adjusted_RR$MA_case,
                                 es=model_est_adjusted_RR$mu_RR,
                               error=model_est_adjusted_RR$MA.power.M2,
                                 effect=rep(c("Corrected Type M"),30),                                 es_cat=rep(c("MA.errorM"),30))


MA.power_RR <- rbind(MA.type2_RR, MA.type2_adjusted_RR, MA.typeS_RR, MA.typeS_adjusted_RR, MA.typeM_RR, MA.typeM_adjusted_RR)


MA.power_RR$number <- c(1:(6*30)) # for reorder


MA.firepower_plot_RR <- ggplot(data = MA.power_RR) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = reorder(MA_case,-es),
    fill = error
  )) +
  theme(aspect.ratio = 0.2) +
  scale_fill_gradient2(
    name = "Error",
    low = "#009E73",
    mid = "#0072B2",
    high = "red",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") + 
  theme(strip.text.x = element_blank()) + labs(x ="Statistical errors in detecting global change effect (lnRR)", y = "") + theme(axis.text.x = element_text(size = 10, colour = "black"),
                                         axis.text.y = element_text(size = 10, colour = "black"),
                                         axis.title.x = element_text(size = 10, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10),
                                         legend.title = element_text(size=10),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/MA.firepower_plot_RR.png", width = 8, height = 6, units = "in", type = "windows", res = 400)
MA.firepower_plot_RR 
dev.off()







MA.type2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                                 es=model_est_SMD$mu_SMD,
                                 error=1-model_est_SMD$MA.power,
                                 effect=rep(c("Type 2"),12),
                                 es_cat=rep(c("MA.error2"),12))

MA.type2_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                                 es=model_est_adjusted_SMD$mu_SMD,                                 error=1-model_est_adjusted_SMD$MA.power,
                                 effect=rep(c("Corrected Type 2"),12),                                 es_cat=rep(c("MA.error2"),12))


MA.typeS_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                                 es=model_est_SMD$mu_SMD,
                                 error=model_est_SMD$MA.power.S,
                                 effect=rep(c("Type S"),12),
                                 es_cat=rep(c("MA.errorS"),12))


MA.typeS_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                                 es=model_est_adjusted_SMD$mu_SMD,
                               error=model_est_adjusted_SMD$MA.power.S,
                                 effect=rep(c("Corrected Type S"),12),                                 es_cat=rep(c("MA.errorS"),12))


MA.typeM_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                                 es=model_est_SMD$mu_SMD,
                                 error=model_est_SMD$MA.power.M2,
                                 effect=rep(c("Type M"),12),
                                 es_cat=rep(c("MA.errorM"),12))


MA.typeM_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                                 es=model_est_adjusted_SMD$mu_SMD,
 error=model_est_adjusted_SMD$MA.power.M2,
                                 effect=rep(c("Corrected error M"),12),                                 es_cat=rep(c("MA.errorM"),12))


MA.power_SMD <- rbind(MA.type2_SMD, MA.type2_adjusted_SMD, MA.typeS_SMD, MA.typeS_adjusted_SMD, MA.typeM_SMD, MA.typeM_adjusted_SMD)


MA.power_SMD$number <- c(1:(6*12)) # for reorder


MA.firepower_plot_SMD <- ggplot(data = MA.power_SMD) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = reorder(MA_case,-es),
    fill = error
  )) +
  theme(aspect.ratio = 0.2) +
  scale_fill_gradient2(
    name = "Error",
    low = "#009E73",
    mid = "#0072B2",
    high = "red",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") + 
  theme(strip.text.x = element_blank()) + labs(x ="Statistical errors in detecting global chang effect (SMD)", y = "") + theme(axis.text.x = element_text(size = 10, colour = "black"),
                                         axis.text.y = element_text(size = 10, colour = "black"),
                                         axis.title.x = element_text(size = 10, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10),
                                         legend.title = element_text(size=10),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/MA.firepower_plot_SMD.png", width = 8, height = 6, units = "in", type = "windows", res = 400)
MA.firepower_plot_SMD 
dev.off()







MA.type2_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                                 es=model_est_CVR$mu_CVR,
                                 error=1-model_est_CVR$MA.power,
                                 effect=rep(c("Type 2"),12),
                                 es_cat=rep(c("MA.error2"),12))

MA.typeS_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                                 es=model_est_CVR$mu_CVR,
                                 error=model_est_CVR$MA.power.S,
                                 effect=rep(c("Type S"),12),
                                 es_cat=rep(c("MA.errorS"),12))

MA.typeM_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                                 es=model_est_CVR$mu_CVR,
                                 error=model_est_CVR$MA.power.M2,
                                 effect=rep(c("Type M"),12),
                                 es_cat=rep(c("MA.errorrM"),12))


MA.power_CVR <- rbind(MA.type2_CVR,MA.typeS_CVR, MA.typeM_CVR)


MA.power_CVR$number <- c(1:(3*12)) # for reorder


MA.firepower_plot_CVR <- ggplot(data = MA.power_CVR) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = reorder(MA_case,-es),
    fill = error
  )) +
  theme(aspect.ratio = 0.2) +
  scale_fill_gradient2(
    name = "Error",
    low = "#009E73",
    mid = "#0072B2",
    high = "red",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") + 
  theme(strip.text.x = element_blank()) + labs(x ="Statistical errors indetecting heteroscedasticity (lnCVR)", y = "") + theme(axis.text.x = element_text(size = 10, colour = "black"),
                                         axis.text.y = element_text(size = 10, colour = "black"),
                                         axis.title.x = element_text(size = 10, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10),
                                         legend.title = element_text(size=10),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in"))



png(filename = "./Figures/MA.firepower_plot_CVR.png", width = 6, height = 6, units = "in", type = "windows", res = 400)
MA.firepower_plot_CVR 
dev.off()






MA.type2_VR <- data.frame(MA_case=model_est_VR$MA_case,
                                 es=model_est_VR$mu_VR,
                                 error=1-model_est_VR$MA.power,
                                 effect=rep(c("Type 2"),12),
                                 es_cat=rep(c("MA.error2"),12))

MA.typeS_VR <- data.frame(MA_case=model_est_VR$MA_case,
                                 es=model_est_VR$mu_VR,
                                 error=model_est_VR$MA.power.S,
                                 effect=rep(c("Type S"),12),
                                 es_cat=rep(c("MA.errorS"),12))

MA.typeM_VR <- data.frame(MA_case=model_est_VR$MA_case,
                                 es=model_est_VR$mu_VR,
                                 error=model_est_VR$MA.power.M2,
                                 effect=rep(c("Type M"),12),
                                 es_cat=rep(c("MA.errorrM"),12))


MA.power_VR <- rbind(MA.type2_VR,MA.typeS_VR, MA.typeM_VR)


MA.power_VR$number <- c(1:(3*12)) # for reorder


MA.firepower_plot_VR <- ggplot(data = MA.power_VR) +
  geom_tile(aes(
    x = reorder(effect,number), #### I added number, without number, the order of effect is very strange
    y = reorder(MA_case,-es),
    fill = error
  )) +
  theme(aspect.ratio = 0.2) +
  scale_fill_gradient2(
    name = "Error",
    low = "#009E73",
    mid = "#0072B2",
    high = "red",
    midpoint = 0.5,
    limits = c(0,1),
    guide = "colourbar",
  ) + 
  facet_grid( ~ es_cat, scale = 'free_x', space = "free_x") +
  theme_tufte(base_family = "Helvetica") + 
  theme(strip.text.x = element_blank()) +  labs(x ="Statistical errors indetecting heteroscedasticity (lnVR)", y = "") + theme(axis.text.x = element_text(size = 10, colour = "black"),
                                         axis.text.y = element_text(size = 10, colour = "black"),
                                         axis.title.x = element_text(size = 10, colour = "black", face = "bold"),
                                         legend.text = element_text(size=10),
                                         legend.title = element_text(size=10),
                                         #legend.key.width = ,
                                         legend.key.height = unit(0.5,"in")) +
  theme(legend.position = "none")



png(filename = "./Figures/MA.firepower_plot_VR.png", width = 6, height = 6, units = "in", type = "windows", res = 400)
MA.firepower_plot_VR 
dev.off()


expression(paste("Overestimate\nratio"))



ggarrange(MA.firepower_plot_CVR,MA.firepower_plot_VR, heights = c(5,5), widths = c(5,5), nrow = 1, ncol = 2, align = "h") -> MA.firepower_plot_CVR_VR

png(filename = "./Figures/MA.firepower_plot_CVR_VR.png", width = 16, height = 10, units = "in", type = "windows", res = 400)
MA.firepower_plot_CVR_VR
dev.off()





# creat function for equivalence test
eqTmeta <- function(mu,se,l_eqbound,h_eqbound,alpha=0.05) {
z_low_TOST <- (mu + l_eqbound) / se
z_high_TOST <- (mu + h_eqbound) / se
p_low_TOST <- pnorm(-abs(z_low_TOST)) # lower tail
p_high_TOST <- pnorm(abs(z_high_TOST)) # upper tail
LL_CI_TOST <- mu - qnorm(1-alpha, lower.tail = T)*se # one-tail
UL_CI_TOST <- mu + qnorm(1-alpha, lower.tail = T)*se # one-tail
return(data.frame(LL_CI_TOST = LL_CI_TOST,
       UL_CI_TOST = UL_CI_TOST))
 }
 
# require(TOSTER)
#   ET_d10_RR <- TOSTmeta(ES = model_est_RR$mu_RR,se = model_est_RR$SE_RR,low_eqbound_d = -log(110/100),high_eqbound_d =log(110/100), plot = FALSE) %>% as.data.frame() # Perform an equivalence test



eqt_d10_RR <- eqTmeta(
        mu = model_est_RR$mu_RR,
        se = model_est_RR$SE_RR,
        l_eqbound = -log(110/100),
        h_eqbound = log(110/100)
        )

model_est_RR$ll_eqt_d10 <- eqt_d10_RR$LL_CI_TOST
model_est_RR$ul_eqt_d10 <- eqt_d10_RR$UL_CI_TOST 
 


eqt_d20_RR <- eqTmeta(
        mu = model_est_RR$mu_RR,
        se = model_est_RR$SE_RR,
        l_eqbound = -log(120/100),
        h_eqbound = log(120/100)
        )

model_est_RR$ll_eqt_d20 <- eqt_d20_RR$LL_CI_TOST
model_est_RR$ul_eqt_d20 <- eqt_d20_RR$UL_CI_TOST 
       
  
eqt_d40_RR <- eqTmeta(
        mu = model_est_RR$mu_RR,
        se = model_est_RR$SE_RR,
        l_eqbound = -log(140/100),
        h_eqbound = log(140/100)
        )

model_est_RR$ll_eqt_d40 <- eqt_d40_RR$LL_CI_TOST
model_est_RR$ul_eqt_d40 <- eqt_d40_RR$UL_CI_TOST 
       



model_est_RR$powered <- if_else(model_est_RR$MA.power>0.8, "Powered", "Underpowered")

forest_plot_enhanced_RR <-
      ggplot(model_est_RR,aes(x = reorder(MA_case, -mu_RR), y = mu_RR, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
    #annotate("rect", xmin = -Inf, ymin = -log(110/100), xmax = Inf, ymax = log(110/100), fill = "#CC79A7", alpha = 0.18) +
    #annotate("rect", xmin = -Inf, ymin = -log(120/100), xmax = Inf, ymax = log(120/100), fill = "#CC79A7", alpha = 0.15) +
    #annotate("rect", xmin = -Inf, ymin = -log(140/100), xmax = Inf, ymax = log(140/100), fill = "#CC79A7", alpha = 0.1) +
    # annotate("rect", xmin = -Inf, ymin = -log(160/100), xmax = Inf, ymax = log(160/100), fill = "#D55E00", alpha = 0.1) +
      # geom_point(color = "black",shape = 18, size = 4) +
      # geom_point(shape = 21, fill = "black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      #geom_linerange(aes(ymin = ll_eqt_d10, ymax = ul_eqt_d10), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d20, ymax = ul_eqt_d20), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d40, ymax = ul_eqt_d40), size = 1.2, colour = "black") + 
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of effects in the field of global change biology", x=" ", y=expression("Overall meta-analytic estimate (lnRR)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-1.2,1.2), breaks =seq(-1,1,by=0.5))


 
png(filename = "./Figures/forest_plot_enhanced_RR.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_RR
dev.off()    
       




forest_plot_enhanced_adjusted_RR <-
      ggplot(model_est_adjusted_RR,aes(x = reorder(MA_case, -mu_RR), y = mu_RR, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
    #annotate("rect", xmin = -Inf, ymin = -log(110/100), xmax = Inf, ymax = log(110/100), fill = "#CC79A7", alpha = 0.18) +
    #annotate("rect", xmin = -Inf, ymin = -log(120/100), xmax = Inf, ymax = log(120/100), fill = "#CC79A7", alpha = 0.15) +
    #annotate("rect", xmin = -Inf, ymin = -log(140/100), xmax = Inf, ymax = log(140/100), fill = "#CC79A7", alpha = 0.1) +
    # annotate("rect", xmin = -Inf, ymin = -log(160/100), xmax = Inf, ymax = log(160/100), fill = "#D55E00", alpha = 0.1) +
      # geom_point(color = "black",shape = 18, size = 4) +
      # geom_point(shape = 21, fill = "black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      #geom_linerange(aes(ymin = ll_eqt_d10, ymax = ul_eqt_d10), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d20, ymax = ul_eqt_d20), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d40, ymax = ul_eqt_d40), size = 1.2, colour = "black") + 
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of effects in the field of global change biology", x=" ", y=expression("Corrected meta-analytic estimate (lnRR)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-1.2,1.2), breaks =seq(-1,1,by=0.5))


 
png(filename = "./Figures/forest_plot_enhanced_adjusted_RR.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_adjusted_RR
dev.off()  





     et_plot_combine <-
      et_plot_combine + geom_linerange(aes(ymin = UL_CI_ZTEST, ymax = LL_CI_ZTEST), 
                                       size = 0.5,
                                       colour = "red")
    et_plot_combine <-
      et_plot_combine + geom_linerange(aes(ymin = UL_CI_TOST, ymax = LL_CI_TOST),
                                       size = 1.5,
                                       colour = "black")
      et_plot_combine + scale_y_continuous(breaks=c(-1, -.5, 0, .5, 1))
    et_plot_combine <-
      et_plot_combine + geom_hline(yintercept=0, linetype="dashed", color = "black")
    et_plot_combine # Creates an equivalence test plot




    

    
forest_plot_enhanced_SMD <-
      ggplot(model_est_SMD,aes(x = reorder(MA_case, -mu_SMD), y = mu_SMD, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of effects in the field of global change biology", x=" ", y=expression("Overall meta-analytic estimate (SMD)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-4,8), breaks =seq(-4,8,by=2))


 
png(filename = "./Figures/forest_plot_enhanced_SMD.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_SMD
dev.off()    
       




forest_plot_enhanced_adjusted_SMD <-
      ggplot(model_est_adjusted_SMD,aes(x = reorder(MA_case, -mu_SMD), y = mu_SMD, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of effects in the field of global change biology", x=" ", y=expression("Corrected meta-analytic estimate (SMD)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-4,8), breaks =seq(-4,8,by=2))


 
png(filename = "./Figures/forest_plot_enhanced_adjusted_SMD.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_adjusted_SMD
dev.off()      
    
    
        
    
 ggarrange(forest_plot_enhanced_SMD,forest_plot_enhanced_adjusted_SMD, heights = c(5,5), widths = c(5,5), nrow = 1, ncol = 2, align = "h") -> forest_plot_enhanced_SMD_SMD_adjusted

png(filename = "./Figures/forest_plot_enhanced_SMD_SMD_adjusted.png", width = 10, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_SMD_SMD_adjusted
dev.off()   
    
    
    
    
    
eqt_d10_CVR <- eqTmeta(
        mu = model_est_CVR$mu_CVR,
        se = model_est_CVR$SE_CVR,
        l_eqbound = -log(110/100),
        h_eqbound = log(110/100)
        )

model_est_CVR$ll_eqt_d10 <- eqt_d10_CVR$LL_CI_TOST
model_est_CVR$ul_eqt_d10 <- eqt_d10_CVR$UL_CI_TOST 
 

eqt_d20_CVR <- eqTmeta(
        mu = model_est_CVR$mu_CVR,
        se = model_est_CVR$SE_CVR,
        l_eqbound = -log(120/100),
        h_eqbound = log(120/100)
        )

model_est_CVR$ll_eqt_d20 <- eqt_d20_CVR$LL_CI_TOST
model_est_CVR$ul_eqt_d20 <- eqt_d20_CVR$UL_CI_TOST 
       
  
eqt_d40_CVR <- eqTmeta(
        mu = model_est_CVR$mu_CVR,
        se = model_est_CVR$SE_CVR,
        l_eqbound = -log(140/100),
        h_eqbound = log(140/100)
        )

model_est_CVR$ll_eqt_d40 <- eqt_d40_CVR$LL_CI_TOST
model_est_CVR$ul_eqt_d40 <- eqt_d40_CVR$UL_CI_TOST 
       



model_est_CVR$powered <- if_else(model_est_CVR$MA.power>0.8, "Powered", "Underpowered")

forest_plot_enhanced_CVR <-
      ggplot(model_est_CVR,aes(x = reorder(MA_case, -mu_CVR), y = mu_CVR, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
    #annotate("rect", xmin = -Inf, ymin = -log(110/100), xmax = Inf, ymax = log(110/100), fill = "#CC79A7", alpha = 0.18) +
    #annotate("rect", xmin = -Inf, ymin = -log(120/100), xmax = Inf, ymax = log(120/100), fill = "#CC79A7", alpha = 0.15) +
    #annotate("rect", xmin = -Inf, ymin = -log(140/100), xmax = Inf, ymax = log(140/100), fill = "#CC79A7", alpha = 0.1) +
    # annotate("rect", xmin = -Inf, ymin = -log(160/100), xmax = Inf, ymax = log(160/100), fill = "#D55E00", alpha = 0.1) +
      # geom_point(color = "black",shape = 18, size = 4) +
      # geom_point(shape = 21, fill = "black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      #geom_linerange(aes(ymin = ll_eqt_d10, ymax = ul_eqt_d10), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d20, ymax = ul_eqt_d20), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d40, ymax = ul_eqt_d40), size = 1.2, colour = "black") + 
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of heteroscedasticity in the field of global change biology", x=" ", y=expression("Unequal relative variability (lnCVR)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-1.2,1.2), breaks =seq(-1,1,by=0.5))


png(filename = "./Figures/forest_plot_enhanced_CVR.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_CVR
dev.off()        
    
    
    
    

eqt_d10_VR <- eqTmeta(
        mu = model_est_VR$mu_VR,
        se = model_est_VR$SE_VR,
        l_eqbound = -log(110/100),
        h_eqbound = log(110/100)
        )

model_est_VR$ll_eqt_d10 <- eqt_d10_VR$LL_CI_TOST
model_est_VR$ul_eqt_d10 <- eqt_d10_VR$UL_CI_TOST 
 

eqt_d20_VR <- eqTmeta(
        mu = model_est_VR$mu_VR,
        se = model_est_VR$SE_VR,
        l_eqbound = -log(120/100),
        h_eqbound = log(120/100)
        )

model_est_VR$ll_eqt_d20 <- eqt_d20_VR$LL_CI_TOST
model_est_VR$ul_eqt_d20 <- eqt_d20_VR$UL_CI_TOST 
       
  
eqt_d40_VR <- eqTmeta(
        mu = model_est_VR$mu_VR,
        se = model_est_VR$SE_VR,
        l_eqbound = -log(140/100),
        h_eqbound = log(140/100)
        )

model_est_VR$ll_eqt_d40 <- eqt_d40_VR$LL_CI_TOST
model_est_VR$ul_eqt_d40 <- eqt_d40_VR$UL_CI_TOST 
       



model_est_VR$powered <- if_else(model_est_VR$MA.power>0.8, "Powered", "Underpowered")

forest_plot_enhanced_VR <-
      ggplot(model_est_VR,aes(x = reorder(MA_case, -mu_VR), y = mu_VR, size = MA.power.M)) +
      geom_hline(yintercept = 0, lty="dashed",lwd=0.5, colour="black") +
    #annotate("rect", xmin = -Inf, ymin = -log(110/100), xmax = Inf, ymax = log(110/100), fill = "#CC79A7", alpha = 0.18) +
    #annotate("rect", xmin = -Inf, ymin = -log(120/100), xmax = Inf, ymax = log(120/100), fill = "#CC79A7", alpha = 0.15) +
    #annotate("rect", xmin = -Inf, ymin = -log(140/100), xmax = Inf, ymax = log(140/100), fill = "#CC79A7", alpha = 0.1) +
    # annotate("rect", xmin = -Inf, ymin = -log(160/100), xmax = Inf, ymax = log(160/100), fill = "#D55E00", alpha = 0.1) +
      # geom_point(color = "black",shape = 18, size = 4) +
      # geom_point(shape = 21, fill = "black") +
      geom_linerange(aes(ymin = ll_NHST, ymax = ul_NHST), size = 0.5, colour = "black") +
      #geom_linerange(aes(ymin = ll_eqt_d10, ymax = ul_eqt_d10), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d20, ymax = ul_eqt_d20), size = 1.2, colour = "black") + 
      #geom_linerange(aes(ymin = ll_eqt_d40, ymax = ul_eqt_d40), size = 1.2, colour = "black") + 
      geom_point(shape = 21, fill = "black") +
      theme(axis.text.x = element_text(size = 8)) +
      coord_flip() +
      #theme_minimal() +
      theme(strip.text = element_text(size = 8, face = "bold",angle = 90
      )) +
      theme(strip.background = element_rect(colour = "black", fill = "white")) +
      theme(panel.background = element_rect(fill = NA)) +
      theme(axis.title.y = element_text(face = "bold", size = 12)) +
      theme(axis.title.x = element_text(face = "bold", size = 12),
            plot.title = element_text(size = 5)) +
      theme(axis.title.y = element_blank(),
            #axis.line = element_line(size = 0.8,color = 'black'),
            axis.ticks = element_line(size = 0.5, color = 'black'),
            axis.ticks.length = unit(0.15, 'cm'),
            panel.border = element_rect(size = 0.8,colour = "black",fill = NA)) + 
     theme(legend.position = c(1, 0.95), legend.justification = c(1, 0.95),
           legend.text = element_text(size=10),
           legend.title = element_text(size=10),
           legend.direction = "vertical",
           legend.background = element_rect(fill = NA)) + 
     labs(title = "The exaggeration ratio of heteroscedasticity in the field of global change biology", x=" ", y=expression("Unequal absolute variability (lnVR)"),size=expression(paste("Overestimate\nratio"))) + 
     # theme_bw() +
     theme(plot.title = element_text(colour = 'black', size = 8, face = 'bold')) +
  scale_y_continuous(limits = c(-1.2,1.2), breaks =seq(-1,1,by=0.5))



 
png(filename = "./Figures/forest_plot_enhanced_VR.png", width = 5, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_VR
dev.off()     
    




ggarrange(forest_plot_enhanced_CVR,forest_plot_enhanced_VR, heights = c(5,5), widths = c(5,5), nrow = 1, ncol = 2, align = "h") -> forest_plot_enhanced_CVR_VR

png(filename = "./Figures/forest_plot_enhanced_CVR_VR.png", width = 10, height = 6, units = "in", type = "windows", res = 400)
forest_plot_enhanced_CVR_VR
dev.off()

    





    

violin_data_RR <- data.frame(MA_case=c(rep("m1_1",length(power.F_RR[[1]])),
                                    rep("m1_2",length(power.F_RR[[2]])),
                                    rep("m2_1",length(power.F_RR[[3]])),
                                    rep("m2_2",length(power.F_RR[[4]])),
                                    rep("m3_1",length(power.F_RR[[5]])),
                                    rep("m4_1",length(power.F_RR[[6]])),
                                    rep("m5_1",length(power.F_RR[[7]])),
                                    rep("m6_1",length(power.F_RR[[8]])),
                                    rep("m6_2",length(power.F_RR[[9]])),
                                    rep("m6_3",length(power.F_RR[[10]])),
                                    rep("m6_4",length(power.F_RR[[11]])),
                                    rep("m6_5",length(power.F_RR[[12]])),
                                    rep("m7_1",length(power.F_RR[[13]])),
                                    rep("m7_2",length(power.F_RR[[14]])),
                                    rep("m8_1",length(power.F_RR[[15]])),
                                    rep("m9_1",length(power.F_RR[[16]])),
                                    rep("m10_1",length(power.F_RR[[17]])),
                                    rep("m11_1",length(power.F_RR[[18]])),
                                    rep("m12_1",length(power.F_RR[[19]])),
                                    rep("m13_1",length(power.F_RR[[20]])),
                                    rep("m13_2",length(power.F_RR[[21]])),
                                    rep("m14_1",length(power.F_RR[[22]])),
                                    rep("m14_2",length(power.F_RR[[23]])),
                                    rep("m14_3",length(power.F_RR[[24]])),
                                    rep("m15_1",length(power.F_RR[[25]])),
                                    rep("m16_1",length(power.F_RR[[26]])),
                                    rep("m16_2",length(power.F_RR[[27]])),
                                    rep("m20_1",length(power.F_RR[[28]])),
                                    rep("m23_1",length(power.F_RR[[29]])),
                                    rep("m24_1",length(power.F_RR[[30]]))),
                          power=power.F_RR[1:30] %>% unlist())     
    



violin_data_RR$number <- 1:nrow(violin_data_RR)

power_manhattan_RR <- ggplot(violin_data_RR, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_RR$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(title="Naive lnRR",x="Meta-analytic cases",y="Power for lnRR of studies within meta-analyses") +
  theme(#panel.background = element_rect(fill = NA),
        axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))
  
 

    

png(filename = "./Figures/power_manhattan_RR.png", width = 18, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_RR
dev.off()




violin_data_adjusted_RR <- data.frame(MA_case=c(rep("m1_1",length(power.F_RR[[1]])),
                                    rep("m1_2",length(power.F_RR[[2]])),
                                    rep("m2_1",length(power.F_RR[[3]])),
                                    rep("m2_2",length(power.F_RR[[4]])),
                                    rep("m3_1",length(power.F_RR[[5]])),
                                    rep("m4_1",length(power.F_RR[[6]])),
                                    rep("m5_1",length(power.F_RR[[7]])),
                                    rep("m6_1",length(power.F_RR[[8]])),
                                    rep("m6_2",length(power.F_RR[[9]])),
                                    rep("m6_3",length(power.F_RR[[10]])),
                                    rep("m6_4",length(power.F_RR[[11]])),
                                    rep("m6_5",length(power.F_RR[[12]])),
                                    rep("m7_1",length(power.F_RR[[13]])),
                                    rep("m7_2",length(power.F_RR[[14]])),
                                    rep("m8_1",length(power.F_RR[[15]])),
                                    rep("m9_1",length(power.F_RR[[16]])),
                                    rep("m10_1",length(power.F_RR[[17]])),
                                    rep("m11_1",length(power.F_RR[[18]])),
                                    rep("m12_1",length(power.F_RR[[19]])),
                                    rep("m13_1",length(power.F_RR[[20]])),
                                    rep("m13_2",length(power.F_RR[[21]])),
                                    rep("m14_1",length(power.F_RR[[22]])),
                                    rep("m14_2",length(power.F_RR[[23]])),
                                    rep("m14_3",length(power.F_RR[[24]])),
                                    rep("m15_1",length(power.F_RR[[25]])),
                                    rep("m16_1",length(power.F_RR[[26]])),
                                    rep("m16_2",length(power.F_RR[[27]])),
                                    rep("m20_1",length(power.F_RR[[28]])),
                                    rep("m23_1",length(power.F_RR[[29]])),
                                    rep("m24_1",length(power.F_RR[[30]]))),
                          power=power.F_RR[1:30] %>% unlist()) 



violin_data_adjusted_RR$number <- 1:nrow(violin_data_adjusted_RR)

power_manhattan_adjusted_RR <- ggplot(violin_data_adjusted_RR, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_RR$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(title="Adjusted lnRR",x="Meta-analytic cases",y="Power for adjusted lnRR of studies within meta-analyses") +
  theme(#panel.background = element_rect(fill = NA),
        axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))
  
 

    

png(filename = "./Figures/power_manhattan_adjusted_RR.png", width = 18, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_adjusted_RR
dev.off()





violin_data_RR2 <- data.frame(MA_case=c(rep("m1_1",length(dat_list_adjusted[[1]]$power.F_RR)),
                                    rep("m1_2",length(dat_list_adjusted[[2]]$power.F_RR)),
                                    rep("m2_1",length(dat_list_adjusted[[3]]$power.F_RR)),
                                    rep("m2_2",length(dat_list_adjusted[[4]]$power.F_RR)),
                                    rep("m5_1",length(dat_list_adjusted[[7]]$power.F_RR)),
                                    rep("m6_1",length(dat_list_adjusted[[8]]$power.F_RR)),
                                    rep("m6_2",length(dat_list_adjusted[[9]]$power.F_RR)),
                                    rep("m6_3",length(dat_list_adjusted[[10]]$power.F_RR)),
                                    rep("m6_4",length(dat_list_adjusted[[11]]$power.F_RR)),
                                    rep("m6_5",length(dat_list_adjusted[[12]]$power.F_RR)),
                                    rep("m9_1",length(dat_list_adjusted[[16]]$power.F_RR)),
                                    rep("m11_1",length(dat_list_adjusted[[18]]$power.F_RR))),
                              
                          power=c(dat_list_adjusted[[1]]$power.F_RR,
                                  dat_list_adjusted[[2]]$power.F_RR,
                                  dat_list_adjusted[[3]]$power.F_RR,
                                  dat_list_adjusted[[4]]$power.F_RR,
                                  dat_list_adjusted[[7]]$power.F_RR,
                                  dat_list_adjusted[[8]]$power.F_RR,
                                  dat_list_adjusted[[9]]$power.F_RR,
                                  dat_list_adjusted[[10]]$power.F_RR,
                                  dat_list_adjusted[[11]]$power.F_RR,
                                  dat_list_adjusted[[12]]$power.F_RR,
                                  dat_list_adjusted[[16]]$power.F_RR,
                                  dat_list_adjusted[[18]]$power.F_RR))    



violin_data_SMD2 <- data.frame(MA_case=c(rep("m1_1",length(dat_list_adjusted_SMD[[1]]$power.F_adjusted_SMD)),
                                    rep("m1_2",length(dat_list_adjusted_SMD[[2]]$power.F_adjusted_SMD)),
                                    rep("m2_1",length(dat_list_adjusted_SMD[[3]]$power.F_adjusted_SMD)),
                                    rep("m2_2",length(dat_list_adjusted_SMD[[4]]$power.F_adjusted_SMD)),
                                    rep("m5_1",length(dat_list_adjusted_SMD[[5]]$power.F_adjusted_SMD)),
                                    rep("m6_1",length(dat_list_adjusted_SMD[[6]]$power.F_adjusted_SMD)),
                                    rep("m6_2",length(dat_list_adjusted_SMD[[7]]$power.F_adjusted_SMD)),
                                    rep("m6_3",length(dat_list_adjusted_SMD[[8]]$power.F_adjusted_SMD)),
                                    rep("m6_4",length(dat_list_adjusted_SMD[[9]]$power.F_adjusted_SMD)),
                                    rep("m6_5",length(dat_list_adjusted_SMD[[10]]$power.F_adjusted_SMD)),
                                    rep("m9_1",length(dat_list_adjusted_SMD[[11]]$power.F_adjusted_SMD)),
                                    rep("m11_1",length(dat_list_adjusted_SMD[[12]]$power.F_adjusted_SMD))),
                              
                          power=c(dat_list_adjusted_SMD[[1]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[2]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[3]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[4]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[5]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[6]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[7]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[8]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[9]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[10]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[11]]$power.F_adjusted_SMD,
                                  dat_list_adjusted_SMD[[12]]$power.F_adjusted_SMD))







violin_data_RR2$number <- 1:nrow(violin_data_RR2)

power_manhattan_RR2 <- ggplot(violin_data_RR2, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_RR$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(x="Meta-analytic cases", y="Power for lnRR of studies within meta-analyses", title = "lnRR - intercept as true effect") +
  theme(axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12)) +
  coord_flip()


png(filename = "./Figures/power_manhattan_RR2.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_RR2
dev.off()





violin_data_SMD <- data.frame(MA_case=c(rep("m1_1",length(power.F_SMD[[1]])),
                                    rep("m1_2",length(power.F_SMD[[2]])),
                                    rep("m2_1",length(power.F_SMD[[3]])),
                                    rep("m2_2",length(power.F_SMD[[4]])),
                                    rep("m5_1",length(power.F_SMD[[5]])),
                                    rep("m6_1",length(power.F_SMD[[6]])),
                                    rep("m6_2",length(power.F_SMD[[7]])),
                                    rep("m6_3",length(power.F_SMD[[8]])),
                                    rep("m6_4",length(power.F_SMD[[9]])),
                                    rep("m6_5",length(power.F_SMD[[10]])),
                                    rep("m9_1",length(power.F_SMD[[11]])),
                                    rep("m11_1",length(power.F_SMD[[12]]))),
                          power=power.F_SMD[1:12] %>% unlist())    


violin_data_SMD$number <- 1:nrow(violin_data_SMD)

power_manhattan_SMD <- ggplot(violin_data_SMD, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_SMD$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(x="Meta-analytic cases", y="Power to detect SMD of studies within meta-analyses", title = "SMD") +
  theme(axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))


png(filename = "./Figures/power_manhattan_SMD.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_SMD
dev.off()





violin_data_adjusted_SMD <- data.frame(MA_case=c(rep("m1_1",length(power.F_adjusted_SMD[[1]])),
                                    rep("m1_2",length(power.F_adjusted_SMD[[2]])),
                                    rep("m2_1",length(power.F_adjusted_SMD[[3]])),
                                    rep("m2_2",length(power.F_adjusted_SMD[[4]])),
                                    rep("m5_1",length(power.F_adjusted_SMD[[5]])),
                                    rep("m6_1",length(power.F_adjusted_SMD[[6]])),
                                    rep("m6_2",length(power.F_adjusted_SMD[[7]])),
                                    rep("m6_3",length(power.F_adjusted_SMD[[8]])),
                                    rep("m6_4",length(power.F_adjusted_SMD[[9]])),
                                    rep("m6_5",length(power.F_adjusted_SMD[[10]])),
                                    rep("m9_1",length(power.F_adjusted_SMD[[11]])),
                                    rep("m11_1",length(power.F_adjusted_SMD[[12]]))),
                          power=power.F_adjusted_SMD[1:12] %>% unlist())    


violin_data_adjusted_SMD$number <- 1:nrow(violin_data_adjusted_SMD)

power_manhattan_adjusted_SMD <- ggplot(violin_data_adjusted_SMD, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_adjusted_SMD$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(x="Meta-analytic cases", y="Adjusted power to detect SMD of studies within meta-analyses", title = "Adjusted SMD") +
  theme(axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))


png(filename = "./Figures/power_manhattan_adjusted_SMD.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_adjusted_SMD
dev.off()




violin_data_CVR <- data.frame(MA_case=c(rep("m1_1",length(power.F_CVR[[1]])),
                                    rep("m1_2",length(power.F_CVR[[2]])),
                                    rep("m2_1",length(power.F_CVR[[3]])),
                                    rep("m2_2",length(power.F_CVR[[4]])),
                                    rep("m5_1",length(power.F_CVR[[5]])),
                                    rep("m6_1",length(power.F_CVR[[6]])),
                                    rep("m6_2",length(power.F_CVR[[7]])),
                                    rep("m6_3",length(power.F_CVR[[8]])),
                                    rep("m6_4",length(power.F_CVR[[9]])),
                                    rep("m6_5",length(power.F_CVR[[10]])),
                                    rep("m9_1",length(power.F_CVR[[11]])),
                                    rep("m11_1",length(power.F_CVR[[12]]))),
                          power=power.F_CVR[1:12] %>% unlist())    


violin_data_CVR$number <- 1:nrow(violin_data_CVR)

power_manhattan_CVR <- ggplot(violin_data_CVR, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_CVR$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(x=" ", y="Power to heteroscedasticity of studies within meta-analyses", title = "Relative variability (lnCVR)") +
  theme(axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))


png(filename = "./Figures/power_manhattan_CVR.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_CVR
dev.off()




violin_data_VR <- data.frame(MA_case=c(rep("m1_1",length(power.F_VR[[1]])),
                                    rep("m1_2",length(power.F_VR[[2]])),
                                    rep("m2_1",length(power.F_VR[[3]])),
                                    rep("m2_2",length(power.F_VR[[4]])),
                                    rep("m5_1",length(power.F_VR[[5]])),
                                    rep("m6_1",length(power.F_VR[[6]])),
                                    rep("m6_2",length(power.F_VR[[7]])),
                                    rep("m6_3",length(power.F_VR[[8]])),
                                    rep("m6_4",length(power.F_VR[[9]])),
                                    rep("m6_5",length(power.F_VR[[10]])),
                                    rep("m9_1",length(power.F_VR[[11]])),
                                    rep("m11_1",length(power.F_VR[[12]]))),
                          power=power.F_VR[1:12] %>% unlist())    


violin_data_VR$number <- 1:nrow(violin_data_VR)

power_manhattan_VR <- ggplot(violin_data_VR, aes(x=reorder(MA_case, number), y=power)) +
  geom_jitter(aes(color=MA_case)) +
  theme(legend.position = "none") +
  geom_hline(yintercept = 0.8, lty="dashed") +
  geom_hline(yintercept = MMA_power.F_VR$beta) +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,by=0.2)) +
  labs(x=" ", y="Power to heteroscedasticity of studies within meta-analyses", title = "Absolute variability (lnVR)") +
  theme(axis.text = element_text(color = "black", size = 12),
        axis.title = element_text(color = "black", size = 12))


png(filename = "./Figures/power_manhattan_VR.png", width = 10, height = 8, units = "in", type = "windows", res = 400)
power_manhattan_VR
dev.off()




power_manhattan_RR / (power_manhattan_CVR+power_manhattan_VR) + plot_layout() -> individual_power_intercept2 

png(filename = "./Figures/individual_power_intercept2.png", width = 16, height = 10, units = "in", type = "windows", res = 400)
individual_power_intercept2
dev.off()


power_manhattan_RR | (power_manhattan_CVR/power_manhattan_VR) + plot_layout() -> individual_power_intercept3

png(filename = "./Figures/individual_power_intercept3.png", width = 10, height = 16, units = "in", type = "windows", res = 400)
individual_power_intercept3
dev.off()


# intercept
ggarrange(power_manhattan_RR2,power_manhattan_CVR,power_manhattan_VR, heights = c(5,5,5), widths = c(5,5,5), nrow = 3, ncol = 1, align = "v") -> individual_power_intercept

png(filename = "./Figures/individual_power_intercept.png", width = 16, height = 10, units = "in", type = "windows", res = 400)
individual_power_intercept
dev.off()


# blup
ggarrange(power_manhattan_RR2,power_manhattan_CVR,power_manhattan_VR, heights = c(5,5,5), widths = c(5,5,5), nrow = 3, ncol = 1, align = "v") -> individual_power_blup

png(filename = "./Figures/individual_power_blup.png", width = 8, height = 15, units = "in", type = "windows", res = 400)
individual_power_blup
dev.off()

  



power_violin <- ggplot(violin_data, aes(x=MA_case, y=power, color = MA_case)) +
  geom_violin(aes(fill = MA_case), trim=FALSE, show.legend = T) + 
  geom_jitter(shape=16, position=position_jitter(0.1)) +
  labs(y = "Power", x = "Meta-analytic cases", fill='MA_case') + 
  geom_hline(yintercept = 0.5, linetype="dashed", lwd=1, color="red") +
  theme(legend.title = element_text(size = 10)) +
  labs(title = "Violin")



power_boxplot <- ggplot(violin_data, aes(x=MA_case, y=power, color = MA_case)) +
  geom_boxplot(aes(fill = MA_case), show.legend = T) + 
  geom_jitter(shape=16, position=position_jitter(0.1)) +
  labs(y = "Power", x = "Meta-analytic cases", fill='MA_case') + 
  geom_hline(yintercept = 0.5, linetype="dashed", lwd=1, color="red") +
  theme(legend.title = element_text(size = 10)) +
  labs(title = "Boxplot")



ggarrange(power_violin,power_boxplot, heights = c(5,5), widths = c(5,5), align = "h") -> individual_power

png(filename = "./Figures/individual_power.png", width = 10, height = 5, units = "in", type = "windows", res = 400)
individual_power
dev.off()




  scale_fill_manual(breaks = c("One", "AV", "MLM", "RVE", "CS", "Papers_df", "SW_df", "Bayes"), 
                   values=c(rgb(0.9,0.6,0),rgb(0.8,0.4,0),rgb(0,0.45,0.7),rgb(0.35,0.7,0.9), rgb(0.35,0.6,0.8), rgb(0.35,0.5,0.5), rgb(0.40,0.5,0.8), rgb(0.40,0.2,0.3), rgb(0.8,0.1,0.1), rgb(0.8,0.1,0.4))) + 
  theme_classic() + 
  geom_hline(yintercept = 5, linetype = "dashed", colour = "darkgrey") +
  theme(axis.text.x = element_blank())    
    
    
    
    


background.colour <- 'white'

hypothesis.theme <- theme(panel.background = element_rect(fill = background.colour),
                        plot.background = element_rect(fill = background.colour),
                        panel.grid = element_blank(),
                        panel.border = element_rect(size = 1.2, colour = "black", fill = NA),
                        #axis.line = element_line(size = 0.9, colour = 'black'),
                        axis.ticks = element_line(size = 0.9, color = 'black'),
                        axis.ticks.length = unit(0.15, 'cm'),
                        axis.text.y = element_text(face = 'bold',size = 15, margin = margin(t = 0, r = 5, b = 0, l = 0)),
                        axis.text.x = element_text(face = 'bold' , size = 15, margin = margin(t = 10, r = 0, b = 0, l = 0)),
                        axis.title = element_text(size = 18),
                        axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0)),
                        axis.title.x = element_text(margin = margin(t = 15, r = 0, b = 0, l =0)),
                      
                        plot.title = element_text(size = 18, margin = margin(0, 0, 10, 0), hjust = -0.03, face = 'bold'))
                       #legend.background = element_blank(),
                       #legend.key = element_blank(),
                       #legend.title = element_text(size = 12),



## retriving estimates
model.table.RR <- data.frame(traits = factor(c('Neurobehavior',
                                               'Learning-MWM',
                                               'Memory-MWM',
                                               'Memory-NOR',
                                               'Anxiety-EPM',
                                               'Anxiety-OFT'),
                                            levels = rev(c('Neurobehavior',
                                                           'Learning-MWM',
                                                           'Memory-MWM',
                                                           'Memory-NOR',
                                                           'Anxiety-EPM',
                                                           'Anxiety-OFT'))),
                             coeffi = c(model1.behavior_RR$b,
                                        model1.learning_MWM_RR$b,
                                        model1.memory_MWM_RR$b,
                                        model1.memory_NOR_RR$b,
                                        model1.anxiety_EPM_RR$b,
                                        model1.anxiety_OFT_RR$b),
                             lower = c(model1.behavior_RR$ci.lb,
                                       model1.learning_MWM_RR$ci.lb,
                                       model1.memory_MWM_RR$ci.lb,
                                       model1.memory_NOR_RR$ci.lb,
                                       model1.anxiety_EPM_RR$ci.lb,
                                       model1.anxiety_OFT_RR$ci.lb),
                             upper = c(model1.behavior_RR$ci.ub,
                                       model1.learning_MWM_RR$ci.ub,
                                       model1.memory_MWM_RR$ci.ub,
                                       model1.memory_NOR_RR$ci.ub,
                                       model1.anxiety_EPM_RR$ci.ub,
                                       model1.anxiety_OFT_RR$ci.ub))

## plot
ggplot() +
  geom_hline(yintercept = 0, lty = 2, lwd = 1, colour = 'grey40', alpha = 1) +
  geom_pointrange(data = model.table.RR, aes(x = traits, y = coeffi, ymin = lower, ymax = upper, shape = traits, size = traits, colour = traits), lwd = 1.2, show.legend = F, fatten = 7) +
  scale_shape_manual(values = c(16, 16, 16, 16, 16, 18)) +
  scale_size_manual(values = c(0.6, 0.6, 0.6, 0.6, 0.6, 1)) +
  scale_color_manual(values = c("#009E73", "#009E73", "#009E73", "#009E73", "#009E73", "#E69F00")) +
  scale_y_continuous(limits = c(-0.27, 0.93),
                     breaks = c(-0.2, 0.0, 0.2, 0.4, 0.6, 0.8), 
                     labels = c('-0.2', '0.0', '0.2', '0.4', '0.6','0.8') 
                     ) +
  coord_flip() +
  hypothesis.theme +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_text(colour = 'black', size = 18),
        axis.text.x = element_text(colour = 'black', size = 18),
        plot.margin = unit(c(0.3, 0.3, 0, 0.3), 'cm')) +
  ylab(' ') +
  ggtitle ('(A)') +
  theme(axis.title.x = element_text(margin = margin(t = 5, r = 0, b = 0, l = 0))) -> fig.overall.behavior.RR
```





### Section 2 - power lnCVR and lnVR
Assuming multi-level meta-analysis estimate as true effect, we want to calculate two-tailed power for 12 lnCVR and lnVR meta-analytic cases - relative variation and absolute variation.

In addition, we also want to calculate power using three hypothetical true effects (i.e. 5%, 10%, 20%, 40% mean differences).

```{r}
#***************************************************************#
#             power for 12 meta-analytic cases                  #
#***************************************************************#

# Import raw data
raw_m1_1 <- read.csv(file = "./12_lnCVR_data/raw_m1_1.csv", header = TRUE) #sep=";"
raw_m1_2 <- read.csv(file = "./12_lnCVR_data/raw_m1_2.csv", header = TRUE) 
raw_m2_1 <- read.csv(file = "./12_lnCVR_data/raw_m2_1.csv", header = TRUE)
raw_m2_2 <- read.csv(file = "./12_lnCVR_data/raw_m2_2.csv", header = TRUE) 
raw_m5_1 <- read.csv(file = "./12_lnCVR_data/raw_m5_1.csv", header = TRUE)
raw_m6_1 <- read.csv(file = "./12_lnCVR_data/raw_m6_1.csv", header = TRUE)
raw_m6_2 <- read.csv(file = "./12_lnCVR_data/raw_m6_2.csv", header = TRUE) 
raw_m6_3 <- read.csv(file = "./12_lnCVR_data/raw_m6_3.csv", header = TRUE)
raw_m6_4 <- read.csv(file = "./12_lnCVR_data/raw_m6_4.csv", header = TRUE)
raw_m6_5 <- read.csv(file = "./12_lnCVR_data/raw_m6_5.csv", header = TRUE)
raw_m9_1 <- read.csv(file = "./12_lnCVR_data/raw_m9_1.csv", header = TRUE)
raw_m11_1 <- read.csv(file = "./12_lnCVR_data/raw_m11_1.csv", header = TRUE)


# rename the column names of descriptive statistics to standard column names (i.e. "T_mean", "T_sd", "T_N", "C_mean", "C_sd", "C_N")
names(raw_m1_1)[str_detect(names(raw_m1_1), c("T.mean|T.sd|T.N|C.mean|C.sd|C.N"))] <- c("T_mean", "T_sd", "T_N", "C_mean", "C_sd", "C_N")
names(raw_m1_2)[str_detect(names(raw_m1_2), c("T.mean|T.sd|T.N|C.mean|C.sd|C.N"))] <- c("T_mean", "T_sd", "T_N", "C_mean", "C_sd", "C_N") 

names(raw_m2_1)[str_detect(names(raw_m2_1), c("con.mn|con.sd|con.n|fert.mn|fert.sd|fert.n"))] <- c( "C_mean", "C_sd", "C_N", "T_mean", "T_sd", "T_N")
names(raw_m2_2)[str_detect(names(raw_m2_2), c("con.mn|con.sd|con.n|fert.mn|fert.sd|fert.n"))] <- c( "C_mean", "C_sd", "C_N", "T_mean", "T_sd", "T_N")  

names(raw_m5_1)[str_detect(names(raw_m5_1), c("NT|NC|meanT|meanC|sdT|sdC"))] <- c("T_N", "C_N", "T_mean", "C_mean", "T_sd", "C_sd") 

names(raw_m6_1)[str_detect(names(raw_m6_1), c("p.mean|p.sd|p.n|d.mean|d.sd|d.n"))] <- c("C_mean","C_sd","C_N",  "T_mean","T_sd","T_N") 
names(raw_m6_2)[str_detect(names(raw_m6_2), c("p.mean|p.sd|p.n|d.mean|d.sd|d.n"))] <- c("C_mean","C_sd","C_N",  "T_mean","T_sd","T_N") 
names(raw_m6_3)[str_detect(names(raw_m6_3), c("p.mean|p.sd|p.n|d.mean|d.sd|d.n"))] <- c("C_mean","C_sd","C_N",  "T_mean","T_sd","T_N") 
names(raw_m6_4)[str_detect(names(raw_m6_4), c("p.mean|p.sd|p.n|d.mean|d.sd|d.n"))] <- c("C_mean","C_sd","C_N",  "T_mean","T_sd","T_N") 
names(raw_m6_5)[str_detect(names(raw_m6_5), c("p.mean|p.sd|p.n|d.mean|d.sd|d.n"))] <- c("C_mean","C_sd","C_N",  "T_mean","T_sd","T_N") 

names(raw_m9_1)[str_detect(names(raw_m9_1), c("N2O.trt|SD.N2O.trt|N.N2O.trt|N2O.ctr|SD.N2O.ctr|N.N2O.ctr"))] <- c("T_mean","T_sd","T_N","C_mean","C_sd","C_N")
names(raw_m11_1)[str_detect(names(raw_m11_1), c("Mean|SD|N|Mean.1|SD.1|N.1"))] <- c("C_mean","C_sd","C_N","T_mean","T_sd","T_N")


# make a list of data
dat_list_variation <- list(raw_m1_1,
                           raw_m1_2,
                           raw_m2_1,
                           raw_m2_2,
                           raw_m5_1,
                           raw_m6_1,
                           raw_m6_2,
                           raw_m6_3,
                           raw_m6_4,
                           raw_m6_5,
                           raw_m9_1,
                           raw_m11_1)

# calculate the number of total effect sizes - sample size
ES_number <- NA
ES_number <- mapply(unique, sapply(dat_list_variation, function(x) x$Unit_ID)) 
unlist(ES_number) %>% length() # 2004


# calculate 3 type of effect size statistics (i.e. lnRR, lnCVR and lnVR)
lnRR <- NA
for (i in 1:length(dat_list_variation)) {
  lnRR[i] <- escalc(measure = "ROM",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_variation[[i]]) %>% list()
}

lnCVR <- NA
for (i in 1:length(dat_list_variation)) {
  lnCVR[i] <- escalc(measure = "CVR",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_variation[[i]]) %>% list()
}

lnVR <- NA
for (i in 1:length(dat_list_variation)) {
  lnVR[i] <- escalc(measure = "VR",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_variation[[i]]) %>% list()
} 


# clean NA
for (i in 1:12) {
  lnCVR[[i]] <- lnCVR[[i]][!is.na(lnCVR[[i]]$yi),]
}

for (i in 1:12) {
  lnVR[[i]] <- lnVR[[i]][!is.na(lnVR[[i]]$yi),]
}


# prepare "ture" effect of variation (i.e. lnCVR and lnVR) for power analysis - fit multi-level meta-analytic models
model_list_CVR<- NA
for (i in 1:length(dat_list_variation)) {
 model_list_CVR[i] <- rma.mv(data = lnCVR[[i]], yi = yi, V = vi, random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

model_list_VR<- NA
for (i in 1:length(dat_list_variation)) {
 model_list_VR[i] <- rma.mv(data = lnVR[[i]], yi = yi, V = vi, random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}


#****************************************************************#
#------------------------------lnCVR-----------------------------#
#****************************************************************#

# we assume meta-analytic mean as ture effect, so we need to get estimate (mu) and corresponding error (SE)
model_est_CVR <- data.frame(MA_case=c("m1_1",
                                      "m1_2",
                                      "m2_1",
                                      "m2_2",
                                      "m5_1",
                                      "m6_1",
                                      "m6_2",
                                      "m6_3",
                                      "m6_4",
                                      "m6_5",
                                      "m9_1",
                                      "m11_1"),
                  mu_CVR=sapply(model_list_CVR, function(x) x$beta),
                  SE_CVR=sapply(model_list_CVR, function(x) x$se),
                  ll_NHST=sapply(model_list_CVR, function(x) x$ci.lb),
                  ul_NHST=sapply(model_list_CVR, function(x) x$ci.ub),
                  p_value=sapply(model_list_CVR, function(x) x$pval) %>% round(4))



#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_CVR$MA.power <- power.ma_Shinichi(mu=model_est_CVR$mu,SE=model_est_CVR$SE)


#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_CVR$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_CVR$mu[i],se=model_est_CVR$SE[i],alpha=0.05) %>% unlist()
}

model_est_CVR$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_CVR$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_CVR$mu[i],se=model_est_CVR$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_CVR$MA.power.M <- MA.power.M


#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#
MA.power.M2 <- NA
for (i in 1:length(model_est_CVR$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_CVR$mu[i],se=model_est_CVR$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_CVR$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_CVR, file = "./meta-analysis power_CVR.csv", row.names = FALSE)


#****************************************************************#
#-------------------------------lnVR-----------------------------#
#****************************************************************#

# we assume meta-analytic mean as ture effect, so we need to get estimate (mu) and corresponding error (SE)

model_est_VR <- data.frame(MA_case=model_est_CVR$MA_case,
                  mu_VR=sapply(model_list_VR, function(x) x$beta),
                  SE_VR=sapply(model_list_VR, function(x) x$se),
                  ll_NHST=sapply(model_list_VR, function(x) x$ci.lb),
                  ul_NHST=sapply(model_list_VR, function(x) x$ci.ub),
                  p_value=sapply(model_list_VR, function(x) x$pval))

#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_VR$MA.power <- power.ma_Shinichi(mu=model_est_VR$mu,SE=model_est_VR$SE)

#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_VR$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_VR$mu[i],se=model_est_VR$SE[i],alpha=0.05) %>% unlist()
}

model_est_VR$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_VR$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_VR$mu[i],se=model_est_VR$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_VR$MA.power.M <- MA.power.M

#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#  
MA.power.M2 <- NA
for (i in 1:length(model_est_VR$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_VR$mu[i],se=model_est_VR$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_VR$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_VR, file = "./meta-analysis power_VR.csv", row.names = FALSE)


#***************************************************************#
#        power for empirical studies within meta-analysis       #
#***************************************************************#

# We have three approaches for calculating empirical studies within meta-analysis: (i) using meta-analytic estimate (i.e. intercept or fixed effect) as true effect; (ii) using effect size specific effect as true effect (i.e. fixed plus random effect), which accomodate between-study heterogeneity; (iii) postulated (i.e. hypothetical) effect as true effect - 5%, 10%, 20%, 40% difference)


#****************************************************************#
#------------------------------lnCVR-----------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# lnCVR
power.F_CVR <- NA
for (i in 1:length(lnCVR)) {
  power.F_CVR[i] <- power.individual_Shinichi(mu=rep(model_list_CVR[[i]]$beta, length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_CVR)) {
  lnCVR[[i]]$power.F_CVR <- power.F_CVR[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  power.F.S_CVR[i] <- mapply(error_S,mu=rep(model_list_CVR[[i]]$beta, length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_CVR)) {
  lnCVR[[i]]$power.F.S_CVR <- power.F.S_CVR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  power.F.M2_CVR[i] <-mapply(error_M2,mu=rep(model_list_CVR[[i]]$beta, length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_CVR)) {
  lnCVR[[i]]$power.F.M2_CVR <- power.F.M2_CVR[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_CVR <- NA
for (i in 1:length(model_list_CVR)) {
  blups.list_CVR[i] <- ranef(model_list_CVR[[i]]) %>% list()
}

# get study index - match two components of random effect
index.list_CVR <- NA # list()
for (i in 1:length(model_list_CVR)) {
  index.list_CVR[i] <- match(as.character(lnCVR[[i]]$Study),rownames(blups.list_CVR[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_CVR <-NA
for (i in 1:length(model_list_CVR)) {
  effect.R_CVR[i] <- mapply(sum, model_list_CVR[[i]]$beta, blups.list_CVR[[i]]$Study[index.list_CVR[[i]],1], blups.list_CVR[[i]]$Unit_ID[,1]) %>% list()
}


#--------------------- (1) two tailed power ---------------------#
power.R_CVR <- NA
for (i in 1:length(dat_list_variation)) {
  power.R_CVR[i] <- power.individual_Shinichi(mu=effect.R_CVR[[i]], se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# plot(power_CVR[[1]]-power_CVR2[[1]]) - check discrepancy
# allocate each set of power into coCVResponding dataset
for (i in 1:length(power.R_CVR)) {
  lnCVR[[i]]$power.R_CVR <- power.R_CVR[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_CVR <- NA
for (i in 1:12) {
  power.R.S_CVR[i] <- mapply(error_S, mu=effect.R_CVR[[i]], se=sqrt(lnCVR[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coCVResponding dataset
for (i in 1:length(power.R.S_CVR)) {
  lnCVR[[i]]$power.R.S_CVR <- power.R.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_CVR <- NA
for (i in 1:12) {
  power.R.M_CVR[i] <- mapply(error_M, mu=effect.R_CVR[[i]], se=sqrt(lnCVR[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coCVResponding dataset
for (i in 1:length(power.R.M_CVR)) {
  lnCVR[[i]]$power.R.M_CVR <- power.R.M_CVR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_CVR <- NA
for (i in 1:12) {
  power.R.M2_CVR[i] <- mapply(error_M2, mu=effect.R_CVR[[i]], se=sqrt(lnCVR[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coCVResponding dataset
for (i in 1:length(power.R.M2_CVR)) {
  lnCVR[[i]]$power.R.M2_CVR <- power.R.M2_CVR[[i]]
}


#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d1_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d1_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(101/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power_CVR)) {
  lnCVR[[i]]$d1_power_CVR <- d1_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d1_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d1_power.S_CVR[i] <- mapply(error_S, mu=rep(log(101/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.S_CVR)) {
  lnCVR[[i]]$d1_power.S_CVR <- d1_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d1_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d1_power.M_CVR[i] <- mapply(error_M, mu=rep(log(101/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M_CVR)) {
  lnCVR[[i]]$d1_power.M_CVR <- d1_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d1_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d1_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(101/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M2_CVR)) {
  lnCVR[[i]]$d1_power.M2_CVR <- d1_power.M2_CVR[[i]]
}


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d5_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d5_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(105/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power_CVR)) {
  lnCVR[[i]]$d5_power_CVR <- d5_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d5_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d5_power.S_CVR[i] <- mapply(error_S, mu=rep(log(105/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.S_CVR)) {
  lnCVR[[i]]$d5_power.S_CVR <- d5_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d5_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d5_power.M_CVR[i] <- mapply(error_M, mu=rep(log(105/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M_CVR)) {
  lnCVR[[i]]$d5_power.M_CVR <- d5_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d5_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d5_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(105/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M2_CVR)) {
  lnCVR[[i]]$d5_power.M2_CVR <- d5_power.M2_CVR[[i]]
}


#*****************************************************************#
#********************* 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d10_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d10_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(110/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power_CVR)) {
  lnCVR[[i]]$d10_power_CVR <- d10_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d10_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d10_power.S_CVR[i] <- mapply(error_S, mu=rep(log(110/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.S_CVR)) {
  lnCVR[[i]]$d10_power.S_CVR <- d10_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d10_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d10_power.M_CVR[i] <- mapply(error_M, mu=rep(log(110/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M_CVR)) {
  lnCVR[[i]]$d10_power.M_CVR <- d10_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d10_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d10_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(110/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M2_CVR)) {
  lnCVR[[i]]$d10_power.M2_CVR <- d10_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************* 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d20_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d20_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(120/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power_CVR)) {
  lnCVR[[i]]$d20_power_CVR <- d20_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d20_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d20_power.S_CVR[i] <- mapply(error_S, mu=rep(log(120/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.S_CVR)) {
  lnCVR[[i]]$d20_power.S_CVR <- d20_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d20_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d20_power.M_CVR[i] <- mapply(error_M, mu=rep(log(120/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M_CVR)) {
  lnCVR[[i]]$d20_power.M_CVR <- d20_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d20_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d20_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(120/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M2_CVR)) {
  lnCVR[[i]]$d20_power.M2_CVR <- d20_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d30_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d30_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(130/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power_CVR)) {
  lnCVR[[i]]$d30_power_CVR <- d30_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d30_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d30_power.S_CVR[i] <- mapply(error_S, mu=rep(log(130/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.S_CVR)) {
  lnCVR[[i]]$d30_power.S_CVR <- d30_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d30_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d30_power.M_CVR[i] <- mapply(error_M, mu=rep(log(130/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M_CVR)) {
  lnCVR[[i]]$d30_power.M_CVR <- d30_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d30_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d30_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(130/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M2_CVR)) {
  lnCVR[[i]]$d30_power.M2_CVR <- d30_power.M2_CVR[[i]]
}


#*****************************************************************#
#********************* 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d40_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d40_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(140/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power_CVR)) {
  lnCVR[[i]]$d40_power_CVR <- d40_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d40_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d40_power.S_CVR[i] <- mapply(error_S, mu=rep(log(140/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.S_CVR)) {
  lnCVR[[i]]$d40_power.S_CVR <- d40_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d40_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d40_power.M_CVR[i] <- mapply(error_M, mu=rep(log(140/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M_CVR)) {
  lnCVR[[i]]$d40_power.M_CVR <- d40_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d40_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d40_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(140/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M2_CVR)) {
  lnCVR[[i]]$d40_power.M2_CVR <- d40_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d50_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d50_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(150/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power_CVR)) {
  lnCVR[[i]]$d50_power_CVR <- d50_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d50_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d50_power.S_CVR[i] <- mapply(error_S, mu=rep(log(150/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.S_CVR)) {
  lnCVR[[i]]$d50_power.S_CVR <- d50_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d50_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d50_power.M_CVR[i] <- mapply(error_M, mu=rep(log(150/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M_CVR)) {
  lnCVR[[i]]$d50_power.M_CVR <- d50_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d50_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d50_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(150/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M2_CVR)) {
  lnCVR[[i]]$d50_power.M2_CVR <- d50_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d60_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d60_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(160/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power_CVR)) {
  lnCVR[[i]]$d60_power_CVR <- d60_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d60_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d60_power.S_CVR[i] <- mapply(error_S, mu=rep(log(160/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.S_CVR)) {
  lnCVR[[i]]$d60_power.S_CVR <- d60_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d60_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {  
  d60_power.M_CVR[i] <- mapply(error_M, mu=rep(log(160/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M_CVR)) {
  lnCVR[[i]]$d60_power.M_CVR <- d60_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d60_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d60_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(160/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M2_CVR)) {
  lnCVR[[i]]$d60_power.M2_CVR <- d60_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d70_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d70_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(170/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power_CVR)) {
  lnCVR[[i]]$d70_power_CVR <- d70_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d70_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d70_power.S_CVR[i] <- mapply(error_S, mu=rep(log(170/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.S_CVR)) {
  lnCVR[[i]]$d70_power.S_CVR <- d70_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d70_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d70_power.M_CVR[i] <- mapply(error_M, mu=rep(log(170/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M_CVR)) {
  lnCVR[[i]]$d70_power.M_CVR <- d70_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d70_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d70_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(170/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M2_CVR)) {
  lnCVR[[i]]$d70_power.M2_CVR <- d70_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d80_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d80_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(180/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power_CVR)) {
  lnCVR[[i]]$d80_power_CVR <- d80_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d80_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d80_power.S_CVR[i] <- mapply(error_S, mu=rep(log(180/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.S_CVR)) {
  lnCVR[[i]]$d80_power.S_CVR <- d80_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d80_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d80_power.M_CVR[i] <- mapply(error_M, mu=rep(log(180/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M_CVR)) {
  lnCVR[[i]]$d80_power.M_CVR <- d80_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d80_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d80_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(180/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M2_CVR)) {
  lnCVR[[i]]$d80_power.M2_CVR <- d80_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d90_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d90_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(190/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power_CVR)) {
  lnCVR[[i]]$d90_power_CVR <- d90_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d90_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d90_power.S_CVR[i] <- mapply(error_S, mu=rep(log(190/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.S_CVR)) {
  lnCVR[[i]]$d90_power.S_CVR <- d90_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d90_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d90_power.M_CVR[i] <- mapply(error_M, mu=rep(log(190/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M_CVR)) {
  lnCVR[[i]]$d90_power.M_CVR <- d90_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d90_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d90_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(190/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M2_CVR)) {
  lnCVR[[i]]$d90_power.M2_CVR <- d90_power.M2_CVR[[i]]
}



#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d100_power_CVR <- NA
for (i in 1:length(lnCVR)) {
  d100_power_CVR[i] <- power.individual_Shinichi(mu=rep(log(200/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power_CVR)) {
  lnCVR[[i]]$d100_power_CVR <- d100_power_CVR[[i]]
}

#---------------------- (2) type S error -----------------------#
d100_power.S_CVR <- NA
for (i in 1:length(lnCVR)) {
  d100_power.S_CVR[i] <- mapply(error_S, mu=rep(log(200/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.S_CVR)) {
  lnCVR[[i]]$d100_power.S_CVR <- d100_power.S_CVR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d100_power.M_CVR <- NA
for (i in 1:length(lnCVR)) {
  d100_power.M_CVR[i] <- mapply(error_M, mu=rep(log(200/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M_CVR)) {
  lnCVR[[i]]$d100_power.M_CVR <- d100_power.M_CVR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d100_power.M2_CVR <- NA
for (i in 1:length(lnCVR)) {
  d100_power.M2_CVR[i] <- mapply(error_M2, mu=rep(log(200/100), length(lnCVR[[i]]$vi)), se=sqrt(lnCVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M2_CVR)) {
  lnCVR[[i]]$d100_power.M2_CVR <- d100_power.M2_CVR[[i]]
}



#****************************************************************#
#------------------------------lnVR------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# lnVR
power.F_VR <- NA
for (i in 1:length(lnVR)) {
  power.F_VR[i] <- power.individual_Shinichi(mu=rep(model_list_VR[[i]]$beta, length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_VR)) {
  lnVR[[i]]$power.F_VR <- power.F_VR[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_VR <- NA
for (i in 1:length(lnVR)) {
  power.F.S_VR[i] <- mapply(error_S,mu=rep(model_list_VR[[i]]$beta, length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_VR)) {
  lnVR[[i]]$power.F.S_VR <- power.F.S_VR[[i]]
}

#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_VR <- NA
for (i in 1:length(lnVR)) {
  power.F.M_VR[i] <-mapply(error_M,mu=rep(model_list_VR[[i]]$beta, length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_VR)) {
  lnVR[[i]]$power.F.M_VR <- power.F.M_VR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_VR <- NA
for (i in 1:length(lnVR)) {
  power.F.M2_VR[i] <-mapply(error_M2,mu=rep(model_list_VR[[i]]$beta, length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_VR)) {
  lnVR[[i]]$power.F.M2_VR <- power.F.M2_VR[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_VR <- NA
for (i in 1:length(model_list_VR)) {
  blups.list_VR[i] <- ranef(model_list_VR[[i]]) %>% list()
}

# get study index - match two components random effect
index.list_VR <- NA # list()
for (i in 1:length(model_list_VR)) {
  index.list_VR[i] <- match(as.character(lnVR[[i]]$Study),rownames(blups.list_VR[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_VR <-NA
for (i in 1:length(model_list_VR)) {
  effect.R_VR[i] <- mapply(sum, model_list_VR[[i]]$beta, blups.list_VR[[i]]$Study[index.list_VR[[i]],1], blups.list_VR[[i]]$Unit_ID[,1]) %>% list()
}


#--------------------- (1) two tailed power ---------------------#
power.R_VR <- NA
for (i in 1:length(dat_list_variation)) {
  power.R_VR[i] <- power.individual_Shinichi(mu=effect.R_VR[[i]], se=sqrt(lnVR[[i]]$vi)) %>% list()}

# plot(power_VR[[1]]-power_VR2[[1]]) - check discrepancy
# allocate each set of power into coVResponding dataset
for (i in 1:length(power.R_VR)) {
  lnVR[[i]]$power.R_VR <- power.R_VR[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_VR <- NA
for (i in 1:12) {
  power.R.S_VR[i] <- mapply(error_S, mu=effect.R_VR[[i]], se=sqrt(lnVR[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coVResponding dataset
for (i in 1:length(power.R.S_VR)) {
  lnVR[[i]]$power.R.S_VR <- power.R.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_VR <- NA
for (i in 1:12) {
  power.R.M_VR[i] <- mapply(error_M, mu=effect.R_VR[[i]], se=sqrt(lnVR[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coVResponding dataset
for (i in 1:length(power.R.M_VR)) {
  lnVR[[i]]$power.R.M_VR <- power.R.M_VR[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_VR <- NA
for (i in 1:12) {
  power.R.M2_VR[i] <- mapply(error_M2, mu=effect.R_VR[[i]], se=sqrt(lnVR[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coVResponding dataset
for (i in 1:length(power.R.M2_VR)) {
  lnVR[[i]]$power.R.M2_VR <- power.R.M2_VR[[i]]
}




#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d1_power_VR <- NA
for (i in 1:length(lnVR)) {
  d1_power_VR[i] <- power.individual_Shinichi(mu=rep(log(101/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power_VR)) {
  lnVR[[i]]$d1_power_VR <- d1_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d1_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d1_power.S_VR[i] <- mapply(error_S, mu=rep(log(101/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.S_VR)) {
  lnVR[[i]]$d1_power.S_VR <- d1_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d1_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d1_power.M_VR[i] <- mapply(error_M, mu=rep(log(101/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M_VR)) {
  lnVR[[i]]$d1_power.M_VR <- d1_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d1_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d1_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(101/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1_power.M2_VR)) {
  lnVR[[i]]$d1_power.M2_VR <- d1_power.M2_VR[[i]]
}



#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d5_power_VR <- NA
for (i in 1:length(lnVR)) {
  d5_power_VR[i] <- power.individual_Shinichi(mu=rep(log(105/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power_VR)) {
  lnVR[[i]]$d5_power_VR <- d5_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d5_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d5_power.S_VR[i] <- mapply(error_S, mu=rep(log(105/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.S_VR)) {
  lnVR[[i]]$d5_power.S_VR <- d5_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d5_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d5_power.M_VR[i] <- mapply(error_M, mu=rep(log(105/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M_VR)) {
  lnVR[[i]]$d5_power.M_VR <- d5_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d5_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d5_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(105/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d5_power.M2_VR)) {
  lnVR[[i]]$d5_power.M2_VR <- d5_power.M2_VR[[i]]
}


#*****************************************************************#
#********************* 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d10_power_VR <- NA
for (i in 1:length(lnVR)) {
  d10_power_VR[i] <- power.individual_Shinichi(mu=rep(log(110/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power_VR)) {
  lnVR[[i]]$d10_power_VR <- d10_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d10_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d10_power.S_VR[i] <- mapply(error_S, mu=rep(log(110/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.S_VR)) {
  lnVR[[i]]$d10_power.S_VR <- d10_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d10_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d10_power.M_VR[i] <- mapply(error_M, mu=rep(log(110/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M_VR)) {
  lnVR[[i]]$d10_power.M_VR <- d10_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d10_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d10_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(110/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d10_power.M2_VR)) {
  lnVR[[i]]$d10_power.M2_VR <- d10_power.M2_VR[[i]]
}



#*****************************************************************#
#********************* 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d20_power_VR <- NA
for (i in 1:length(lnVR)) {
  d20_power_VR[i] <- power.individual_Shinichi(mu=rep(log(120/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power_VR)) {
  lnVR[[i]]$d20_power_VR <- d20_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d20_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d20_power.S_VR[i] <- mapply(error_S, mu=rep(log(120/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.S_VR)) {
  lnVR[[i]]$d20_power.S_VR <- d20_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d20_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d20_power.M_VR[i] <- mapply(error_M, mu=rep(log(120/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M_VR)) {
  lnVR[[i]]$d20_power.M_VR <- d20_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d20_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d20_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(120/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d20_power.M2_VR)) {
  lnVR[[i]]$d20_power.M2_VR <- d20_power.M2_VR[[i]]
}


#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d30_power_VR <- NA
for (i in 1:length(lnVR)) {
  d30_power_VR[i] <- power.individual_Shinichi(mu=rep(log(130/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power_VR)) {
  lnVR[[i]]$d30_power_VR <- d30_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d30_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d30_power.S_VR[i] <- mapply(error_S, mu=rep(log(130/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.S_VR)) {
  lnVR[[i]]$d30_power.S_VR <- d30_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d30_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d30_power.M_VR[i] <- mapply(error_M, mu=rep(log(130/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M_VR)) {
  lnVR[[i]]$d30_power.M_VR <- d30_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d30_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d30_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(130/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d30_power.M2_VR)) {
  lnVR[[i]]$d30_power.M2_VR <- d30_power.M2_VR[[i]]
}



#*****************************************************************#
#********************* 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d40_power_VR <- NA
for (i in 1:length(lnVR)) {
  d40_power_VR[i] <- power.individual_Shinichi(mu=rep(log(140/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power_VR)) {
  lnVR[[i]]$d40_power_VR <- d40_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d40_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d40_power.S_VR[i] <- mapply(error_S, mu=rep(log(140/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.S_VR)) {
  lnVR[[i]]$d40_power.S_VR <- d40_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d40_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d40_power.M_VR[i] <- mapply(error_M, mu=rep(log(140/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M_VR)) {
  lnVR[[i]]$d40_power.M_VR <- d40_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d40_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d40_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(140/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d40_power.M2_VR)) {
  lnVR[[i]]$d40_power.M2_VR <- d40_power.M2_VR[[i]]
}




#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d50_power_VR <- NA
for (i in 1:length(lnVR)) {
  d50_power_VR[i] <- power.individual_Shinichi(mu=rep(log(150/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power_VR)) {
  lnVR[[i]]$d50_power_VR <- d50_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d50_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d50_power.S_VR[i] <- mapply(error_S, mu=rep(log(150/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.S_VR)) {
  lnVR[[i]]$d50_power.S_VR <- d50_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d50_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d50_power.M_VR[i] <- mapply(error_M, mu=rep(log(150/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M_VR)) {
  lnVR[[i]]$d50_power.M_VR <- d50_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d50_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d50_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(150/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d50_power.M2_VR)) {
  lnVR[[i]]$d50_power.M2_VR <- d50_power.M2_VR[[i]]
}




#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d60_power_VR <- NA
for (i in 1:length(lnVR)) {
  d60_power_VR[i] <- power.individual_Shinichi(mu=rep(log(160/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power_VR)) {
  lnVR[[i]]$d60_power_VR <- d60_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d60_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d60_power.S_VR[i] <- mapply(error_S, mu=rep(log(160/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.S_VR)) {
  lnVR[[i]]$d60_power.S_VR <- d60_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d60_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d60_power.M_VR[i] <- mapply(error_M, mu=rep(log(160/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M_VR)) {
  lnVR[[i]]$d60_power.M_VR <- d60_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d60_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d60_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(160/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d60_power.M2_VR)) {
  lnVR[[i]]$d60_power.M2_VR <- d60_power.M2_VR[[i]]
}




#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d70_power_VR <- NA
for (i in 1:length(lnVR)) {
  d70_power_VR[i] <- power.individual_Shinichi(mu=rep(log(170/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power_VR)) {
  lnVR[[i]]$d70_power_VR <- d70_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d70_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d70_power.S_VR[i] <- mapply(error_S, mu=rep(log(170/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.S_VR)) {
  lnVR[[i]]$d70_power.S_VR <- d70_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d70_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d70_power.M_VR[i] <- mapply(error_M, mu=rep(log(170/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M_VR)) {
  lnVR[[i]]$d70_power.M_VR <- d70_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d70_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d70_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(170/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d70_power.M2_VR)) {
  lnVR[[i]]$d70_power.M2_VR <- d70_power.M2_VR[[i]]
}



#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d80_power_VR <- NA
for (i in 1:length(lnVR)) {
  d80_power_VR[i] <- power.individual_Shinichi(mu=rep(log(180/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power_VR)) {
  lnVR[[i]]$d80_power_VR <- d80_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d80_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d80_power.S_VR[i] <- mapply(error_S, mu=rep(log(180/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.S_VR)) {
  lnVR[[i]]$d80_power.S_VR <- d80_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d80_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d80_power.M_VR[i] <- mapply(error_M, mu=rep(log(180/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M_VR)) {
  lnVR[[i]]$d80_power.M_VR <- d80_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d80_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d80_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(180/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d80_power.M2_VR)) {
  lnVR[[i]]$d80_power.M2_VR <- d80_power.M2_VR[[i]]
}




#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d90_power_VR <- NA
for (i in 1:length(lnVR)) {
  d90_power_VR[i] <- power.individual_Shinichi(mu=rep(log(190/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power_VR)) {
  lnVR[[i]]$d90_power_VR <- d90_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d90_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d90_power.S_VR[i] <- mapply(error_S, mu=rep(log(190/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.S_VR)) {
  lnVR[[i]]$d90_power.S_VR <- d90_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d90_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d90_power.M_VR[i] <- mapply(error_M, mu=rep(log(190/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M_VR)) {
  lnVR[[i]]$d90_power.M_VR <- d90_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d90_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d90_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(190/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d90_power.M2_VR)) {
  lnVR[[i]]$d90_power.M2_VR <- d90_power.M2_VR[[i]]
}



#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d100_power_VR <- NA
for (i in 1:length(lnVR)) {
  d100_power_VR[i] <- power.individual_Shinichi(mu=rep(log(200/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power_VR)) {
  lnVR[[i]]$d100_power_VR <- d100_power_VR[[i]]
}

#---------------------- (2) type S error -----------------------#
d100_power.S_VR <- NA
for (i in 1:length(lnVR)) {
  d100_power.S_VR[i] <- mapply(error_S, mu=rep(log(200/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.S_VR)) {
  lnVR[[i]]$d100_power.S_VR <- d100_power.S_VR[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d100_power.M_VR <- NA
for (i in 1:length(lnVR)) {
  d100_power.M_VR[i] <- mapply(error_M, mu=rep(log(200/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M_VR)) {
  lnVR[[i]]$d100_power.M_VR <- d100_power.M_VR[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d100_power.M2_VR <- NA
for (i in 1:length(lnVR)) {
  d100_power.M2_VR[i] <- mapply(error_M2, mu=rep(log(200/100), length(lnVR[[i]]$vi)), se=sqrt(lnVR[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d100_power.M2_VR)) {
  lnVR[[i]]$d100_power.M2_VR <- d100_power.M2_VR[[i]]
}


#*********************************************************************#
#----------- summary of empirical power for each approach ------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------lnCVR------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.F_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.F.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.F.M_CVR))[6,])

#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.F.M2_CVR))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.R_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.R.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.R.M_CVR))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$power.R.M2_CVR))[6,]) 




#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d1_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d1_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d1_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d1_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d1_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d1_power.M2_CVR))[6,]) 


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d5_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d5_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d5_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d5_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d5_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d5_power.M2_CVR))[6,]) 


#*****************************************************************#
#********************** 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d10_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d10_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d10_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d10_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d10_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d10_power.M2_CVR))[6,]) 


#*****************************************************************#
#********************** 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d20_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d20_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d20_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d20_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d20_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d20_power.M2_CVR))[6,]) 




#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d30_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d30_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d30_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d30_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d30_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d30_power.M2_CVR))[6,]) 



#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d40_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d40_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d40_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d40_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d40_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d40_power.M2_CVR))[6,]) 




#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d50_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d50_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d50_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d50_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d50_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d50_power.M2_CVR))[6,]) 



#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d60_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d60_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d60_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d60_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d60_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d60_power.M2_CVR))[6,]) 




#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d70_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d70_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d70_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d70_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d70_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d70_power.M2_CVR))[6,]) 




#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d80_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d80_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d80_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d80_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d80_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d80_power.M2_CVR))[6,]) 



#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d90_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d90_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d90_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d90_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d90_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d90_power.M2_CVR))[6,]) 



#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d100_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d100_power_CVR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d100_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.S_CVR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d100_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M_CVR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d100_CVR <- data.frame(MA_case=model_est_CVR$MA_case,
                   Minimum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[2,],
                   Median=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[3,],
                   Mean=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[5,], 
                   Maximum=mapply(summary, sapply(lnCVR, function(x) x$d100_power.M2_CVR))[6,]) 



#****************************************************************#
#-----------------------------lnVR-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.F_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.F.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.F.M_VR))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.F.M2_VR))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.R_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.R.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.R.M_VR))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$power.R.M2_VR))[6,]) 




#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d1_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d1_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d1_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d1_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d1_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d1_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d1_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d1_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d5_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d5_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d5_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d5_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d5_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d5_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d5_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d5_power.M2_VR))[6,]) 


#*****************************************************************#
#********************** 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d10_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d10_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d10_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d10_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d10_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d10_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d10_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d10_power.M2_VR))[6,]) 


#*****************************************************************#
#********************** 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d20_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d20_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d20_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d20_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d20_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d20_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d20_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d20_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d30_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d30_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d30_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d30_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d30_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d30_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d30_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d30_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d40_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d40_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d40_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d40_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d40_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d40_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d40_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d40_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d50_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d50_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d50_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d50_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d50_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d50_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d50_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d50_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d60_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d60_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d60_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d60_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d60_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d60_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d60_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d60_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d70_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d70_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d70_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d70_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d70_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d70_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d70_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d70_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d80_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d80_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d80_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d80_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d80_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d80_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d80_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d80_power.M2_VR))[6,]) 



#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d90_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d90_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d90_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d90_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d90_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d90_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d90_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d90_power.M2_VR))[6,]) 




#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d100_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d100_power_VR))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d100_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d100_power.S_VR))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d100_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d100_power.M_VR))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d100_VR <- data.frame(MA_case=model_est_VR$MA_case,
                   Minimum=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[1,],      
                   `First quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[2,],
                   Median=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[3,],
                   Mean=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[4,], 
                   `Third quarter`=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[5,], 
                   Maximum=mapply(summary, sapply(lnVR, function(x) x$d100_power.M2_VR))[6,]) 


# clean NA - ma11 has NA
#for (i in 1:12) { lnVR[[i]] <- lnVR[[i]][!is.na(lnVR[[i]]$power.R_VR),]}





#*********************************************************************#
#--------- calculate standard error for each type of power -----------#
#*********************************************************************#

#****************************************************************#
#-----------------------------lnCVR------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_CVR
se.F_mean <- NA
for (i in 1:length(lnCVR)) {
  se.F_mean[i] <- sd(lnCVR[[i]]$power.F_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.F_CVR[!is.na(lnCVR[[i]]$power.F_CVR)]))
}

power.F_summary_CVR$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_CVR
se.F.S_mean <- NA
for (i in 1:length(lnCVR)) {
  se.F.S_mean[i] <- sd(lnCVR[[i]]$power.F.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.F.S_CVR[!is.na(lnCVR[[i]]$power.F.S_CVR)]))
}

power.F.S_summary_CVR$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_CVR
se.F.M_mean <- NA
for (i in 1:length(lnCVR)) {
  se.F.M_mean[i] <- sd(lnCVR[[i]]$power.F.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.F.M_CVR[!is.na(lnCVR[[i]]$power.F.M_CVR)]))
}

power.F.M_summary_CVR$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(lnCVR)) {
  se.F.M2_mean[i] <- sd(lnCVR[[i]]$power.F.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.F.M2_CVR[!is.na(lnCVR[[i]]$power.F.M2_CVR)]))
}

power.F.M2_summary_CVR$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_CVR
se.R_mean <- NA
for (i in 1:length(lnCVR)) {
  se.R_mean[i] <- sd(lnCVR[[i]]$power.R_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.R_CVR[!is.na(lnCVR[[i]]$power.R_CVR)]))
}

power.R_summary_CVR$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_CVR
se.R.S_mean <- NA
for (i in 1:length(lnCVR)) {
  se.R.S_mean[i] <- sd(lnCVR[[i]]$power.R.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.R.S_CVR[!is.na(lnCVR[[i]]$power.R.S_CVR)]))
}

power.R.S_summary_CVR$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_CVR
se.R.M_mean <- NA
for (i in 1:length(lnCVR)) {
  se.R.M_mean[i] <- sd(lnCVR[[i]]$power.R.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.R.M_CVR[!is.na(lnCVR[[i]]$power.R.M_CVR)]))
}

power.R.M_summary_CVR$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(lnCVR)) {
  se.R.M2_mean[i] <- sd(lnCVR[[i]]$power.R.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$power.R.M2_CVR[!is.na(lnCVR[[i]]$power.R.M2_CVR)]))
}

power.R.M2_summary_CVR$se.R.M2_mean <- se.R.M2_mean



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d1_power_CVR
se.d1_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d1_mean[i] <- sd(lnCVR[[i]]$d1_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d1_power_CVR[!is.na(lnCVR[[i]]$d1_power_CVR)]))
}

power_summary_d1_CVR$se.d1_mean <- se.d1_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d1_power.S_CVR
se.d1_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d1_mean[i] <- sd(lnCVR[[i]]$d1_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d1_power.S_CVR[!is.na(lnCVR[[i]]$d1_power.S_CVR)]))
}

power.S_summary_d1_CVR$se.d1_mean <- se.d1_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d1_power.M_CVR
se.d1_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d1_mean[i] <- sd(lnCVR[[i]]$d1_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d1_power.M_CVR[!is.na(lnCVR[[i]]$d1_power.M_CVR)]))
}

power.M_summary_d1_CVR$se.d1_mean <- se.d1_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d1_power.M2_CVR
se.d1_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d1_mean[i] <- sd(lnCVR[[i]]$d1_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d1_power.M2_CVR[!is.na(lnCVR[[i]]$d1_power.M2_CVR)]))
}

power.M2_summary_d1_CVR$se.d1_mean <- se.d1_mean




#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d5_power_CVR
se.d5_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d5_mean[i] <- sd(lnCVR[[i]]$d5_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d5_power_CVR[!is.na(lnCVR[[i]]$d5_power_CVR)]))
}

power_summary_d5_CVR$se.d5_mean <- se.d5_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d5_power.S_CVR
se.d5_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d5_mean[i] <- sd(lnCVR[[i]]$d5_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d5_power.S_CVR[!is.na(lnCVR[[i]]$d5_power.S_CVR)]))
}

power.S_summary_d5_CVR$se.d5_mean <- se.d5_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d5_power.M_CVR
se.d5_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d5_mean[i] <- sd(lnCVR[[i]]$d5_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d5_power.M_CVR[!is.na(lnCVR[[i]]$d5_power.M_CVR)]))
}

power.M_summary_d5_CVR$se.d5_mean <- se.d5_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d5_power.M2_CVR
se.d5_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d5_mean[i] <- sd(lnCVR[[i]]$d5_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d5_power.M2_CVR[!is.na(lnCVR[[i]]$d5_power.M2_CVR)]))
}

power.M2_summary_d5_CVR$se.d5_mean <- se.d5_mean



#*****************************************************************#
#********************** 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d10_power_CVR
se.d10_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d10_mean[i] <- sd(lnCVR[[i]]$d10_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d10_power_CVR[!is.na(lnCVR[[i]]$d10_power_CVR)]))
}

power_summary_d10_CVR$se.d10_mean <- se.d10_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d10_power.S_CVR
se.d10_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d10_mean[i] <- sd(lnCVR[[i]]$d10_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d10_power.S_CVR[!is.na(lnCVR[[i]]$d10_power.S_CVR)]))
}

power.S_summary_d10_CVR$se.d10_mean <- se.d10_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d10_power.M_CVR
se.d10_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d10_mean[i] <- sd(lnCVR[[i]]$d10_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d10_power.M_CVR[!is.na(lnCVR[[i]]$d10_power.M_CVR)]))
}

power.M_summary_d10_CVR$se.d10_mean <- se.d10_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d10_power.M2_CVR
se.d10_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d10_mean[i] <- sd(lnCVR[[i]]$d10_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d10_power.M2_CVR[!is.na(lnCVR[[i]]$d10_power.M2_CVR)]))
}

power.M2_summary_d10_CVR$se.d10_mean <- se.d10_mean



#*****************************************************************#
#********************** 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d20_power_CVR
se.d20_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d20_mean[i] <- sd(lnCVR[[i]]$d20_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d20_power_CVR[!is.na(lnCVR[[i]]$d20_power_CVR)]))
}

power_summary_d20_CVR$se.d20_mean <- se.d20_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d20_power.S_CVR
se.d20_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d20_mean[i] <- sd(lnCVR[[i]]$d20_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d20_power.S_CVR[!is.na(lnCVR[[i]]$d20_power.S_CVR)]))
}

power.S_summary_d20_CVR$se.d20_mean <- se.d20_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d20_power.M_CVR
se.d20_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d20_mean[i] <- sd(lnCVR[[i]]$d20_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d20_power.M_CVR[!is.na(lnCVR[[i]]$d20_power.M_CVR)]))
}

power.M_summary_d20_CVR$se.d20_mean <- se.d20_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d20_power.M2_CVR
se.d20_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d20_mean[i] <- sd(lnCVR[[i]]$d20_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d20_power.M2_CVR[!is.na(lnCVR[[i]]$d20_power.M2_CVR)]))
}

power.M2_summary_d20_CVR$se.d20_mean <- se.d20_mean



#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d30_power_CVR
se.d30_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d30_mean[i] <- sd(lnCVR[[i]]$d30_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d30_power_CVR[!is.na(lnCVR[[i]]$d30_power_CVR)]))
}

power_summary_d30_CVR$se.d30_mean <- se.d30_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d30_power.S_CVR
se.d30_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d30_mean[i] <- sd(lnCVR[[i]]$d30_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d30_power.S_CVR[!is.na(lnCVR[[i]]$d30_power.S_CVR)]))
}

power.S_summary_d30_CVR$se.d30_mean <- se.d30_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d30_power.M_CVR
se.d30_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d30_mean[i] <- sd(lnCVR[[i]]$d30_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d30_power.M_CVR[!is.na(lnCVR[[i]]$d30_power.M_CVR)]))
}

power.M_summary_d30_CVR$se.d30_mean <- se.d30_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d30_power.M2_CVR
se.d30_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d30_mean[i] <- sd(lnCVR[[i]]$d30_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d30_power.M2_CVR[!is.na(lnCVR[[i]]$d30_power.M2_CVR)]))
}

power.M2_summary_d30_CVR$se.d30_mean <- se.d30_mean




#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d40_power_CVR
se.d40_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d40_mean[i] <- sd(lnCVR[[i]]$d40_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d40_power_CVR[!is.na(lnCVR[[i]]$d40_power_CVR)]))
}

power_summary_d40_CVR$se.d40_mean <- se.d40_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d40_power.S_CVR
se.d40_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d40_mean[i] <- sd(lnCVR[[i]]$d40_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d40_power.S_CVR[!is.na(lnCVR[[i]]$d40_power.S_CVR)]))
}

power.S_summary_d40_CVR$se.d40_mean <- se.d40_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d40_power.M_CVR
se.d40_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d40_mean[i] <- sd(lnCVR[[i]]$d40_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d40_power.M_CVR[!is.na(lnCVR[[i]]$d40_power.M_CVR)]))
}

power.M_summary_d40_CVR$se.d40_mean <- se.d40_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d40_power.M2_CVR
se.d40_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d40_mean[i] <- sd(lnCVR[[i]]$d40_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d40_power.M2_CVR[!is.na(lnCVR[[i]]$d40_power.M2_CVR)]))
}

power.M2_summary_d40_CVR$se.d40_mean <- se.d40_mean




#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d50_power_CVR
se.d50_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d50_mean[i] <- sd(lnCVR[[i]]$d50_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d50_power_CVR[!is.na(lnCVR[[i]]$d50_power_CVR)]))
}

power_summary_d50_CVR$se.d50_mean <- se.d50_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d50_power.S_CVR
se.d50_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d50_mean[i] <- sd(lnCVR[[i]]$d50_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d50_power.S_CVR[!is.na(lnCVR[[i]]$d50_power.S_CVR)]))
}

power.S_summary_d50_CVR$se.d50_mean <- se.d50_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d50_power.M_CVR
se.d50_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d50_mean[i] <- sd(lnCVR[[i]]$d50_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d50_power.M_CVR[!is.na(lnCVR[[i]]$d50_power.M_CVR)]))
}

power.M_summary_d50_CVR$se.d50_mean <- se.d50_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d50_power.M2_CVR
se.d50_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d50_mean[i] <- sd(lnCVR[[i]]$d50_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d50_power.M2_CVR[!is.na(lnCVR[[i]]$d50_power.M2_CVR)]))
}

power.M2_summary_d50_CVR$se.d50_mean <- se.d50_mean




#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d60_power_CVR
se.d60_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d60_mean[i] <- sd(lnCVR[[i]]$d60_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d60_power_CVR[!is.na(lnCVR[[i]]$d60_power_CVR)]))
}

power_summary_d60_CVR$se.d60_mean <- se.d60_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d60_power.S_CVR
se.d60_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d60_mean[i] <- sd(lnCVR[[i]]$d60_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d60_power.S_CVR[!is.na(lnCVR[[i]]$d60_power.S_CVR)]))
}

power.S_summary_d60_CVR$se.d60_mean <- se.d60_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d60_power.M_CVR
se.d60_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d60_mean[i] <- sd(lnCVR[[i]]$d60_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d60_power.M_CVR[!is.na(lnCVR[[i]]$d60_power.M_CVR)]))
}

power.M_summary_d60_CVR$se.d60_mean <- se.d60_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d60_power.M2_CVR
se.d60_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d60_mean[i] <- sd(lnCVR[[i]]$d60_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d60_power.M2_CVR[!is.na(lnCVR[[i]]$d60_power.M2_CVR)]))
}

power.M2_summary_d60_CVR$se.d60_mean <- se.d60_mean




#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d70_power_CVR
se.d70_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d70_mean[i] <- sd(lnCVR[[i]]$d70_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d70_power_CVR[!is.na(lnCVR[[i]]$d70_power_CVR)]))
}

power_summary_d70_CVR$se.d70_mean <- se.d70_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d70_power.S_CVR
se.d70_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d70_mean[i] <- sd(lnCVR[[i]]$d70_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d70_power.S_CVR[!is.na(lnCVR[[i]]$d70_power.S_CVR)]))
}

power.S_summary_d70_CVR$se.d70_mean <- se.d70_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d70_power.M_CVR
se.d70_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d70_mean[i] <- sd(lnCVR[[i]]$d70_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d70_power.M_CVR[!is.na(lnCVR[[i]]$d70_power.M_CVR)]))
}

power.M_summary_d70_CVR$se.d70_mean <- se.d70_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d70_power.M2_CVR
se.d70_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d70_mean[i] <- sd(lnCVR[[i]]$d70_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d70_power.M2_CVR[!is.na(lnCVR[[i]]$d70_power.M2_CVR)]))
}

power.M2_summary_d70_CVR$se.d70_mean <- se.d70_mean



#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d80_power_CVR
se.d80_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d80_mean[i] <- sd(lnCVR[[i]]$d80_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d80_power_CVR[!is.na(lnCVR[[i]]$d80_power_CVR)]))
}

power_summary_d80_CVR$se.d80_mean <- se.d80_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d80_power.S_CVR
se.d80_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d80_mean[i] <- sd(lnCVR[[i]]$d80_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d80_power.S_CVR[!is.na(lnCVR[[i]]$d80_power.S_CVR)]))
}

power.S_summary_d80_CVR$se.d80_mean <- se.d80_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d80_power.M_CVR
se.d80_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d80_mean[i] <- sd(lnCVR[[i]]$d80_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d80_power.M_CVR[!is.na(lnCVR[[i]]$d80_power.M_CVR)]))
}

power.M_summary_d80_CVR$se.d80_mean <- se.d80_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d80_power.M2_CVR
se.d80_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d80_mean[i] <- sd(lnCVR[[i]]$d80_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d80_power.M2_CVR[!is.na(lnCVR[[i]]$d80_power.M2_CVR)]))
}

power.M2_summary_d80_CVR$se.d80_mean <- se.d80_mean



#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d90_power_CVR
se.d90_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d90_mean[i] <- sd(lnCVR[[i]]$d90_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d90_power_CVR[!is.na(lnCVR[[i]]$d90_power_CVR)]))
}

power_summary_d90_CVR$se.d90_mean <- se.d90_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d90_power.S_CVR
se.d90_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d90_mean[i] <- sd(lnCVR[[i]]$d90_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d90_power.S_CVR[!is.na(lnCVR[[i]]$d90_power.S_CVR)]))
}

power.S_summary_d90_CVR$se.d90_mean <- se.d90_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d90_power.M_CVR
se.d90_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d90_mean[i] <- sd(lnCVR[[i]]$d90_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d90_power.M_CVR[!is.na(lnCVR[[i]]$d90_power.M_CVR)]))
}

power.M_summary_d90_CVR$se.d90_mean <- se.d90_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d90_power.M2_CVR
se.d90_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d90_mean[i] <- sd(lnCVR[[i]]$d90_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d90_power.M2_CVR[!is.na(lnCVR[[i]]$d90_power.M2_CVR)]))
}

power.M2_summary_d90_CVR$se.d90_mean <- se.d90_mean



#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d100_power_CVR
se.d100_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d100_mean[i] <- sd(lnCVR[[i]]$d100_power_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d100_power_CVR[!is.na(lnCVR[[i]]$d100_power_CVR)]))
}

power_summary_d100_CVR$se.d100_mean <- se.d100_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d100_power.S_CVR
se.d100_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d100_mean[i] <- sd(lnCVR[[i]]$d100_power.S_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d100_power.S_CVR[!is.na(lnCVR[[i]]$d100_power.S_CVR)]))
}

power.S_summary_d100_CVR$se.d100_mean <- se.d100_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d100_power.M_CVR
se.d100_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d100_mean[i] <- sd(lnCVR[[i]]$d100_power.M_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d100_power.M_CVR[!is.na(lnCVR[[i]]$d100_power.M_CVR)]))
}

power.M_summary_d100_CVR$se.d100_mean <- se.d100_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d100_power.M2_CVR
se.d100_mean <- NA
for (i in 1:length(lnCVR)) {
  se.d100_mean[i] <- sd(lnCVR[[i]]$d100_power.M2_CVR, na.rm=TRUE) / sqrt(length(lnCVR[[i]]$d100_power.M2_CVR[!is.na(lnCVR[[i]]$d100_power.M2_CVR)]))
}

power.M2_summary_d100_CVR$se.d100_mean <- se.d100_mean


#****************************************************************#
#-----------------------------lnVR-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_VR
se.F_mean <- NA
for (i in 1:length(lnVR)) {
  se.F_mean[i] <- sd(lnVR[[i]]$power.F_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.F_VR[!is.na(lnVR[[i]]$power.F_VR)]))
}

power.F_summary_VR$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_VR
se.F.S_mean <- NA
for (i in 1:length(lnVR)) {
  se.F.S_mean[i] <- sd(lnVR[[i]]$power.F.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.F.S_VR[!is.na(lnVR[[i]]$power.F.S_VR)]))
}

power.F.S_summary_VR$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_VR
se.F.M_mean <- NA
for (i in 1:length(lnVR)) {
  se.F.M_mean[i] <- sd(lnVR[[i]]$power.F.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.F.M_VR[!is.na(lnVR[[i]]$power.F.M_VR)]))
}

power.F.M_summary_VR$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(lnVR)) {
  se.F.M2_mean[i] <- sd(lnVR[[i]]$power.F.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.F.M2_VR[!is.na(lnVR[[i]]$power.F.M2_VR)]))
}

power.F.M2_summary_VR$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_VR
se.R_mean <- NA
for (i in 1:length(lnVR)) {
  se.R_mean[i] <- sd(lnVR[[i]]$power.R_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.R_VR[!is.na(lnVR[[i]]$power.R_VR)]))
}

power.R_summary_VR$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_VR
se.R.S_mean <- NA
for (i in 1:length(lnVR)) {
  se.R.S_mean[i] <- sd(lnVR[[i]]$power.R.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.R.S_VR[!is.na(lnVR[[i]]$power.R.S_VR)]))
}

power.R.S_summary_VR$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_VR
se.R.M_mean <- NA
for (i in 1:length(lnVR)) {
  se.R.M_mean[i] <- sd(lnVR[[i]]$power.R.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.R.M_VR[!is.na(lnVR[[i]]$power.R.M_VR)]))
}

power.R.M_summary_VR$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(lnVR)) {
  se.R.M2_mean[i] <- sd(lnVR[[i]]$power.R.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$power.R.M2_VR[!is.na(lnVR[[i]]$power.R.M2_VR)]))
}

power.R.M2_summary_VR$se.R.M2_mean <- se.R.M2_mean



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#

#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d1_power_VR
se.d1_mean <- NA
for (i in 1:length(lnVR)) {
  se.d1_mean[i] <- sd(lnVR[[i]]$d1_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d1_power_VR[!is.na(lnVR[[i]]$d1_power_VR)]))
}

power_summary_d1_VR$se.d1_mean <- se.d1_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d1_power.S_VR
se.d1_mean <- NA
for (i in 1:length(lnVR)) {
  se.d1_mean[i] <- sd(lnVR[[i]]$d1_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d1_power.S_VR[!is.na(lnVR[[i]]$d1_power.S_VR)]))
}

power.S_summary_d1_VR$se.d1_mean <- se.d1_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d1_power.M_VR
se.d1_mean <- NA
for (i in 1:length(lnVR)) {
  se.d1_mean[i] <- sd(lnVR[[i]]$d1_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d1_power.M_VR[!is.na(lnVR[[i]]$d1_power.M_VR)]))
}

power.M_summary_d1_VR$se.d1_mean <- se.d1_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d1_power.M2_VR
se.d1_mean <- NA
for (i in 1:length(lnVR)) {
  se.d1_mean[i] <- sd(lnVR[[i]]$d1_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d1_power.M2_VR[!is.na(lnVR[[i]]$d1_power.M2_VR)]))
}

power.M2_summary_d1_VR$se.d1_mean <- se.d1_mean





#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d5_power_VR
se.d5_mean <- NA
for (i in 1:length(lnVR)) {
  se.d5_mean[i] <- sd(lnVR[[i]]$d5_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d5_power_VR[!is.na(lnVR[[i]]$d5_power_VR)]))
}

power_summary_d5_VR$se.d5_mean <- se.d5_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d5_power.S_VR
se.d5_mean <- NA
for (i in 1:length(lnVR)) {
  se.d5_mean[i] <- sd(lnVR[[i]]$d5_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d5_power.S_VR[!is.na(lnVR[[i]]$d5_power.S_VR)]))
}

power.S_summary_d5_VR$se.d5_mean <- se.d5_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d5_power.M_VR
se.d5_mean <- NA
for (i in 1:length(lnVR)) {
  se.d5_mean[i] <- sd(lnVR[[i]]$d5_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d5_power.M_VR[!is.na(lnVR[[i]]$d5_power.M_VR)]))
}

power.M_summary_d5_VR$se.d5_mean <- se.d5_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d5_power.M2_VR
se.d5_mean <- NA
for (i in 1:length(lnVR)) {
  se.d5_mean[i] <- sd(lnVR[[i]]$d5_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d5_power.M2_VR[!is.na(lnVR[[i]]$d5_power.M2_VR)]))
}

power.M2_summary_d5_VR$se.d5_mean <- se.d5_mean



#*****************************************************************#
#********************** 10% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d10_power_VR
se.d10_mean <- NA
for (i in 1:length(lnVR)) {
  se.d10_mean[i] <- sd(lnVR[[i]]$d10_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d10_power_VR[!is.na(lnVR[[i]]$d10_power_VR)]))
}

power_summary_d10_VR$se.d10_mean <- se.d10_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d10_power.S_VR
se.d10_mean <- NA
for (i in 1:length(lnVR)) {
  se.d10_mean[i] <- sd(lnVR[[i]]$d10_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d10_power.S_VR[!is.na(lnVR[[i]]$d10_power.S_VR)]))
}

power.S_summary_d10_VR$se.d10_mean <- se.d10_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d10_power.M_VR
se.d10_mean <- NA
for (i in 1:length(lnVR)) {
  se.d10_mean[i] <- sd(lnVR[[i]]$d10_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d10_power.M_VR[!is.na(lnVR[[i]]$d10_power.M_VR)]))
}

power.M_summary_d10_VR$se.d10_mean <- se.d10_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d10_power.M2_VR
se.d10_mean <- NA
for (i in 1:length(lnVR)) {
  se.d10_mean[i] <- sd(lnVR[[i]]$d10_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d10_power.M2_VR[!is.na(lnVR[[i]]$d10_power.M2_VR)]))
}

power.M2_summary_d10_VR$se.d10_mean <- se.d10_mean



#*****************************************************************#
#********************** 20% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d20_power_VR
se.d20_mean <- NA
for (i in 1:length(lnVR)) {
  se.d20_mean[i] <- sd(lnVR[[i]]$d20_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d20_power_VR[!is.na(lnVR[[i]]$d20_power_VR)]))
}

power_summary_d20_VR$se.d20_mean <- se.d20_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d20_power.S_VR
se.d20_mean <- NA
for (i in 1:length(lnVR)) {
  se.d20_mean[i] <- sd(lnVR[[i]]$d20_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d20_power.S_VR[!is.na(lnVR[[i]]$d20_power.S_VR)]))
}

power.S_summary_d20_VR$se.d20_mean <- se.d20_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d20_power.M_VR
se.d20_mean <- NA
for (i in 1:length(lnVR)) {
  se.d20_mean[i] <- sd(lnVR[[i]]$d20_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d20_power.M_VR[!is.na(lnVR[[i]]$d20_power.M_VR)]))
}

power.M_summary_d20_VR$se.d20_mean <- se.d20_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d20_power.M2_VR
se.d20_mean <- NA
for (i in 1:length(lnVR)) {
  se.d20_mean[i] <- sd(lnVR[[i]]$d20_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d20_power.M2_VR[!is.na(lnVR[[i]]$d20_power.M2_VR)]))
}

power.M2_summary_d20_VR$se.d20_mean <- se.d20_mean




#*****************************************************************#
#********************** 30% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d30_power_VR
se.d30_mean <- NA
for (i in 1:length(lnVR)) {
  se.d30_mean[i] <- sd(lnVR[[i]]$d30_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d30_power_VR[!is.na(lnVR[[i]]$d30_power_VR)]))
}

power_summary_d30_VR$se.d30_mean <- se.d30_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d30_power.S_VR
se.d30_mean <- NA
for (i in 1:length(lnVR)) {
  se.d30_mean[i] <- sd(lnVR[[i]]$d30_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d30_power.S_VR[!is.na(lnVR[[i]]$d30_power.S_VR)]))
}

power.S_summary_d30_VR$se.d30_mean <- se.d30_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d30_power.M_VR
se.d30_mean <- NA
for (i in 1:length(lnVR)) {
  se.d30_mean[i] <- sd(lnVR[[i]]$d30_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d30_power.M_VR[!is.na(lnVR[[i]]$d30_power.M_VR)]))
}

power.M_summary_d30_VR$se.d30_mean <- se.d30_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d30_power.M2_VR
se.d30_mean <- NA
for (i in 1:length(lnVR)) {
  se.d30_mean[i] <- sd(lnVR[[i]]$d30_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d30_power.M2_VR[!is.na(lnVR[[i]]$d30_power.M2_VR)]))
}

power.M2_summary_d30_VR$se.d30_mean <- se.d30_mean




#*****************************************************************#
#********************** 40% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d40_power_VR
se.d40_mean <- NA
for (i in 1:length(lnVR)) {
  se.d40_mean[i] <- sd(lnVR[[i]]$d40_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d40_power_VR[!is.na(lnVR[[i]]$d40_power_VR)]))
}

power_summary_d40_VR$se.d40_mean <- se.d40_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d40_power.S_VR
se.d40_mean <- NA
for (i in 1:length(lnVR)) {
  se.d40_mean[i] <- sd(lnVR[[i]]$d40_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d40_power.S_VR[!is.na(lnVR[[i]]$d40_power.S_VR)]))
}

power.S_summary_d40_VR$se.d40_mean <- se.d40_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d40_power.M_VR
se.d40_mean <- NA
for (i in 1:length(lnVR)) {
  se.d40_mean[i] <- sd(lnVR[[i]]$d40_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d40_power.M_VR[!is.na(lnVR[[i]]$d40_power.M_VR)]))
}

power.M_summary_d40_VR$se.d40_mean <- se.d40_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d40_power.M2_VR
se.d40_mean <- NA
for (i in 1:length(lnVR)) {
  se.d40_mean[i] <- sd(lnVR[[i]]$d40_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d40_power.M2_VR[!is.na(lnVR[[i]]$d40_power.M2_VR)]))
}

power.M2_summary_d40_VR$se.d40_mean <- se.d40_mean






#*****************************************************************#
#********************** 50% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d50_power_VR
se.d50_mean <- NA
for (i in 1:length(lnVR)) {
  se.d50_mean[i] <- sd(lnVR[[i]]$d50_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d50_power_VR[!is.na(lnVR[[i]]$d50_power_VR)]))
}

power_summary_d50_VR$se.d50_mean <- se.d50_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d50_power.S_VR
se.d50_mean <- NA
for (i in 1:length(lnVR)) {
  se.d50_mean[i] <- sd(lnVR[[i]]$d50_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d50_power.S_VR[!is.na(lnVR[[i]]$d50_power.S_VR)]))
}

power.S_summary_d50_VR$se.d50_mean <- se.d50_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d50_power.M_VR
se.d50_mean <- NA
for (i in 1:length(lnVR)) {
  se.d50_mean[i] <- sd(lnVR[[i]]$d50_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d50_power.M_VR[!is.na(lnVR[[i]]$d50_power.M_VR)]))
}

power.M_summary_d50_VR$se.d50_mean <- se.d50_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d50_power.M2_VR
se.d50_mean <- NA
for (i in 1:length(lnVR)) {
  se.d50_mean[i] <- sd(lnVR[[i]]$d50_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d50_power.M2_VR[!is.na(lnVR[[i]]$d50_power.M2_VR)]))
}

power.M2_summary_d50_VR$se.d50_mean <- se.d50_mean




#*****************************************************************#
#********************** 60% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d60_power_VR
se.d60_mean <- NA
for (i in 1:length(lnVR)) {
  se.d60_mean[i] <- sd(lnVR[[i]]$d60_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d60_power_VR[!is.na(lnVR[[i]]$d60_power_VR)]))
}

power_summary_d60_VR$se.d60_mean <- se.d60_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d60_power.S_VR
se.d60_mean <- NA
for (i in 1:length(lnVR)) {
  se.d60_mean[i] <- sd(lnVR[[i]]$d60_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d60_power.S_VR[!is.na(lnVR[[i]]$d60_power.S_VR)]))
}

power.S_summary_d60_VR$se.d60_mean <- se.d60_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d60_power.M_VR
se.d60_mean <- NA
for (i in 1:length(lnVR)) {
  se.d60_mean[i] <- sd(lnVR[[i]]$d60_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d60_power.M_VR[!is.na(lnVR[[i]]$d60_power.M_VR)]))
}

power.M_summary_d60_VR$se.d60_mean <- se.d60_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d60_power.M2_VR
se.d60_mean <- NA
for (i in 1:length(lnVR)) {
  se.d60_mean[i] <- sd(lnVR[[i]]$d60_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d60_power.M2_VR[!is.na(lnVR[[i]]$d60_power.M2_VR)]))
}

power.M2_summary_d60_VR$se.d60_mean <- se.d60_mean




#*****************************************************************#
#********************** 70% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d70_power_VR
se.d70_mean <- NA
for (i in 1:length(lnVR)) {
  se.d70_mean[i] <- sd(lnVR[[i]]$d70_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d70_power_VR[!is.na(lnVR[[i]]$d70_power_VR)]))
}

power_summary_d70_VR$se.d70_mean <- se.d70_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d70_power.S_VR
se.d70_mean <- NA
for (i in 1:length(lnVR)) {
  se.d70_mean[i] <- sd(lnVR[[i]]$d70_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d70_power.S_VR[!is.na(lnVR[[i]]$d70_power.S_VR)]))
}

power.S_summary_d70_VR$se.d70_mean <- se.d70_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d70_power.M_VR
se.d70_mean <- NA
for (i in 1:length(lnVR)) {
  se.d70_mean[i] <- sd(lnVR[[i]]$d70_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d70_power.M_VR[!is.na(lnVR[[i]]$d70_power.M_VR)]))
}

power.M_summary_d70_VR$se.d70_mean <- se.d70_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d70_power.M2_VR
se.d70_mean <- NA
for (i in 1:length(lnVR)) {
  se.d70_mean[i] <- sd(lnVR[[i]]$d70_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d70_power.M2_VR[!is.na(lnVR[[i]]$d70_power.M2_VR)]))
}

power.M2_summary_d70_VR$se.d70_mean <- se.d70_mean





#*****************************************************************#
#********************** 80% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d80_power_VR
se.d80_mean <- NA
for (i in 1:length(lnVR)) {
  se.d80_mean[i] <- sd(lnVR[[i]]$d80_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d80_power_VR[!is.na(lnVR[[i]]$d80_power_VR)]))
}

power_summary_d80_VR$se.d80_mean <- se.d80_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d80_power.S_VR
se.d80_mean <- NA
for (i in 1:length(lnVR)) {
  se.d80_mean[i] <- sd(lnVR[[i]]$d80_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d80_power.S_VR[!is.na(lnVR[[i]]$d80_power.S_VR)]))
}

power.S_summary_d80_VR$se.d80_mean <- se.d80_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d80_power.M_VR
se.d80_mean <- NA
for (i in 1:length(lnVR)) {
  se.d80_mean[i] <- sd(lnVR[[i]]$d80_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d80_power.M_VR[!is.na(lnVR[[i]]$d80_power.M_VR)]))
}

power.M_summary_d80_VR$se.d80_mean <- se.d80_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d80_power.M2_VR
se.d80_mean <- NA
for (i in 1:length(lnVR)) {
  se.d80_mean[i] <- sd(lnVR[[i]]$d80_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d80_power.M2_VR[!is.na(lnVR[[i]]$d80_power.M2_VR)]))
}

power.M2_summary_d80_VR$se.d80_mean <- se.d80_mean



#*****************************************************************#
#********************** 90% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d90_power_VR
se.d90_mean <- NA
for (i in 1:length(lnVR)) {
  se.d90_mean[i] <- sd(lnVR[[i]]$d90_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d90_power_VR[!is.na(lnVR[[i]]$d90_power_VR)]))
}

power_summary_d90_VR$se.d90_mean <- se.d90_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d90_power.S_VR
se.d90_mean <- NA
for (i in 1:length(lnVR)) {
  se.d90_mean[i] <- sd(lnVR[[i]]$d90_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d90_power.S_VR[!is.na(lnVR[[i]]$d90_power.S_VR)]))
}

power.S_summary_d90_VR$se.d90_mean <- se.d90_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d90_power.M_VR
se.d90_mean <- NA
for (i in 1:length(lnVR)) {
  se.d90_mean[i] <- sd(lnVR[[i]]$d90_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d90_power.M_VR[!is.na(lnVR[[i]]$d90_power.M_VR)]))
}

power.M_summary_d90_VR$se.d90_mean <- se.d90_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d90_power.M2_VR
se.d90_mean <- NA
for (i in 1:length(lnVR)) {
  se.d90_mean[i] <- sd(lnVR[[i]]$d90_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d90_power.M2_VR[!is.na(lnVR[[i]]$d90_power.M2_VR)]))
}

power.M2_summary_d90_VR$se.d90_mean <- se.d90_mean





#*****************************************************************#
#********************** 100% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d100_power_VR
se.d100_mean <- NA
for (i in 1:length(lnVR)) {
  se.d100_mean[i] <- sd(lnVR[[i]]$d100_power_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d100_power_VR[!is.na(lnVR[[i]]$d100_power_VR)]))
}

power_summary_d100_VR$se.d100_mean <- se.d100_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d100_power.S_VR
se.d100_mean <- NA
for (i in 1:length(lnVR)) {
  se.d100_mean[i] <- sd(lnVR[[i]]$d100_power.S_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d100_power.S_VR[!is.na(lnVR[[i]]$d100_power.S_VR)]))
}

power.S_summary_d100_VR$se.d100_mean <- se.d100_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d100_power.M_VR
se.d100_mean <- NA
for (i in 1:length(lnVR)) {
  se.d100_mean[i] <- sd(lnVR[[i]]$d100_power.M_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d100_power.M_VR[!is.na(lnVR[[i]]$d100_power.M_VR)]))
}

power.M_summary_d100_VR$se.d100_mean <- se.d100_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d100_power.M2_VR
se.d100_mean <- NA
for (i in 1:length(lnVR)) {
  se.d100_mean[i] <- sd(lnVR[[i]]$d100_power.M2_VR, na.rm=TRUE) / sqrt(length(lnVR[[i]]$d100_power.M2_VR[!is.na(lnVR[[i]]$d100_power.M2_VR)]))
}

power.M2_summary_d100_VR$se.d100_mean <- se.d100_mean



#*********************************************************************#
#-------------------- meta-meta-analysis on power --------------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------lnCVR------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

# add study ID

# add N and k
N_CVR <- NA
for (i in 1:length(lnCVR)) {
  N_CVR[i] <- lnCVR[[i]]$Unit_ID %>% length()
}

k_CVR <- NA
for (i in 1:length(lnCVR)) {
  k_CVR[i] <- lnCVR[[i]]$Study %>% length()
}

power.F_summary_CVR$N <- N_CVR
power.F_summary_CVR$k <- k_CVR



approach_CVR <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_CVR <- c("Pr","Pr", "Pr","Pr", "Pr", "Pr","Pr","Pr","Pr","Pr", "Pr", "Pr")

stressor_CVR <- c("BD_loss","BD_loss", "Fert", "Fert", "Fert", "LUC","LUC","LUC","LUC","LUC", "LUC", "Inv")

stressor_CVR %>% as.data.frame() # check the correctness


moderator_CVR <- cbind(approach_CVR,treatment_CVR,stressor_CVR)

power.F_summary_CVR <- cbind(power.F_summary_CVR, moderator_CVR)

# convert moderator to factor with desired ordering of levels
power.F_summary_CVR$approach_CVR <- factor(power.F_summary_CVR$approach_CVR, levels=c("O", "E"))

MMA_power.F_CVR.approach <- with(power.F_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_CVR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_CVR.stressor <- with(power.F_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_CVR) -1, method = "REML", test = "t")) 

MMA_power.F_CVR <- with(power.F_summary_CVR, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_CVR <- cbind(power.F.S_summary_CVR, moderator_CVR)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_CVR$approach_CVR <- factor(power.F.S_summary_CVR$approach_CVR, levels=c("O", "E"))

MMA_power.F.S_CVR.approach <- with(power.F.S_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_CVR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_CVR.stressor <- with(power.F.S_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_CVR) -1, method = "REML", test = "t"))

MMA_power.F.S_CVR <- with(power.F.S_summary_CVR, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_CVR <- cbind(power.F.M_summary_CVR, moderator_CVR)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_CVR$approach_CVR <- factor(power.F.M_summary_CVR$approach_CVR, levels=c("O", "E"))

MMA_power.F.M_CVR.approach <- with(power.F.M_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_CVR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_CVR.stressor <- with(power.F.M_summary_CVR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_CVR) -1, method = "REML", test = "t"))

MMA_power.F.M_CVR <- with(power.F.M_summary_CVR, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_CVR <- with(power.F.M2_summary_CVR, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#
MMA_power.R_CVR <- with(power.R_summary_CVR, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))

MMA_power.R.S_CVR <- with(power.R.S_summary_CVR, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))

MMA_power.R.M_CVR <- with(power.R.M_summary_CVR, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t"))

MMA_power.R.M2_CVR <- with(power.R.M2_summary_CVR, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#
MMA_power_CVR_d1 <- with(power_summary_d1_CVR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d1 <- with(power.S_summary_d1_CVR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d1 <- with(power.M_summary_d1_CVR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d1 <- with(power.M2_summary_d1_CVR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#
MMA_power_CVR_d5 <- with(power_summary_d5_CVR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d5 <- with(power.S_summary_d5_CVR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d5 <- with(power.M_summary_d5_CVR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d5 <- with(power.M2_summary_d5_CVR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 10% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d10 <- with(power_summary_d10_CVR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d10 <- with(power.S_summary_d10_CVR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d10 <- with(power.M_summary_d10_CVR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d10 <- with(power.M2_summary_d10_CVR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 20% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d20 <- with(power_summary_d20_CVR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d20 <- with(power.S_summary_d20_CVR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d20 <- with(power.M_summary_d20_CVR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d20 <- with(power.M2_summary_d20_CVR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 30% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d30 <- with(power_summary_d30_CVR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d30 <- with(power.S_summary_d30_CVR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d30 <- with(power.M_summary_d30_CVR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d30 <- with(power.M2_summary_d30_CVR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

#*****************************************************************#
#********************** 40% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d40 <- with(power_summary_d40_CVR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d40 <- with(power.S_summary_d40_CVR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d40 <- with(power.M_summary_d40_CVR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d40 <- with(power.M2_summary_d40_CVR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 50% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d50 <- with(power_summary_d50_CVR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d50 <- with(power.S_summary_d50_CVR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d50 <- with(power.M_summary_d50_CVR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d50 <- with(power.M2_summary_d50_CVR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 60% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d60 <- with(power_summary_d60_CVR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d60 <- with(power.S_summary_d60_CVR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d60 <- with(power.M_summary_d60_CVR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d60 <- with(power.M2_summary_d60_CVR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))




#*****************************************************************#
#********************** 70% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d70 <- with(power_summary_d70_CVR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d70 <- with(power.S_summary_d70_CVR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d70 <- with(power.M_summary_d70_CVR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d70 <- with(power.M2_summary_d70_CVR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 80% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d80 <- with(power_summary_d80_CVR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d80 <- with(power.S_summary_d80_CVR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d80 <- with(power.M_summary_d80_CVR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d80 <- with(power.M2_summary_d80_CVR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 90% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d90 <- with(power_summary_d90_CVR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d90 <- with(power.S_summary_d90_CVR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d90 <- with(power.M_summary_d90_CVR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d90 <- with(power.M2_summary_d90_CVR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 100% mean differences *********************#
#*****************************************************************#
MMA_power_CVR_d100 <- with(power_summary_d100_CVR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.S_CVR_d100 <- with(power.S_summary_d100_CVR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.M_CVR_d100 <- with(power.M_summary_d100_CVR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.M2_CVR_d100 <- with(power.M2_summary_d100_CVR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))



#****************************************************************#
#-----------------------------lnVR-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#
# add study ID

# add N and k
N_VR <- NA
for (i in 1:length(lnVR)) {
  N_VR[i] <- lnVR[[i]]$Unit_ID %>% length()
}

k_VR <- NA
for (i in 1:length(lnVR)) {
  k_VR[i] <- lnVR[[i]]$Study %>% length()
}

power.F_summary_VR$N <- N_VR
power.F_summary_VR$k <- k_VR



approach_VR <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_VR <- c("Pr","Pr", "Pr","Pr", "Pr", "Pr","Pr","Pr","Pr","Pr", "Pr", "Pr")

stressor_VR <- c("BD_loss","BD_loss", "Fert", "Fert", "Fert", "LUC","LUC","LUC","LUC","LUC", "LUC", "Inv")

stressor_VR %>% as.data.frame() # check the correctness


moderator_VR <- cbind(approach_VR,treatment_VR,stressor_VR)

power.F_summary_VR <- cbind(power.F_summary_VR, moderator_VR)

# convert moderator to factor with desired ordering of levels
power.F_summary_VR$approach_VR <- factor(power.F_summary_VR$approach_VR, levels=c("O", "E"))

MMA_power.F_VR.approach <- with(power.F_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_VR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_VR.stressor <- with(power.F_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_VR) -1, method = "REML", test = "t")) 

MMA_power.F_VR <- with(power.F_summary_VR, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_VR <- cbind(power.F.S_summary_VR, moderator_VR)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_VR$approach_VR <- factor(power.F.S_summary_VR$approach_VR, levels=c("O", "E"))

MMA_power.F.S_VR.approach <- with(power.F.S_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_VR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_VR.stressor <- with(power.F.S_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_VR) -1, method = "REML", test = "t"))

MMA_power.F.S_VR <- with(power.F.S_summary_VR, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_VR <- cbind(power.F.M_summary_VR, moderator_VR)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_VR$approach_VR <- factor(power.F.M_summary_VR$approach_VR, levels=c("O", "E"))

MMA_power.F.M_VR.approach <- with(power.F.M_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_VR) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_VR.stressor <- with(power.F.M_summary_VR, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_VR) -1, method = "REML", test = "t"))

MMA_power.F.M_VR <- with(power.F.M_summary_VR, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_VR <- with(power.F.M2_summary_VR, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))





#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#
MMA_power.R_VR <- with(power.R_summary_VR, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))

MMA_power.R.S_VR <- with(power.R.S_summary_VR, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))

MMA_power.R.M_VR <- with(power.R.M_summary_VR, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t"))

MMA_power.R.M2_VR <- with(power.R.M2_summary_VR, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))



#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#

#*****************************************************************#
#********************** 1% mean differences **********************#
#*****************************************************************#
MMA_power_VR_d1 <- with(power_summary_d1_VR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d1 <- with(power.S_summary_d1_VR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d1 <- with(power.M_summary_d1_VR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d1 <- with(power.M2_summary_d1_VR, rma(yi = Mean, sei = se.d1_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 5% mean differences **********************#
#*****************************************************************#
MMA_power_VR_d5 <- with(power_summary_d5_VR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d5 <- with(power.S_summary_d5_VR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d5 <- with(power.M_summary_d5_VR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d5 <- with(power.M2_summary_d5_VR, rma(yi = Mean, sei = se.d5_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 10% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d10 <- with(power_summary_d10_VR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d10 <- with(power.S_summary_d10_VR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d10 <- with(power.M_summary_d10_VR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d10 <- with(power.M2_summary_d10_VR, rma(yi = Mean, sei = se.d10_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 20% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d20 <- with(power_summary_d20_VR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d20 <- with(power.S_summary_d20_VR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d20 <- with(power.M_summary_d20_VR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d20 <- with(power.M2_summary_d20_VR, rma(yi = Mean, sei = se.d20_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 30% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d30 <- with(power_summary_d30_VR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d30 <- with(power.S_summary_d30_VR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d30 <- with(power.M_summary_d30_VR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d30 <- with(power.M2_summary_d30_VR, rma(yi = Mean, sei = se.d30_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 40% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d40 <- with(power_summary_d40_VR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d40 <- with(power.S_summary_d40_VR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d40 <- with(power.M_summary_d40_VR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d40 <- with(power.M2_summary_d40_VR, rma(yi = Mean, sei = se.d40_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 50% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d50 <- with(power_summary_d50_VR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d50 <- with(power.S_summary_d50_VR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d50 <- with(power.M_summary_d50_VR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d50 <- with(power.M2_summary_d50_VR, rma(yi = Mean, sei = se.d50_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 60% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d60 <- with(power_summary_d60_VR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d60 <- with(power.S_summary_d60_VR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d60 <- with(power.M_summary_d60_VR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d60 <- with(power.M2_summary_d60_VR, rma(yi = Mean, sei = se.d60_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 70% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d70 <- with(power_summary_d70_VR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d70 <- with(power.S_summary_d70_VR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d70 <- with(power.M_summary_d70_VR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d70 <- with(power.M2_summary_d70_VR, rma(yi = Mean, sei = se.d70_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 80% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d80 <- with(power_summary_d80_VR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d80 <- with(power.S_summary_d80_VR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d80 <- with(power.M_summary_d80_VR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d80 <- with(power.M2_summary_d80_VR, rma(yi = Mean, sei = se.d80_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 90% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d90 <- with(power_summary_d90_VR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d90 <- with(power.S_summary_d90_VR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d90 <- with(power.M_summary_d90_VR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d90 <- with(power.M2_summary_d90_VR, rma(yi = Mean, sei = se.d90_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 100% mean differences *********************#
#*****************************************************************#
MMA_power_VR_d100 <- with(power_summary_d100_VR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.S_VR_d100 <- with(power.S_summary_d100_VR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.M_VR_d100 <- with(power.M_summary_d100_VR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))

MMA_power.M2_VR_d100 <- with(power.M2_summary_d100_VR, rma(yi = Mean, sei = se.d100_mean,   method = "REML", test = "t"))



```



### power SMD and SMDH

```{r}
#***************************************************************#
#             power for 12 meta-analytic cases                  #
#***************************************************************#



# make a list of data
dat_list_SMD <- list(raw_m1_1,
                           raw_m1_2,
                           raw_m2_1,
                           raw_m2_2,
                           raw_m5_1,
                           raw_m6_1,
                           raw_m6_2,
                           raw_m6_3,
                           raw_m6_4,
                           raw_m6_5,
                           raw_m9_1,
                           raw_m11_1)

# calculate the number of total effect sizes - sample size
ES_number <- NA
ES_number <- mapply(unique, sapply(dat_list_SMD, function(x) x$Unit_ID)) 
unlist(ES_number) %>% length() # 2004


# calculate 2 type of effect size statistics (i.e. lnRR, SMD and SMDH)
lnRR <- NA
for (i in 1:length(dat_list_SMD)) {
  lnRR[i] <- escalc(measure = "ROM",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_SMD[[i]]) %>% list()
}

SMD <- NA
for (i in 1:length(dat_list_SMD)) {
  SMD[i] <- escalc(measure = "SMD",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_SMD[[i]]) %>% list()
}

SMDH <- NA
for (i in 1:length(dat_list_SMD)) {
  SMDH[i] <- escalc(measure = "SMDH",
                    m1i = T_mean,
                    m2i = C_mean,
                    sd1i = T_sd,
                    sd2i = C_sd,
                    n1i = T_N,
                    n2i = C_N,
                    data = dat_list_SMD[[i]]) %>% list()
} 


# clean NA
for (i in 1:12) {
  SMD[[i]] <- SMD[[i]][!is.na(SMD[[i]]$yi),]
}

for (i in 1:12) {
  SMDH[[i]] <- SMDH[[i]][!is.na(SMDH[[i]]$yi),]
}


# prepare "ture" effect of variation (i.e. SMD and SMDH) for power analysis - fit multi-level meta-analytic models
model_list_SMD<- NA
for (i in 1:length(dat_list_SMD)) {
 model_list_SMD[i] <- rma.mv(data = SMD[[i]], yi = yi, V = vi, random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}

model_list_SMDH<- NA
for (i in 1:length(dat_list_SMD)) {
 model_list_SMDH[i] <- rma.mv(data = SMDH[[i]], yi = yi, V = vi, random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}


#****************************************************************#
#------------------------------SMD-----------------------------#
#****************************************************************#

# we assume meta-analytic mean as ture effect, so we need to get estimate (mu) and corresponding error (SE)
model_est_SMD <- data.frame(MA_case=c("m1_1",
                                      "m1_2",
                                      "m2_1",
                                      "m2_2",
                                      "m5_1",
                                      "m6_1",
                                      "m6_2",
                                      "m6_3",
                                      "m6_4",
                                      "m6_5",
                                      "m9_1",
                                      "m11_1"),
                  mu_SMD=sapply(model_list_SMD, function(x) x$beta),
                  SE_SMD=sapply(model_list_SMD, function(x) x$se),
                  ll_NHST=sapply(model_list_SMD, function(x) x$ci.lb),
                  ul_NHST=sapply(model_list_SMD, function(x) x$ci.ub),
                  p_value=sapply(model_list_SMD, function(x) x$pval) %>% round(4))



#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_SMD$MA.power <- power.ma_Shinichi(mu=model_est_SMD$mu,SE=model_est_SMD$SE)


#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_SMD$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_SMD$mu[i],se=model_est_SMD$SE[i],alpha=0.05) %>% unlist()
}

model_est_SMD$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_SMD$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_SMD$mu[i],se=model_est_SMD$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_SMD$MA.power.M <- MA.power.M


#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#
MA.power.M2 <- NA
for (i in 1:length(model_est_SMD$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_SMD$mu[i],se=model_est_SMD$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_SMD$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_SMD, file = "./meta-analysis power_SMD.csv", row.names = FALSE)


#****************************************************************#
#-------------------------------SMDH-----------------------------#
#****************************************************************#

# we assume meta-analytic mean as ture effect, so we need to get estimate (mu) and corresponding error (SE)

model_est_SMDH <- data.frame(MA_case=model_est_SMD$MA_case,
                  mu_SMDH=sapply(model_list_SMDH, function(x) x$beta),
                  SE_SMDH=sapply(model_list_SMDH, function(x) x$se),
                  ll_NHST=sapply(model_list_SMDH, function(x) x$ci.lb),
                  ul_NHST=sapply(model_list_SMDH, function(x) x$ci.ub),
                  p_value=sapply(model_list_SMDH, function(x) x$pval))

#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_SMDH$MA.power <- power.ma_Shinichi(mu=model_est_SMDH$mu,SE=model_est_SMDH$SE)

#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_SMDH$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_SMDH$mu[i],se=model_est_SMDH$SE[i],alpha=0.05) %>% unlist()
}

model_est_SMDH$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_SMDH$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_SMDH$mu[i],se=model_est_SMDH$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_SMDH$MA.power.M <- MA.power.M

#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#  
MA.power.M2 <- NA
for (i in 1:length(model_est_SMDH$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_SMDH$mu[i],se=model_est_SMDH$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_SMDH$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_SMDH, file = "./meta-analysis power_SMDH.csv", row.names = FALSE)


#***************************************************************#
#        power for empirical studies within meta-analysis       #
#***************************************************************#

# We have three approaches for calculating empirical studies within meta-analysis: (i) using meta-analytic estimate (i.e. intercept or fixed effect) as true effect; (ii) using effect size specific effect as true effect (i.e. fixed plus random effect), which accomodate between-study heterogeneity; (iii) postulated (i.e. hypothetical) effect as true effect - 5%, 10%, 20%, 40% difference)


#****************************************************************#
#------------------------------SMD-----------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# SMD
power.F_SMD <- NA
for (i in 1:length(SMD)) {
  power.F_SMD[i] <- power.individual_Shinichi(mu=rep(model_list_SMD[[i]]$beta, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_SMD)) {
  SMD[[i]]$power.F_SMD <- power.F_SMD[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.S_SMD[i] <- mapply(error_S,mu=rep(model_list_SMD[[i]]$beta, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_SMD)) {
  SMD[[i]]$power.F.S_SMD <- power.F.S_SMD[[i]]
}



#---------------- (3) type M error (relative error) --------------#
power.F.M_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.M_SMD[i] <-mapply(error_M,mu=rep(model_list_SMD[[i]]$beta, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_SMD)) {
  SMD[[i]]$power.F.M_SMD <- power.F.M_SMD[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.M2_SMD[i] <-mapply(error_M2,mu=rep(model_list_SMD[[i]]$beta, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_SMD)) {
  SMD[[i]]$power.F.M2_SMD <- power.F.M2_SMD[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_SMD <- NA
for (i in 1:length(model_list_SMD)) {
  blups.list_SMD[i] <- ranef(model_list_SMD[[i]]) %>% list()
}

# get study index - match two components of random effect
index.list_SMD <- NA # list()
for (i in 1:length(model_list_SMD)) {
  index.list_SMD[i] <- match(as.character(SMD[[i]]$Study),rownames(blups.list_SMD[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_SMD <-NA
for (i in 1:length(model_list_SMD)) {
  effect.R_SMD[i] <- mapply(sum, model_list_SMD[[i]]$beta, blups.list_SMD[[i]]$Study[index.list_SMD[[i]],1], blups.list_SMD[[i]]$Unit_ID[,1]) %>% list()
}


#--------------------- (1) two tailed power ---------------------#
power.R_SMD <- NA
for (i in 1:length(dat_list_SMD)) {
  power.R_SMD[i] <- power.individual_Shinichi(mu=effect.R_SMD[[i]], se=sqrt(SMD[[i]]$vi)) %>% list()}

# plot(power_SMD[[1]]-power_SMD2[[1]]) - check discrepancy
# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R_SMD)) {
  SMD[[i]]$power.R_SMD <- power.R_SMD[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_SMD <- NA
for (i in 1:12) {
  power.R.S_SMD[i] <- mapply(error_S, mu=effect.R_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R.S_SMD)) {
  SMD[[i]]$power.R.S_SMD <- power.R.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_SMD <- NA
for (i in 1:12) {
  power.R.M_SMD[i] <- mapply(error_M, mu=effect.R_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R.M_SMD)) {
  SMD[[i]]$power.R.M_SMD <- power.R.M_SMD[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_SMD <- NA
for (i in 1:12) {
  power.R.M2_SMD[i] <- mapply(error_M2, mu=effect.R_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R.M2_SMD)) {
  SMD[[i]]$power.R.M2_SMD <- power.R.M2_SMD[[i]]
}





#****************************************************************#
#------------------------------SMDH-----------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# SMDH
power.F_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F_SMDH[i] <- power.individual_Shinichi(mu=rep(model_list_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_SMDH)) {
  SMDH[[i]]$power.F_SMDH <- power.F_SMDH[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.S_SMDH[i] <- mapply(error_S,mu=rep(model_list_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_SMDH)) {
  SMDH[[i]]$power.F.S_SMDH <- power.F.S_SMDH[[i]]
}



#---------------- (3) type M error (relative error) --------------#
power.F.M_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.M_SMDH[i] <-mapply(error_M,mu=rep(model_list_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_SMDH)) {
  SMDH[[i]]$power.F.M_SMDH <- power.F.M_SMDH[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.M2_SMDH[i] <-mapply(error_M2,mu=rep(model_list_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_SMDH)) {
  SMDH[[i]]$power.F.M2_SMDH <- power.F.M2_SMDH[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_SMDH <- NA
for (i in 1:length(model_list_SMDH)) {
  blups.list_SMDH[i] <- ranef(model_list_SMDH[[i]]) %>% list()
}

# get study index - match two components of random effect
index.list_SMDH <- NA # list()
for (i in 1:length(model_list_SMDH)) {
  index.list_SMDH[i] <- match(as.character(SMDH[[i]]$Study),rownames(blups.list_SMDH[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_SMDH <-NA
for (i in 1:length(model_list_SMDH)) {
  effect.R_SMDH[i] <- mapply(sum, model_list_SMDH[[i]]$beta, blups.list_SMDH[[i]]$Study[index.list_SMDH[[i]],1], blups.list_SMDH[[i]]$Unit_ID[,1]) %>% list()
}


#--------------------- (1) two tailed power ---------------------#
power.R_SMDH <- NA
for (i in 1:length(dat_list_SMD)) {
  power.R_SMDH[i] <- power.individual_Shinichi(mu=effect.R_SMDH[[i]], se=sqrt(SMDH[[i]]$vi)) %>% list()}

# plot(power_SMDH[[1]]-power_SMDH2[[1]]) - check discrepancy
# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R_SMD)) {
  SMDH[[i]]$power.R_SMDH <- power.R_SMDH[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_SMDH <- NA
for (i in 1:12) {
  power.R.S_SMDH[i] <- mapply(error_S, mu=effect.R_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.S_SMDH)) {
  SMDH[[i]]$power.R.S_SMDH <- power.R.S_SMDH[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_SMDH <- NA
for (i in 1:12) {
  power.R.M_SMDH[i] <- mapply(error_M, mu=effect.R_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.M_SMDH)) {
  SMDH[[i]]$power.R.M_SMDH <- power.R.M_SMDH[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_SMDH <- NA
for (i in 1:12) {
  power.R.M2_SMDH[i] <- mapply(error_M2, mu=effect.R_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.M2_SMDH)) {
  SMDH[[i]]$power.R.M2_SMDH <- power.R.M2_SMDH[[i]]
}





#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 0.1 Cohen's d **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.1_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.1_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.1, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.1_power_SMD)) {
  SMD[[i]]$d0.1_power_SMD <- d0.1_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.1_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.1_power.S_SMD[i] <- mapply(error_S, mu=rep(0.1, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.1_power.S_SMD)) {
  SMD[[i]]$d0.1_power.S_SMD <- d0.1_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.1_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.1_power.M_SMD[i] <- mapply(error_M, mu=rep(0.1, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.1_power.M_SMD)) {
  SMD[[i]]$d0.1_power.M_SMD <- d0.1_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.1_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.1_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.1, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.1_power.M2_SMD)) {
  SMD[[i]]$d0.1_power.M2_SMD <- d0.1_power.M2_SMD[[i]]
}


#*****************************************************************#
#********************** 0.2 Cohen's d **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.2_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.2_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.2, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.2_power_SMD)) {
  SMD[[i]]$d0.2_power_SMD <- d0.2_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.2_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.2_power.S_SMD[i] <- mapply(error_S, mu=rep(0.2, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.2_power.S_SMD)) {
  SMD[[i]]$d0.2_power.S_SMD <- d0.2_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.2_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.2_power.M_SMD[i] <- mapply(error_M, mu=rep(0.2, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.2_power.M_SMD)) {
  SMD[[i]]$d0.2_power.M_SMD <- d0.2_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.2_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.2_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.2, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.2_power.M2_SMD)) {
  SMD[[i]]$d0.2_power.M2_SMD <- d0.2_power.M2_SMD[[i]]
}


#*****************************************************************#
#********************* 0.3 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.3_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.3_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.3, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.3_power_SMD)) {
  SMD[[i]]$d0.3_power_SMD <- d0.3_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.3_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.3_power.S_SMD[i] <- mapply(error_S, mu=rep(0.3, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.3_power.S_SMD)) {
  SMD[[i]]$d0.3_power.S_SMD <- d0.3_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.3_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.3_power.M_SMD[i] <- mapply(error_M, mu=rep(0.3, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.3_power.M_SMD)) {
  SMD[[i]]$d0.3_power.M_SMD <- d0.3_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.3_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.3_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.3, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.3_power.M2_SMD)) {
  SMD[[i]]$d0.3_power.M2_SMD <- d0.3_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************* 0.4 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.4_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.4_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.4, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.4_power_SMD)) {
  SMD[[i]]$d0.4_power_SMD <- d0.4_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.4_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.4_power.S_SMD[i] <- mapply(error_S, mu=rep(0.4, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.4_power.S_SMD)) {
  SMD[[i]]$d0.4_power.S_SMD <- d0.4_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.4_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.4_power.M_SMD[i] <- mapply(error_M, mu=rep(0.4, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.4_power.M_SMD)) {
  SMD[[i]]$d0.4_power.M_SMD <- d0.4_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.4_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.4_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.4, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.4_power.M2_SMD)) {
  SMD[[i]]$d0.4_power.M2_SMD <- d0.4_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************** 0.5 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.5_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.5_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.5, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.5_power_SMD)) {
  SMD[[i]]$d0.5_power_SMD <- d0.5_power_SMD[[i]]
}


#---------------------- (2) type S error -----------------------#
d0.5_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.5_power.S_SMD[i] <- mapply(error_S, mu=rep(0.5, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.5_power.S_SMD)) {
  SMD[[i]]$d0.5_power.S_SMD <- d0.5_power.S_SMD[[i]]
}



#-------------- (3) type M error (overestimate ratio) -------------#
d0.5_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.5_power.M_SMD[i] <- mapply(error_M, mu=rep(0.5, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.5_power.M_SMD)) {
  SMD[[i]]$d0.5_power.M_SMD <- d0.5_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.5_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.5_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.5, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.5_power.M2_SMD)) {
  SMD[[i]]$d0.5_power.M2_SMD <- d0.5_power.M2_SMD[[i]]
}


#*****************************************************************#
#********************* 0.6 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.6_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.6_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.6, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.6_power_SMD)) {
  SMD[[i]]$d0.6_power_SMD <- d0.6_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.6_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.6_power.S_SMD[i] <- mapply(error_S, mu=rep(0.6, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.6_power.S_SMD)) {
  SMD[[i]]$d0.6_power.S_SMD <- d0.6_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.6_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.6_power.M_SMD[i] <- mapply(error_M, mu=rep(0.6, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.6_power.M_SMD)) {
  SMD[[i]]$d0.6_power.M_SMD <- d0.6_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.6_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.6_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.6, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.6_power.M2_SMD)) {
  SMD[[i]]$d0.6_power.M2_SMD <- d0.6_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************** 0.7 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.7_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.7_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.7, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.7_power_SMD)) {
  SMD[[i]]$d0.7_power_SMD <- d0.7_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.7_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.7_power.S_SMD[i] <- mapply(error_S, mu=rep(0.7, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.7_power.S_SMD)) {
  SMD[[i]]$d0.7_power.S_SMD <- d0.7_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.7_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.7_power.M_SMD[i] <- mapply(error_M, mu=rep(0.7, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.7_power.M_SMD)) {
  SMD[[i]]$d0.7_power.M_SMD <- d0.7_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.7_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.7_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.7, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.7_power.M2_SMD)) {
  SMD[[i]]$d0.7_power.M2_SMD <- d0.7_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************** 0.8 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.8_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.8_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.8, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.8_power_SMD)) {
  SMD[[i]]$d0.8_power_SMD <- d0.8_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.8_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.8_power.S_SMD[i] <- mapply(error_S, mu=rep(0.8, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.8_power.S_SMD)) {
  SMD[[i]]$d0.8_power.S_SMD <- d0.8_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.8_power.M_SMD <- NA
for (i in 1:length(SMD)) {  
  d0.8_power.M_SMD[i] <- mapply(error_M, mu=rep(0.8, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.8_power.M_SMD)) {
  SMD[[i]]$d0.8_power.M_SMD <- d0.8_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.8_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.8_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.8, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.8_power.M2_SMD)) {
  SMD[[i]]$d0.8_power.M2_SMD <- d0.8_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************** 0.9 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d0.9_power_SMD <- NA
for (i in 1:length(SMD)) {
  d0.9_power_SMD[i] <- power.individual_Shinichi(mu=rep(0.9, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.9_power_SMD)) {
  SMD[[i]]$d0.9_power_SMD <- d0.9_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d0.9_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d0.9_power.S_SMD[i] <- mapply(error_S, mu=rep(0.9, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.9_power.S_SMD)) {
  SMD[[i]]$d0.9_power.S_SMD <- d0.9_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d0.9_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d0.9_power.M_SMD[i] <- mapply(error_M, mu=rep(0.9, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.9_power.M_SMD)) {
  SMD[[i]]$d0.9_power.M_SMD <- d0.9_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d0.9_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d0.9_power.M2_SMD[i] <- mapply(error_M2, mu=rep(0.9, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d0.9_power.M2_SMD)) {
  SMD[[i]]$d0.9_power.M2_SMD <- d0.9_power.M2_SMD[[i]]
}



#*****************************************************************#
#********************** 1 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
d1.0_power_SMD <- NA
for (i in 1:length(SMD)) {
  d1.0_power_SMD[i] <- power.individual_Shinichi(mu=rep(1.0, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1.0_power_SMD)) {
  SMD[[i]]$d1.0_power_SMD <- d1.0_power_SMD[[i]]
}

#---------------------- (2) type S error -----------------------#
d1.0_power.S_SMD <- NA
for (i in 1:length(SMD)) {
  d1.0_power.S_SMD[i] <- mapply(error_S, mu=rep(1.0, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1.0_power.S_SMD)) {
  SMD[[i]]$d1.0_power.S_SMD <- d1.0_power.S_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
d1.0_power.M_SMD <- NA
for (i in 1:length(SMD)) {
  d1.0_power.M_SMD[i] <- mapply(error_M, mu=rep(1.0, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1.0_power.M_SMD)) {
  SMD[[i]]$d1.0_power.M_SMD <- d1.0_power.M_SMD[[i]]
}

#---------------- (4) type M error (relative error) --------------#
d1.0_power.M2_SMD <- NA
for (i in 1:length(SMD)) {
  d1.0_power.M2_SMD[i] <- mapply(error_M2, mu=rep(1.0, length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(d1.0_power.M2_SMD)) {
  SMD[[i]]$d1.0_power.M2_SMD <- d1.0_power.M2_SMD[[i]]
}






#*********************************************************************#
#----------- summary of empirical power for each approach ------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.F_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.F.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.F.M_SMD))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.F.M2_SMD))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.R_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.R.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.R.M_SMD))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$power.R.M2_SMD))[6,]) 





#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F_SMDH))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.S_SMDH))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.M_SMDH))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_SMDH))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R_SMDH))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.S_SMDH))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.M_SMDH))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_SMDH <- data.frame(MA_case=model_est_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_SMDH))[6,]) 




#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 0.1 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.1_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.1_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.1_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.1_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.1_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.1_power.M2_SMD))[6,]) 


#*****************************************************************#
#********************** 0.2 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.2_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.2_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.2_power.M2_SMD))[6,]) 


#*****************************************************************#
#********************** 0.3 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.3_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.3_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.3_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.3_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.3_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.3_power.M2_SMD))[6,]) 



#*****************************************************************#
#********************** 0.4 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.4_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.4_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.4_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.4_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.4_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.4_power.M2_SMD))[6,]) 




#*****************************************************************#
#********************** 0.5 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.5_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.5_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.5_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.5_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.5_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.5_power.M2_SMD))[6,]) 



#*****************************************************************#
#********************** 0.6 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.6_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.6_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.6_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.6_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.6_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.6_power.M2_SMD))[6,]) 




#*****************************************************************#
#********************** 0.7 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.7_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.7_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.7_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.7_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.7_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.7_power.M2_SMD))[6,]) 




#*****************************************************************#
#********************** 0.8 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.8_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.8_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.8_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.8_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.8_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.8_power.M2_SMD))[6,]) 



#*****************************************************************#
#********************** 0.9 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d0.9_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.9_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d0.9_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d0.9_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d0.9_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d0.9_power.M2_SMD))[6,]) 



#*****************************************************************#
#********************** 1.0 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
power_summary_d1.0_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d1.0_power_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.S_summary_d1.0_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.S_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.M_summary_d1.0_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M_SMD))[6,]) 


#---------------- (4) type M error (relative error) --------------#
power.M2_summary_d1.0_SMD <- data.frame(MA_case=model_est_SMD$MA_case,
                   Minimum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[2,],
                   Median=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[3,],
                   Mean=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[5,], 
                   Maximum=mapply(summary, sapply(SMD, function(x) x$d1.0_power.M2_SMD))[6,]) 




# clean NA - ma11 has NA
#for (i in 1:12) { SMDH[[i]] <- SMDH[[i]][!is.na(SMDH[[i]]$power.R_SMDH),]}





#*********************************************************************#
#--------- calculate standard error for each type of power -----------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_SMD
se.F_mean <- NA
for (i in 1:length(SMD)) {
  se.F_mean[i] <- sd(SMD[[i]]$power.F_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.F_SMD[!is.na(SMD[[i]]$power.F_SMD)]))
}

power.F_summary_SMD$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_SMD
se.F.S_mean <- NA
for (i in 1:length(SMD)) {
  se.F.S_mean[i] <- sd(SMD[[i]]$power.F.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.F.S_SMD[!is.na(SMD[[i]]$power.F.S_SMD)]))
}

power.F.S_summary_SMD$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_SMD
se.F.M_mean <- NA
for (i in 1:length(SMD)) {
  se.F.M_mean[i] <- sd(SMD[[i]]$power.F.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.F.M_SMD[!is.na(SMD[[i]]$power.F.M_SMD)]))
}

power.F.M_summary_SMD$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(SMD)) {
  se.F.M2_mean[i] <- sd(SMD[[i]]$power.F.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.F.M2_SMD[!is.na(SMD[[i]]$power.F.M2_SMD)]))
}

power.F.M2_summary_SMD$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_SMD
se.R_mean <- NA
for (i in 1:length(SMD)) {
  se.R_mean[i] <- sd(SMD[[i]]$power.R_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.R_SMD[!is.na(SMD[[i]]$power.R_SMD)]))
}

power.R_summary_SMD$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_SMD
se.R.S_mean <- NA
for (i in 1:length(SMD)) {
  se.R.S_mean[i] <- sd(SMD[[i]]$power.R.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.R.S_SMD[!is.na(SMD[[i]]$power.R.S_SMD)]))
}

power.R.S_summary_SMD$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_SMD
se.R.M_mean <- NA
for (i in 1:length(SMD)) {
  se.R.M_mean[i] <- sd(SMD[[i]]$power.R.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.R.M_SMD[!is.na(SMD[[i]]$power.R.M_SMD)]))
}

power.R.M_summary_SMD$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(SMD)) {
  se.R.M2_mean[i] <- sd(SMD[[i]]$power.R.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$power.R.M2_SMD[!is.na(SMD[[i]]$power.R.M2_SMD)]))
}

power.R.M2_summary_SMD$se.R.M2_mean <- se.R.M2_mean







#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_SMDH
se.F_mean <- NA
for (i in 1:length(SMDH)) {
  se.F_mean[i] <- sd(SMDH[[i]]$power.F_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F_SMDH[!is.na(SMDH[[i]]$power.F_SMDH)]))
}

power.F_summary_SMDH$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_SMDH
se.F.S_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.S_mean[i] <- sd(SMDH[[i]]$power.F.S_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.S_SMDH[!is.na(SMDH[[i]]$power.F.S_SMDH)]))
}

power.F.S_summary_SMDH$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_SMDH
se.F.M_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.M_mean[i] <- sd(SMDH[[i]]$power.F.M_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.M_SMDH[!is.na(SMDH[[i]]$power.F.M_SMDH)]))
}

power.F.M_summary_SMDH$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.M2_mean[i] <- sd(SMDH[[i]]$power.F.M2_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.M2_SMDH[!is.na(SMDH[[i]]$power.F.M2_SMDH)]))
}

power.F.M2_summary_SMDH$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_SMDH
se.R_mean <- NA
for (i in 1:length(SMDH)) {
  se.R_mean[i] <- sd(SMDH[[i]]$power.R_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R_SMDH[!is.na(SMDH[[i]]$power.R_SMDH)]))
}

power.R_summary_SMDH$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_SMDH
se.R.S_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.S_mean[i] <- sd(SMDH[[i]]$power.R.S_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.S_SMDH[!is.na(SMDH[[i]]$power.R.S_SMDH)]))
}

power.R.S_summary_SMDH$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_SMDH
se.R.M_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.M_mean[i] <- sd(SMDH[[i]]$power.R.M_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.M_SMDH[!is.na(SMDH[[i]]$power.R.M_SMDH)]))
}

power.R.M_summary_SMDH$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.M2_mean[i] <- sd(SMDH[[i]]$power.R.M2_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.M2_SMDH[!is.na(SMDH[[i]]$power.R.M2_SMDH)]))
}

power.R.M2_summary_SMDH$se.R.M2_mean <- se.R.M2_mean




#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 0.1 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.1_power_SMD
se.d0.1_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.1_mean[i] <- sd(SMD[[i]]$d0.1_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.1_power_SMD[!is.na(SMD[[i]]$d0.1_power_SMD)]))
}

power_summary_d0.1_SMD$se.d0.1_mean <- se.d0.1_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.1_power.S_SMD
se.d0.1_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.1_mean[i] <- sd(SMD[[i]]$d0.1_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.1_power.S_SMD[!is.na(SMD[[i]]$d0.1_power.S_SMD)]))
}

power.S_summary_d0.1_SMD$se.d0.1_mean <- se.d0.1_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.1_power.M_SMD
se.d0.1_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.1_mean[i] <- sd(SMD[[i]]$d0.1_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.1_power.M_SMD[!is.na(SMD[[i]]$d0.1_power.M_SMD)]))
}

power.M_summary_d0.1_SMD$se.d0.1_mean <- se.d0.1_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.1_power.M2_SMD
se.d0.1_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.1_mean[i] <- sd(SMD[[i]]$d0.1_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.1_power.M2_SMD[!is.na(SMD[[i]]$d0.1_power.M2_SMD)]))
}

power.M2_summary_d0.1_SMD$se.d0.1_mean <- se.d0.1_mean




#*****************************************************************#
#********************** 0.2 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.2_power_SMD
se.d0.2_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.2_mean[i] <- sd(SMD[[i]]$d0.2_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.2_power_SMD[!is.na(SMD[[i]]$d0.2_power_SMD)]))
}

power_summary_d0.2_SMD$se.d0.2_mean <- se.d0.2_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.2_power.S_SMD
se.d0.2_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.2_mean[i] <- sd(SMD[[i]]$d0.2_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.2_power.S_SMD[!is.na(SMD[[i]]$d0.2_power.S_SMD)]))
}

power.S_summary_d0.2_SMD$se.d0.2_mean <- se.d0.2_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.2_power.M_SMD
se.d0.2_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.2_mean[i] <- sd(SMD[[i]]$d0.2_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.2_power.M_SMD[!is.na(SMD[[i]]$d0.2_power.M_SMD)]))
}

power.M_summary_d0.2_SMD$se.d0.2_mean <- se.d0.2_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.2_power.M2_SMD
se.d0.2_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.2_mean[i] <- sd(SMD[[i]]$d0.2_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.2_power.M2_SMD[!is.na(SMD[[i]]$d0.2_power.M2_SMD)]))
}

power.M2_summary_d0.2_SMD$se.d0.2_mean <- se.d0.2_mean



#*****************************************************************#
#********************** 0.3 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.3_power_SMD
se.d0.3_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.3_mean[i] <- sd(SMD[[i]]$d0.3_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.3_power_SMD[!is.na(SMD[[i]]$d0.3_power_SMD)]))
}

power_summary_d0.3_SMD$se.d0.3_mean <- se.d0.3_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.3_power.S_SMD
se.d0.3_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.3_mean[i] <- sd(SMD[[i]]$d0.3_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.3_power.S_SMD[!is.na(SMD[[i]]$d0.3_power.S_SMD)]))
}

power.S_summary_d0.3_SMD$se.d0.3_mean <- se.d0.3_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.3_power.M_SMD
se.d0.3_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.3_mean[i] <- sd(SMD[[i]]$d0.3_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.3_power.M_SMD[!is.na(SMD[[i]]$d0.3_power.M_SMD)]))
}

power.M_summary_d0.3_SMD$se.d0.3_mean <- se.d0.3_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.3_power.M2_SMD
se.d0.3_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.3_mean[i] <- sd(SMD[[i]]$d0.3_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.3_power.M2_SMD[!is.na(SMD[[i]]$d0.3_power.M2_SMD)]))
}

power.M2_summary_d0.3_SMD$se.d0.3_mean <- se.d0.3_mean



#**************************0.4% mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.4_power_SMD
se.d0.4_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.4_mean[i] <- sd(SMD[[i]]$d0.4_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.4_power_SMD[!is.na(SMD[[i]]$d0.4_power_SMD)]))
}

power_summary_d0.4_SMD$se.d0.4_mean <- se.d0.4_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.4_power.S_SMD
se.d0.4_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.4_mean[i] <- sd(SMD[[i]]$d0.4_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.4_power.S_SMD[!is.na(SMD[[i]]$d0.4_power.S_SMD)]))
}

power.S_summary_d0.4_SMD$se.d0.4_mean <- se.d0.4_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.4_power.M_SMD
se.d0.4_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.4_mean[i] <- sd(SMD[[i]]$d0.4_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.4_power.M_SMD[!is.na(SMD[[i]]$d0.4_power.M_SMD)]))
}

power.M_summary_d0.4_SMD$se.d0.4_mean <- se.d0.4_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.4_power.M2_SMD
se.d0.4_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.4_mean[i] <- sd(SMD[[i]]$d0.4_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.4_power.M2_SMD[!is.na(SMD[[i]]$d0.4_power.M2_SMD)]))
}

power.M2_summary_d0.4_SMD$se.d0.4_mean <- se.d0.4_mean



#*****************************************************************#
#********************** 0.5 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.5_power_SMD
se.d0.5_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.5_mean[i] <- sd(SMD[[i]]$d0.5_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.5_power_SMD[!is.na(SMD[[i]]$d0.5_power_SMD)]))
}

power_summary_d0.5_SMD$se.d0.5_mean <- se.d0.5_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.5_power.S_SMD
se.d0.5_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.5_mean[i] <- sd(SMD[[i]]$d0.5_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.5_power.S_SMD[!is.na(SMD[[i]]$d0.5_power.S_SMD)]))
}

power.S_summary_d0.5_SMD$se.d0.5_mean <- se.d0.5_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.5_power.M_SMD
se.d0.5_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.5_mean[i] <- sd(SMD[[i]]$d0.5_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.5_power.M_SMD[!is.na(SMD[[i]]$d0.5_power.M_SMD)]))
}

power.M_summary_d0.5_SMD$se.d0.5_mean <- se.d0.5_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.5_power.M2_SMD
se.d0.5_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.5_mean[i] <- sd(SMD[[i]]$d0.5_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.5_power.M2_SMD[!is.na(SMD[[i]]$d0.5_power.M2_SMD)]))
}

power.M2_summary_d0.5_SMD$se.d0.5_mean <- se.d0.5_mean




#*****************************************************************#
#********************** 0.6 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.6_power_SMD
se.d0.6_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.6_mean[i] <- sd(SMD[[i]]$d0.6_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.6_power_SMD[!is.na(SMD[[i]]$d0.6_power_SMD)]))
}

power_summary_d0.6_SMD$se.d0.6_mean <- se.d0.6_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.6_power.S_SMD
se.d0.6_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.6_mean[i] <- sd(SMD[[i]]$d0.6_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.6_power.S_SMD[!is.na(SMD[[i]]$d0.6_power.S_SMD)]))
}

power.S_summary_d0.6_SMD$se.d0.6_mean <- se.d0.6_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.6_power.M_SMD
se.d0.6_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.6_mean[i] <- sd(SMD[[i]]$d0.6_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.6_power.M_SMD[!is.na(SMD[[i]]$d0.6_power.M_SMD)]))
}

power.M_summary_d0.6_SMD$se.d0.6_mean <- se.d0.6_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.6_power.M2_SMD
se.d0.6_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.6_mean[i] <- sd(SMD[[i]]$d0.6_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.6_power.M2_SMD[!is.na(SMD[[i]]$d0.6_power.M2_SMD)]))
}

power.M2_summary_d0.6_SMD$se.d0.6_mean <- se.d0.6_mean




#*****************************************************************#
#********************** 0.7 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.7_power_SMD
se.d0.7_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.7_mean[i] <- sd(SMD[[i]]$d0.7_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.7_power_SMD[!is.na(SMD[[i]]$d0.7_power_SMD)]))
}

power_summary_d0.7_SMD$se.d0.7_mean <- se.d0.7_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.7_power.S_SMD
se.d0.7_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.7_mean[i] <- sd(SMD[[i]]$d0.7_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.7_power.S_SMD[!is.na(SMD[[i]]$d0.7_power.S_SMD)]))
}

power.S_summary_d0.7_SMD$se.d0.7_mean <- se.d0.7_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.7_power.M_SMD
se.d0.7_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.7_mean[i] <- sd(SMD[[i]]$d0.7_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.7_power.M_SMD[!is.na(SMD[[i]]$d0.7_power.M_SMD)]))
}

power.M_summary_d0.7_SMD$se.d0.7_mean <- se.d0.7_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.7_power.M2_SMD
se.d0.7_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.7_mean[i] <- sd(SMD[[i]]$d0.7_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.7_power.M2_SMD[!is.na(SMD[[i]]$d0.7_power.M2_SMD)]))
}

power.M2_summary_d0.7_SMD$se.d0.7_mean <- se.d0.7_mean




#*****************************************************************#
#********************** 0.8 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.8_power_SMD
se.d0.8_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.8_mean[i] <- sd(SMD[[i]]$d0.8_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.8_power_SMD[!is.na(SMD[[i]]$d0.8_power_SMD)]))
}

power_summary_d0.8_SMD$se.d0.8_mean <- se.d0.8_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.8_power.S_SMD
se.d0.8_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.8_mean[i] <- sd(SMD[[i]]$d0.8_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.8_power.S_SMD[!is.na(SMD[[i]]$d0.8_power.S_SMD)]))
}

power.S_summary_d0.8_SMD$se.d0.8_mean <- se.d0.8_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.8_power.M_SMD
se.d0.8_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.8_mean[i] <- sd(SMD[[i]]$d0.8_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.8_power.M_SMD[!is.na(SMD[[i]]$d0.8_power.M_SMD)]))
}

power.M_summary_d0.8_SMD$se.d0.8_mean <- se.d0.8_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.8_power.M2_SMD
se.d0.8_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.8_mean[i] <- sd(SMD[[i]]$d0.8_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.8_power.M2_SMD[!is.na(SMD[[i]]$d0.8_power.M2_SMD)]))
}

power.M2_summary_d0.8_SMD$se.d0.8_mean <- se.d0.8_mean




#*****************************************************************#
#********************** 0.9 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d0.9_power_SMD
se.d0.9_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.9_mean[i] <- sd(SMD[[i]]$d0.9_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.9_power_SMD[!is.na(SMD[[i]]$d0.9_power_SMD)]))
}

power_summary_d0.9_SMD$se.d0.9_mean <- se.d0.9_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d0.9_power.S_SMD
se.d0.9_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.9_mean[i] <- sd(SMD[[i]]$d0.9_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.9_power.S_SMD[!is.na(SMD[[i]]$d0.9_power.S_SMD)]))
}

power.S_summary_d0.9_SMD$se.d0.9_mean <- se.d0.9_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d0.9_power.M_SMD
se.d0.9_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.9_mean[i] <- sd(SMD[[i]]$d0.9_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.9_power.M_SMD[!is.na(SMD[[i]]$d0.9_power.M_SMD)]))
}

power.M_summary_d0.9_SMD$se.d0.9_mean <- se.d0.9_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d0.9_power.M2_SMD
se.d0.9_mean <- NA
for (i in 1:length(SMD)) {
  se.d0.9_mean[i] <- sd(SMD[[i]]$d0.9_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d0.9_power.M2_SMD[!is.na(SMD[[i]]$d0.9_power.M2_SMD)]))
}

power.M2_summary_d0.9_SMD$se.d0.9_mean <- se.d0.9_mean



#*****************************************************************#
#********************** 1.0 mean differences **********************#
#*****************************************************************#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable d1.0_power_SMD
se.d1.0_mean <- NA
for (i in 1:length(SMD)) {
  se.d1.0_mean[i] <- sd(SMD[[i]]$d1.0_power_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d1.0_power_SMD[!is.na(SMD[[i]]$d1.0_power_SMD)]))
}

power_summary_d1.0_SMD$se.d1.0_mean <- se.d1.0_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable d1.0_power.S_SMD
se.d1.0_mean <- NA
for (i in 1:length(SMD)) {
  se.d1.0_mean[i] <- sd(SMD[[i]]$d1.0_power.S_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d1.0_power.S_SMD[!is.na(SMD[[i]]$d1.0_power.S_SMD)]))
}

power.S_summary_d1.0_SMD$se.d1.0_mean <- se.d1.0_mean


#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable d1.0_power.M_SMD
se.d1.0_mean <- NA
for (i in 1:length(SMD)) {
  se.d1.0_mean[i] <- sd(SMD[[i]]$d1.0_power.M_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d1.0_power.M_SMD[!is.na(SMD[[i]]$d1.0_power.M_SMD)]))
}

power.M_summary_d1.0_SMD$se.d1.0_mean <- se.d1.0_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable d1.0_power.M2_SMD
se.d1.0_mean <- NA
for (i in 1:length(SMD)) {
  se.d1.0_mean[i] <- sd(SMD[[i]]$d1.0_power.M2_SMD, na.rm=TRUE) / sqrt(length(SMD[[i]]$d1.0_power.M2_SMD[!is.na(SMD[[i]]$d1.0_power.M2_SMD)]))
}

power.M2_summary_d1.0_SMD$se.d1.0_mean <- se.d1.0_mean




#*********************************************************************#
#-------------------- meta-meta-analysis on power --------------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

# add study ID

# add N and k
N_SMD <- NA
for (i in 1:length(SMD)) {
  N_SMD[i] <- SMD[[i]]$Unit_ID %>% length()
}

k_SMD <- NA
for (i in 1:length(SMD)) {
  k_SMD[i] <- SMD[[i]]$Study %>% length()
}

power.F_summary_SMD$N <- N_SMD
power.F_summary_SMD$k <- k_SMD



approach_SMD <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_SMD <- c("Pr","Pr", "Pr","Pr", "Pr", "Pr","Pr","Pr","Pr","Pr", "Pr", "Pr")

stressor_SMD <- c("BD_loss","BD_loss", "Fert", "Fert", "Fert", "LUC","LUC","LUC","LUC","LUC", "LUC", "Inv")

stressor_SMD %>% as.data.frame() # check the correctness


moderator_SMD <- cbind(approach_SMD,treatment_SMD,stressor_SMD)

power.F_summary_SMD <- cbind(power.F_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.F_summary_SMD$approach_SMD <- factor(power.F_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.F_SMD.approach <- with(power.F_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_SMD.stressor <- with(power.F_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t")) 

MMA_power.F_SMD <- with(power.F_summary_SMD, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_SMD <- cbind(power.F.S_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_SMD$approach_SMD <- factor(power.F.S_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.F.S_SMD.approach <- with(power.F.S_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_SMD.stressor <- with(power.F.S_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t"))

MMA_power.F.S_SMD <- with(power.F.S_summary_SMD, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_SMD <- cbind(power.F.M_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_SMD$approach_SMD <- factor(power.F.M_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.F.M_SMD.approach <- with(power.F.M_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_SMD.stressor <- with(power.F.M_summary_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t"))

MMA_power.F.M_SMD <- with(power.F.M_summary_SMD, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_SMD <- with(power.F.M2_summary_SMD, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

power.R_summary_SMD <- cbind(power.R_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.R_summary_SMD$approach_SMD <- factor(power.R_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.R_SMD.approach <- with(power.R_summary_SMD, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R_SMD.stressor <- with(power.R_summary_SMD, rma(yi = Mean, sei = se.R_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t")) 

MMA_power.R_SMD <- with(power.R_summary_SMD, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))



power.R.S_summary_SMD <- cbind(power.R.S_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.R.S_summary_SMD$approach_SMD <- factor(power.R.S_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.R.S_SMD.approach <- with(power.R.S_summary_SMD, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.S_SMD.stressor <- with(power.R.S_summary_SMD, rma(yi = Mean, sei = se.R.S_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t"))

MMA_power.R.S_SMD <- with(power.R.S_summary_SMD, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))




power.R.M_summary_SMD <- cbind(power.R.M_summary_SMD, moderator_SMD)

# convert moderator to factor with desired ordering of levels
power.R.M_summary_SMD$approach_SMD <- factor(power.R.M_summary_SMD$approach_SMD, levels=c("O", "E"))

MMA_power.R.M_SMD.approach <- with(power.R.M_summary_SMD, rma(yi = Mean, sei = se.R.M_mean,  mods = ~ I(approach_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.R.M_SMD.stressor <- with(power.R.M_summary_SMD, rma(yi = Mean, sei = se.R.M_mean,  mods = ~ I(stressor_SMD) -1, method = "REML", test = "t"))

MMA_power.R.M_SMD <- with(power.R.M_summary_SMD, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t"))

MMA_power.R.M2_SMD <- with(power.R.M2_summary_SMD, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))



#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#
# add study ID

# add N and k
N_SMDH <- NA
for (i in 1:length(SMDH)) {
  N_SMDH[i] <- SMDH[[i]]$Unit_ID %>% length()
}

k_SMDH <- NA
for (i in 1:length(SMDH)) {
  k_SMDH[i] <- SMDH[[i]]$Study %>% length()
}

power.F_summary_SMDH$N <- N_SMDH
power.F_summary_SMDH$k <- k_SMDH



approach_SMDH <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_SMDH <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

moderator_SMDH <- cbind(approach_SMDH,treatment_SMDH)

power.F_summary_SMDH <- cbind(power.F_summary_SMDH, moderator_SMDH)

# convert moderator to factor with desired ordering of levels
power.F_summary_SMDH$approach_SMDH <- factor(power.F_summary_SMDH$approach_SMDH, levels=c("O", "E"))

MMA_power.F_SMDH.approach <- with(power.F_summary_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_SMDH <- with(power.F_summary_SMDH, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_SMDH <- cbind(power.F.S_summary_SMDH, moderator_SMDH)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_SMDH$approach_SMDH <- factor(power.F.S_summary_SMDH$approach_SMDH, levels=c("O", "E"))

MMA_power.F.S_SMDH.approach <- with(power.F.S_summary_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_SMDH <- with(power.F.S_summary_SMDH, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_SMDH <- cbind(power.F.M_summary_SMDH, moderator_SMDH)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_SMDH$approach_SMDH <- factor(power.F.M_summary_SMDH$approach_SMDH, levels=c("O", "E"))

MMA_power.F.M_SMDH.approach <- with(power.F.M_summary_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_SMDH <- with(power.F.M_summary_SMDH, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_SMDH <- with(power.F.M2_summary_SMDH, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#






MMA_power.R_SMDH <- with(power.R_summary_SMDH, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))

MMA_power.R.S_SMDH <- with(power.R.S_summary_SMDH, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))

MMA_power.R.M_SMDH <- with(power.R.M_summary_SMDH, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t"))

MMA_power.R.M2_SMDH <- with(power.R.M2_summary_SMDH, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))






#----------------------------------------------------------------#
#               (iii) hypothetical effect as true effect
#----------------------------------------------------------------#


#*****************************************************************#
#********************** 0.1 mean differences **********************#
#*****************************************************************#
MMA_power_SMD_d0.1 <- with(power_summary_d0.1_SMD, rma(yi = Mean, sei = se.d0.1_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.1 <- with(power.S_summary_d0.1_SMD, rma(yi = Mean, sei = se.d0.1_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.1 <- with(power.M_summary_d0.1_SMD, rma(yi = Mean, sei = se.d0.1_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.1 <- with(power.M2_summary_d0.1_SMD, rma(yi = Mean, sei = se.d0.1_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 0.2 mean differences **********************#
#*****************************************************************#
MMA_power_SMD_d0.2 <- with(power_summary_d0.2_SMD, rma(yi = Mean, sei = se.d0.2_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.2 <- with(power.S_summary_d0.2_SMD, rma(yi = Mean, sei = se.d0.2_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.2 <- with(power.M_summary_d0.2_SMD, rma(yi = Mean, sei = se.d0.2_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.2 <- with(power.M2_summary_d0.2_SMD, rma(yi = Mean, sei = se.d0.2_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 0.3 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.3 <- with(power_summary_d0.3_SMD, rma(yi = Mean, sei = se.d0.3_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.3 <- with(power.S_summary_d0.3_SMD, rma(yi = Mean, sei = se.d0.3_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.3 <- with(power.M_summary_d0.3_SMD, rma(yi = Mean, sei = se.d0.3_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.3 <- with(power.M2_summary_d0.3_SMD, rma(yi = Mean, sei = se.d0.3_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 0.4 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.4 <- with(power_summary_d0.4_SMD, rma(yi = Mean, sei = se.d0.4_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.4 <- with(power.S_summary_d0.4_SMD, rma(yi = Mean, sei = se.d0.4_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.4 <- with(power.M_summary_d0.4_SMD, rma(yi = Mean, sei = se.d0.4_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.4 <- with(power.M2_summary_d0.4_SMD, rma(yi = Mean, sei = se.d0.4_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 0.5 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.5 <- with(power_summary_d0.5_SMD, rma(yi = Mean, sei = se.d0.5_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.5 <- with(power.S_summary_d0.5_SMD, rma(yi = Mean, sei = se.d0.5_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.5 <- with(power.M_summary_d0.5_SMD, rma(yi = Mean, sei = se.d0.5_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.5 <- with(power.M2_summary_d0.5_SMD, rma(yi = Mean, sei = se.d0.5_mean,   method = "REML", test = "t"))

#*****************************************************************#
#********************** 0.6 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.6 <- with(power_summary_d0.6_SMD, rma(yi = Mean, sei = se.d0.6_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.6 <- with(power.S_summary_d0.6_SMD, rma(yi = Mean, sei = se.d0.6_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.6 <- with(power.M_summary_d0.6_SMD, rma(yi = Mean, sei = se.d0.6_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.6 <- with(power.M2_summary_d0.6_SMD, rma(yi = Mean, sei = se.d0.6_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 0.7 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.7 <- with(power_summary_d0.7_SMD, rma(yi = Mean, sei = se.d0.7_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.7 <- with(power.S_summary_d0.7_SMD, rma(yi = Mean, sei = se.d0.7_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.7 <- with(power.M_summary_d0.7_SMD, rma(yi = Mean, sei = se.d0.7_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.7 <- with(power.M2_summary_d0.7_SMD, rma(yi = Mean, sei = se.d0.7_mean,   method = "REML", test = "t"))


#*****************************************************************#
#********************** 0.8 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.8 <- with(power_summary_d0.8_SMD, rma(yi = Mean, sei = se.d0.8_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.8 <- with(power.S_summary_d0.8_SMD, rma(yi = Mean, sei = se.d0.8_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.8 <- with(power.M_summary_d0.8_SMD, rma(yi = Mean, sei = se.d0.8_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.8 <- with(power.M2_summary_d0.8_SMD, rma(yi = Mean, sei = se.d0.8_mean,   method = "REML", test = "t"))




#*****************************************************************#
#********************** 0.9 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d0.9 <- with(power_summary_d0.9_SMD, rma(yi = Mean, sei = se.d0.9_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d0.9 <- with(power.S_summary_d0.9_SMD, rma(yi = Mean, sei = se.d0.9_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d0.9 <- with(power.M_summary_d0.9_SMD, rma(yi = Mean, sei = se.d0.9_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d0.9 <- with(power.M2_summary_d0.9_SMD, rma(yi = Mean, sei = se.d0.9_mean,   method = "REML", test = "t"))



#*****************************************************************#
#********************** 1.0 mean differences *********************#
#*****************************************************************#
MMA_power_SMD_d1.0 <- with(power_summary_d1.0_SMD, rma(yi = Mean, sei = se.d1.0_mean,   method = "REML", test = "t"))

MMA_power.S_SMD_d1.0 <- with(power.S_summary_d1.0_SMD, rma(yi = Mean, sei = se.d1.0_mean,   method = "REML", test = "t"))

MMA_power.M_SMD_d1.0 <- with(power.M_summary_d1.0_SMD, rma(yi = Mean, sei = se.d1.0_mean,   method = "REML", test = "t"))

MMA_power.M2_SMD_d1.0 <- with(power.M2_summary_d1.0_SMD, rma(yi = Mean, sei = se.d1.0_mean,   method = "REML", test = "t"))


```




### Adjusted power to detect SMD (i.e. SMD PET-PEESE)

```{r}
#***************************************************************#
#             power for 12 meta-analytic cases                  #
#***************************************************************#


# make a list of data
dat_list_adjusted_SMD <- SMD


# prepare "ture" effect of variation (i.e. SMD and SMDH) for power analysis - fit multi-level meta-analytic models


#****************************************************************#
#------------------------------SMD-----------------------------#
#****************************************************************#


#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_adjusted_SMD$MA.power <- power.ma_Shinichi(mu=model_est_adjusted_SMD$mu,SE=model_est_adjusted_SMD$SE)


#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_adjusted_SMD$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_adjusted_SMD$mu[i],se=model_est_adjusted_SMD$SE[i],alpha=0.05) %>% unlist()
}

model_est_adjusted_SMD$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_adjusted_SMD$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_adjusted_SMD$mu[i],se=model_est_adjusted_SMD$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_adjusted_SMD$MA.power.M <- MA.power.M


#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#
MA.power.M2 <- NA
for (i in 1:length(model_est_adjusted_SMD$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_adjusted_SMD$mu[i],se=model_est_adjusted_SMD$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_adjusted_SMD$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_adjusted_SMD, file = "./meta-analysis power_adjusted_SMD.csv", row.names = FALSE)


#****************************************************************#
#-------------------------------SMDH-----------------------------#
#****************************************************************#

#-----------------------------------------------------------#
#          (1) two-tailed power for meta-analyses
#-----------------------------------------------------------#
model_est_adjusted_SMDH$MA.power <- power.ma_Shinichi(mu=model_est_adjusted_SMDH$mu,SE=model_est_adjusted_SMDH$SE)

#-----------------------------------------------------------#
#            (2) type S error for meta-analyses
#-----------------------------------------------------------#
MA.power.S <- NA
for (i in 1:length(model_est_adjusted_SMDH$MA_case)) {
  MA.power.S[i] <- error_S(mu=model_est_adjusted_SMDH$mu[i],se=model_est_adjusted_SMDH$SE[i],alpha=0.05) %>% unlist()
}

model_est_adjusted_SMDH$MA.power.S <- MA.power.S


#-----------------------------------------------------------#
#   (3) type M error (overestimate ratio) for meta-analyses
#-----------------------------------------------------------#
MA.power.M <- NA
for (i in 1:length(model_est_adjusted_SMDH$MA_case)) {
  MA.power.M[i] <- error_M(mu=model_est_adjusted_SMDH$mu[i],se=model_est_adjusted_SMDH$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_adjusted_SMDH$MA.power.M <- MA.power.M

#-----------------------------------------------------------#
#   (4) type M error (relative error) for meta-analyses
#-----------------------------------------------------------#  
MA.power.M2 <- NA
for (i in 1:length(model_est_adjusted_SMDH$MA_case)) {
  MA.power.M2[i] <- error_M2(mu=model_est_adjusted_SMDH$mu[i],se=model_est_adjusted_SMDH$SE[i],alpha=0.05,N=10000) %>% unlist()
}

model_est_adjusted_SMDH$MA.power.M2 <- MA.power.M2


# Save
write.csv(model_est_adjusted_SMDH, file = "./meta-analysis power_adjusted_SMDH.csv", row.names = FALSE)


#***************************************************************#
#        power for empirical studies within meta-analysis       #
#***************************************************************#

# We have three approaches for calculating empirical studies within meta-analysis: (i) using meta-analytic estimate (i.e. intercept or fixed effect) as true effect; (ii) using effect size specific effect as true effect (i.e. fixed plus random effect), which accomodate between-study heterogeneity; (iii) postulated (i.e. hypothetical) effect as true effect - 5%, 10%, 20%, 40% difference)


#****************************************************************#
#------------------------------SMD-----------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# SMD
power.F_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  power.F_adjusted_SMD[i] <- power.individual_Shinichi(mu=rep(model_est_adjusted_SMD$mu_SMD[i], length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.F_adjusted_SMD <- power.F_adjusted_SMD[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.S_adjusted_SMD[i] <- mapply(error_S,mu=rep(model_est_adjusted_SMD$mu_SMD[i], length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.F.S_adjusted_SMD <- power.F.S_adjusted_SMD[[i]]
}



#---------------- (3) type M error (relative error) --------------#
power.F.M_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.M_adjusted_SMD[i] <-mapply(error_M,mu=rep(model_est_adjusted_SMD$mu_SMD[i], length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.F.M_adjusted_SMD <- power.F.M_adjusted_SMD[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  power.F.M2_adjusted_SMD[i] <-mapply(error_M2,mu=rep(model_est_adjusted_SMD$mu_SMD[i], length(SMD[[i]]$vi)), se=sqrt(SMD[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.F.M2_adjusted_SMD <- power.F.M2_adjusted_SMD[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_adjusted_SMD <- NA
for (i in 1:length(model_list_adjusted_SMD)) {
  blups.list_adjusted_SMD[i] <- ranef(model_list_adjusted_SMD[[i]]) %>% list()
}

# get study index - match two components of random effect
index.list_adjusted_SMD <- NA # list()
for (i in 1:length(model_list_adjusted_SMD)) {
  index.list_adjusted_SMD[i] <- match(as.character(SMD[[i]]$Study),rownames(blups.list_adjusted_SMD[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_adjusted_SMD <-NA
for (i in 1:length(model_list_adjusted_SMD)) {
  effect.R_adjusted_SMD[i] <- mapply(sum, model_est_adjusted_SMD$mu_SMD[i], blups.list_adjusted_SMD[[i]]$Study[index.list_adjusted_SMD[[i]],1], blups.list_adjusted_SMD[[i]]$Unit_ID[,1]) %>% list()
}


#--------------------- (1) two tailed power ---------------------#
power.R_adjusted_SMD <- NA
for (i in 1:12) {
  power.R_adjusted_SMD[i] <- power.individual_Shinichi(mu=effect.R_adjusted_SMD[[i]], se=sqrt(SMD[[i]]$vi)) %>% list()}

# plot(power_adjusted_SMD[[1]]-power_adjusted_SMD2[[1]]) - check discrepancy
# allocate each set of power into coSMDesponding dataset
for (i in 1:12) {
  dat_list_adjusted_SMD[[i]]$power.R_adjusted_SMD <- power.R_adjusted_SMD[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_adjusted_SMD <- NA
for (i in 1:12) {
  power.R.S_adjusted_SMD[i] <- mapply(error_S, mu=effect.R_adjusted_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coSMDesponding dataset
for (i in 1:12) {
  dat_list_adjusted_SMD[[i]]$power.R.S_adjusted_SMD <- power.R.S_adjusted_SMD[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_adjusted_SMD <- NA
for (i in 1:12) {
  power.R.M_adjusted_SMD[i] <- mapply(error_M, mu=effect.R_adjusted_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R.M_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.R.M_adjusted_SMD <- power.R.M_adjusted_SMD[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_adjusted_SMD <- NA
for (i in 1:12) {
  power.R.M2_adjusted_SMD[i] <- mapply(error_M2, mu=effect.R_adjusted_SMD[[i]], se=sqrt(SMD[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDesponding dataset
for (i in 1:length(power.R.M2_adjusted_SMD)) {
  dat_list_adjusted_SMD[[i]]$power.R.M2_adjusted_SMD <- power.R.M2_adjusted_SMD[[i]]
}





#****************************************************************#
#------------------------------SMDH-----------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#

# SMDH
power.F_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F_adjusted_SMDH[i] <- power.individual_Shinichi(mu=rep(model_list_adjusted_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.F_adjusted_SMDH <- power.F_adjusted_SMDH[[i]]
}


#---------------------- (2) type S error -----------------------#
power.F.S_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.S_adjusted_SMDH[i] <- mapply(error_S,mu=rep(model_list_adjusted_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.S_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.F.S_adjusted_SMDH <- power.F.S_adjusted_SMDH[[i]]
}



#---------------- (3) type M error (relative error) --------------#
power.F.M_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.M_adjusted_SMDH[i] <-mapply(error_M,mu=rep(model_list_adjusted_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.F.M_adjusted_SMDH <- power.F.M_adjusted_SMDH[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.F.M2_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  power.F.M2_adjusted_SMDH[i] <-mapply(error_M2,mu=rep(model_list_adjusted_SMDH[[i]]$beta, length(SMDH[[i]]$vi)), se=sqrt(SMDH[[i]]$vi)) %>% list()}

# allocate each set of power into corresponding dataset
for (i in 1:length(power.F.M2_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.F.M2_adjusted_SMDH <- power.F.M2_adjusted_SMDH[[i]]
}


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

# use effects without random effects as true effect sizes for each individual study, to calculate power for each individual study
# This is what Helmut suggest to do, to account for random effects of each study

# get best linear unbiased estimate (only random effect) - this contains two components random effect respectively, i.e. list(~1|Study, ~1|Unit_ID)
blups.list_adjusted_SMDH <- NA
for (i in 1:length(model_list_adjusted_SMDH)) {
  blups.list_adjusted_SMDH[i] <- ranef(model_list_adjusted_SMDH[[i]]) %>% list()
}

# get study index - match two components of random effect
index.list_adjusted_SMDH <- NA # list()
for (i in 1:length(model_list_adjusted_SMDH)) {
  index.list_adjusted_SMDH[i] <- match(as.character(SMDH[[i]]$Study),rownames(blups.list_adjusted_SMDH[[i]]$Study)) %>% list()
}

# effects geting rid of random effects
effect.R_adjusted_SMDH <-NA
for (i in 1:length(model_list_adjusted_SMDH)) {
  effect.R_adjusted_SMDH[i] <- mapply(sum, model_list_adjusted_SMDH[[i]]$beta,  blups.list_adjusted_SMDH[[i]]$Study[index.list_adjusted_SMDH[[i]],1], blups.list_adjusted_SMDH[[i]]$Unit_ID[,1]) %>% list()
} # change into model_est_adjusted_SMDH$mu_SMDH[i]


#--------------------- (1) two tailed power ---------------------#
power.R_adjusted_SMDH <- NA
for (i in 1:length(dat_list_adjusted_SMD)) {
  power.R_adjusted_SMDH[i] <- power.individual_Shinichi(mu=effect.R_adjusted_SMDH[[i]], se=sqrt(SMDH[[i]]$vi)) %>% list()}

# plot(power_adjusted_SMDH[[1]]-power_adjusted_SMDH2[[1]]) - check discrepancy
# allocate each set of power into corresponding dataset
for (i in 1:length(power.R_adjusted_SMD)) {
  dat_list_adjusted_SMDH[[i]]$power.R_adjusted_SMDH <- power.R_adjusted_SMDH[[i]]
} 

# Note that meta-analytic model only has one predicted/fitted value - fixed effect. While Meta-regression's fitted values are dependent on the level of moderator (i.e. independent variable)

#---------------------- (2) type S error -----------------------#
power.R.S_adjusted_SMDH <- NA
for (i in 1:12) {
  power.R.S_adjusted_SMDH[i] <- mapply(error_S, mu=effect.R_adjusted_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05) %>% list()
}

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.S_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.R.S_adjusted_SMDH <- power.R.S_adjusted_SMDH[[i]]
}


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_adjusted_SMDH <- NA
for (i in 1:12) {
  power.R.M_adjusted_SMDH[i] <- mapply(error_M, mu=effect.R_adjusted_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.M_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.R.M_adjusted_SMDH <- power.R.M_adjusted_SMDH[[i]]
}


#---------------- (4) type M error (relative error) --------------#
power.R.M2_adjusted_SMDH <- NA
for (i in 1:12) {
  power.R.M2_adjusted_SMDH[i] <- mapply(error_M2, mu=effect.R_adjusted_SMDH[[i]], se=sqrt(SMDH[[i]]$vi), alpha=0.05, N=10000) %>% list()
}  

# allocate each set of power into coSMDHesponding dataset
for (i in 1:length(power.R.M2_adjusted_SMDH)) {
  dat_list_adjusted_SMDH[[i]]$power.R.M2_adjusted_SMDH <- power.R.M2_adjusted_SMDH[[i]]
}






#*********************************************************************#
#----------- summary of empirical power for each approach ------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F_adjusted_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.S_adjusted_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M_adjusted_SMD))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.F.M2_adjusted_SMD))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R_adjusted_SMD))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.S_adjusted_SMD))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M_adjusted_SMD))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_adjusted_SMD <- data.frame(MA_case=model_est_adjusted_SMD$MA_case,
                   Minimum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[1,],      
                   `First quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[2,],
                   Median=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[3,],
                   Mean=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[4,], 
                   `Third quarter`=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[5,], 
                   Maximum=mapply(summary, sapply(dat_list_adjusted_SMD, function(x) x$power.R.M2_adjusted_SMD))[6,]) 





#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.F_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F_adjusted_SMDH))[6,]) 


#---------------------- (2) type S error -----------------------#
power.F.S_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.S_adjusted_SMDH))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.F.M_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.M_adjusted_SMDH))[6,])


#---------------- (4) type M error (relative error) --------------#
power.F.M2_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.F.M2_adjusted_SMDH))[6,])



#----------------------------------------------------------------#
#     (ii) effect size specific effect as true effect  
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
power.R_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R_adjusted_SMDH))[6,]) 


#---------------------- (2) type S error -----------------------#
power.R.S_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.S_adjusted_SMDH))[6,]) 


#-------------- (3) type M error (overestimate ratio) -------------#
power.R.M_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.M_adjusted_SMDH))[6,]) 



#---------------- (4) type M error (relative error) --------------#
power.R.M2_summary_adjusted_SMDH <- data.frame(MA_case=model_est_adjusted_SMDH$MA_case,
                   Minimum=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[1,],      
                   `First quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[2,],
                   Median=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[3,],
                   Mean=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[4,], 
                   `Third quarter`=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[5,], 
                   Maximum=mapply(summary, sapply(SMDH, function(x) x$power.R.M2_adjusted_SMDH))[6,]) 






#*********************************************************************#
#--------- calculate standard error for each type of power -----------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_adjusted_SMD
se.F_mean <- NA
for (i in 1:length(SMD)) {
  se.F_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.F_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.F_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.F_adjusted_SMD)]))
}

power.F_summary_adjusted_SMD$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_adjusted_SMD
se.F.S_mean <- NA
for (i in 1:length(SMD)) {
  se.F.S_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.F.S_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.F.S_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.F.S_adjusted_SMD)]))
}

power.F.S_summary_adjusted_SMD$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_adjusted_SMD
se.F.M_mean <- NA
for (i in 1:length(SMD)) {
  se.F.M_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.F.M_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.F.M_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.F.M_adjusted_SMD)]))
}

power.F.M_summary_adjusted_SMD$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(SMD)) {
  se.F.M2_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.F.M2_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.F.M2_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.F.M2_adjusted_SMD)]))
}

power.F.M2_summary_adjusted_SMD$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_adjusted_SMD
se.R_mean <- NA
for (i in 1:length(SMD)) {
  se.R_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.R_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.R_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.R_adjusted_SMD)]))
}

power.R_summary_adjusted_SMD$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_adjusted_SMD
se.R.S_mean <- NA
for (i in 1:length(SMD)) {
  se.R.S_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.R.S_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.R.S_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.R.S_adjusted_SMD)]))
}

power.R.S_summary_adjusted_SMD$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_adjusted_SMD
se.R.M_mean <- NA
for (i in 1:length(SMD)) {
  se.R.M_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.R.M_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.R.M_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.R.M_adjusted_SMD)]))
}

power.R.M_summary_adjusted_SMD$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(SMD)) {
  se.R.M2_mean[i] <- sd(dat_list_adjusted_SMD[[i]]$power.R.M2_adjusted_SMD, na.rm=TRUE) / sqrt(length(dat_list_adjusted_SMD[[i]]$power.R.M2_adjusted_SMD[!is.na(dat_list_adjusted_SMD[[i]]$power.R.M2_adjusted_SMD)]))
}

power.R.M2_summary_adjusted_SMD$se.R.M2_mean <- se.R.M2_mean







#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.F_adjusted_SMDH
se.F_mean <- NA
for (i in 1:length(SMDH)) {
  se.F_mean[i] <- sd(SMDH[[i]]$power.F_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F_adjusted_SMDH[!is.na(SMDH[[i]]$power.F_adjusted_SMDH)]))
}

power.F_summary_adjusted_SMDH$se.F_mean <- se.F_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.F.S_adjusted_SMDH
se.F.S_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.S_mean[i] <- sd(SMDH[[i]]$power.F.S_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.S_adjusted_SMDH[!is.na(SMDH[[i]]$power.F.S_adjusted_SMDH)]))
}

power.F.S_summary_adjusted_SMDH$se.F.S_mean <- se.F.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.F.M_adjusted_SMDH
se.F.M_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.M_mean[i] <- sd(SMDH[[i]]$power.F.M_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.M_adjusted_SMDH[!is.na(SMDH[[i]]$power.F.M_adjusted_SMDH)]))
}

power.F.M_summary_adjusted_SMDH$se.F.M_mean <- se.F.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.F.M2_RR
se.F.M2_mean <- NA
for (i in 1:length(SMDH)) {
  se.F.M2_mean[i] <- sd(SMDH[[i]]$power.F.M2_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.F.M2_adjusted_SMDH[!is.na(SMDH[[i]]$power.F.M2_adjusted_SMDH)]))
}

power.F.M2_summary_adjusted_SMDH$se.F.M2_mean <- se.F.M2_mean


#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#

#--------------------- (1) two tailed power ---------------------#
# standard error of variable power.R_adjusted_SMDH
se.R_mean <- NA
for (i in 1:length(SMDH)) {
  se.R_mean[i] <- sd(SMDH[[i]]$power.R_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R_adjusted_SMDH[!is.na(SMDH[[i]]$power.R_adjusted_SMDH)]))
}

power.R_summary_adjusted_SMDH$se.R_mean <- se.R_mean


#---------------------- (2) type S error -----------------------#
# standard error of variable power.R.S_adjusted_SMDH
se.R.S_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.S_mean[i] <- sd(SMDH[[i]]$power.R.S_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.S_adjusted_SMDH[!is.na(SMDH[[i]]$power.R.S_adjusted_SMDH)]))
}

power.R.S_summary_adjusted_SMDH$se.R.S_mean <- se.R.S_mean



#-------------- (3) type M error (overestimate ratio) -------------#
# standard error of variable power.R.M_adjusted_SMDH
se.R.M_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.M_mean[i] <- sd(SMDH[[i]]$power.R.M_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.M_adjusted_SMDH[!is.na(SMDH[[i]]$power.R.M_adjusted_SMDH)]))
}

power.R.M_summary_adjusted_SMDH$se.R.M_mean <- se.R.M_mean


#---------------- (4) type M error (relative error) --------------#
# standard error of variable power.R.M2_RR
se.R.M2_mean <- NA
for (i in 1:length(SMDH)) {
  se.R.M2_mean[i] <- sd(SMDH[[i]]$power.R.M2_adjusted_SMDH, na.rm=TRUE) / sqrt(length(SMDH[[i]]$power.R.M2_adjusted_SMDH[!is.na(SMDH[[i]]$power.R.M2_adjusted_SMDH)]))
}

power.R.M2_summary_adjusted_SMDH$se.R.M2_mean <- se.R.M2_mean






#*********************************************************************#
#-------------------- meta-meta-analysis on power --------------------#
#*********************************************************************#

#****************************************************************#
#-----------------------------SMD------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#

# add study ID

# add N and k
N_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  N_adjusted_SMD[i] <- SMD[[i]]$Unit_ID %>% length()
}

k_adjusted_SMD <- NA
for (i in 1:length(SMD)) {
  k_adjusted_SMD[i] <- SMD[[i]]$Study %>% length()
}

power.F_summary_adjusted_SMD$N <- N_adjusted_SMD
power.F_summary_adjusted_SMD$k <- k_adjusted_SMD



approach_adjusted_SMD <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_adjusted_SMD <- c("Pr","Pr", "Pr","Pr", "Pr", "Pr","Pr","Pr","Pr","Pr", "Pr", "Pr")

stressor_adjusted_SMD <- c("BD_loss","BD_loss", "Fert", "Fert", "Fert", "LUC","LUC","LUC","LUC","LUC", "LUC", "Inv")

stressor_adjusted_SMD %>% as.data.frame() # check the correctness


moderator_adjusted_SMD <- cbind(approach_adjusted_SMD,treatment_adjusted_SMD,stressor_adjusted_SMD)

power.F_summary_adjusted_SMD <- cbind(power.F_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F_adjusted_SMD.approach <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_adjusted_SMD.stressor <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t")) 

MMA_power.F_adjusted_SMD <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_adjusted_SMD <- cbind(power.F.S_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F.S_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F.S_adjusted_SMD.approach <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_adjusted_SMD.stressor <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t"))

MMA_power.F.S_adjusted_SMD <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_adjusted_SMD <- cbind(power.F.M_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F.M_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F.M_adjusted_SMD.approach <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_adjusted_SMD.stressor <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t"))

MMA_power.F.M_adjusted_SMD <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_adjusted_SMD <- with(power.F.M2_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#
power.F_summary_adjusted_SMD <- cbind(power.F_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F_adjusted_SMD.approach <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_adjusted_SMD.stressor <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t")) 

MMA_power.F_adjusted_SMD <- with(power.F_summary_adjusted_SMD, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_adjusted_SMD <- cbind(power.F.S_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F.S_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F.S_adjusted_SMD.approach <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_adjusted_SMD.stressor <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.S_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t"))

MMA_power.F.S_adjusted_SMD <- with(power.F.S_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_adjusted_SMD <- cbind(power.F.M_summary_adjusted_SMD, moderator_adjusted_SMD)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_adjusted_SMD$approach_adjusted_SMD <- factor(power.F.M_summary_adjusted_SMD$approach_adjusted_SMD, levels=c("O", "E"))

MMA_power.F.M_adjusted_SMD.approach <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M_mean,  mods = ~ I(approach_adjusted_SMD) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_adjusted_SMD.stressor <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M_mean,  mods = ~ I(stressor_adjusted_SMD) -1, method = "REML", test = "t"))

MMA_power.F.M_adjusted_SMD <- with(power.F.M_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_adjusted_SMD <- with(power.F.M2_summary_adjusted_SMD, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#****************************************************************#
#-----------------------------SMDH-------------------------------#
#****************************************************************#

#----------------------------------------------------------------#
#           (i) intercept (overall mean) as true effect
#----------------------------------------------------------------#
# add study ID

# add N and k
N_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  N_adjusted_SMDH[i] <- SMDH[[i]]$Unit_ID %>% length()
}

k_adjusted_SMDH <- NA
for (i in 1:length(SMDH)) {
  k_adjusted_SMDH[i] <- SMDH[[i]]$Study %>% length()
}

power.F_summary_adjusted_SMDH$N <- N_adjusted_SMDH
power.F_summary_adjusted_SMDH$k <- k_adjusted_SMDH



approach_adjusted_SMDH <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

treatment_adjusted_SMDH <- c("E", "E", "E", "E", "E", "O", "O", "O", "O", "O", "O", "O")

moderator_adjusted_SMDH <- cbind(approach_adjusted_SMDH,treatment_adjusted_SMDH)

power.F_summary_adjusted_SMDH <- cbind(power.F_summary_adjusted_SMDH, moderator_adjusted_SMDH)

# convert moderator to factor with desired ordering of levels
power.F_summary_adjusted_SMDH$approach_adjusted_SMDH <- factor(power.F_summary_adjusted_SMDH$approach_adjusted_SMDH, levels=c("O", "E"))

MMA_power.F_adjusted_SMDH.approach <- with(power.F_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F_adjusted_SMDH <- with(power.F_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F_mean,   method = "REML", test = "t"))



power.F.S_summary_adjusted_SMDH <- cbind(power.F.S_summary_adjusted_SMDH, moderator_adjusted_SMDH)

# convert moderator to factor with desired ordering of levels
power.F.S_summary_adjusted_SMDH$approach_adjusted_SMDH <- factor(power.F.S_summary_adjusted_SMDH$approach_adjusted_SMDH, levels=c("O", "E"))

MMA_power.F.S_adjusted_SMDH.approach <- with(power.F.S_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.S_adjusted_SMDH <- with(power.F.S_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F.S_mean,   method = "REML", test = "t"))




power.F.M_summary_adjusted_SMDH <- cbind(power.F.M_summary_adjusted_SMDH, moderator_adjusted_SMDH)

# convert moderator to factor with desired ordering of levels
power.F.M_summary_adjusted_SMDH$approach_adjusted_SMDH <- factor(power.F.M_summary_adjusted_SMDH$approach_adjusted_SMDH, levels=c("O", "E"))

MMA_power.F.M_adjusted_SMDH.approach <- with(power.F.M_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F_mean,  mods = ~ I(approach_adjusted_SMDH) -1, method = "REML", test = "t")) # relevel(approach, ref="O")

MMA_power.F.M_adjusted_SMDH <- with(power.F.M_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F.M_mean,   method = "REML", test = "t"))

MMA_power.F.M2_adjusted_SMDH <- with(power.F.M2_summary_adjusted_SMDH, rma(yi = Mean, sei = se.F.M2_mean,   method = "REML", test = "t"))




#----------------------------------------------------------------#
#                 (ii) effect size specific effect as true effect
#----------------------------------------------------------------#
MMA_power.R_adjusted_SMDH <- with(power.R_summary_adjusted_SMDH, rma(yi = Mean, sei = se.R_mean,   method = "REML", test = "t"))

MMA_power.R.S_adjusted_SMDH <- with(power.R.S_summary_adjusted_SMDH, rma(yi = Mean, sei = se.R.S_mean,   method = "REML", test = "t"))

MMA_power.R.M_adjusted_SMDH <- with(power.R.M_summary_adjusted_SMDH, rma(yi = Mean, sei = se.R.M_mean,   method = "REML", test = "t"))

MMA_power.R.M2_adjusted_SMDH <- with(power.R.M2_summary_adjusted_SMDH, rma(yi = Mean, sei = se.R.M2_mean,   method = "REML", test = "t"))



```












### adjusted for SMD & SMDH

```{r}

#***************************************************************#
#                       PET-PEESE approach                      #
#***************************************************************#

#----------------------------------------------------------------#
#              first-stage: using PET to model SE                #
#----------------------------------------------------------------#


# creating a varible for the "effective sample size" to account for unbalanced sampling, for SMD and lnRR (esz, hereafter, see Equation 25 from the main manuscript)
# function to calculate effective sample size and corresponding sampling variance
esz <- function(dat){(4*dat$C_N*dat$T_N) / (dat$C_N + dat$T_N)}
esz.var <- function(dat){ 1/dat$C_N + 1/dat$T_N}

# SMD
esz_SMD <- NA
for (i in 1:length(SMD)) {
  esz_SMD[i] <- esz(SMD[[i]]) %>% list()}

# allocate each set of effective sample size into corresponding dataset
for (i in 1:length(SMD)) {
  SMD[[i]]$esz_SMD <- esz_SMD[[i]]
}


# creating "effective sample size" based "sampling variance" (see Equation 26)
esz.var_SMD <- NA
for (i in 1:length(SMD)) {
  esz.var_SMD[i] <- esz.var(SMD[[i]]) %>% list()}

# allocate each set of effective sample size into corresponding dataset
for (i in 1:length(SMD)) {
  SMD[[i]]$esz.var_SMD <- esz.var_SMD[[i]]
}


# fit model
model_list_PET_PEESE_SMD.sei <- list() # rep(NA, length(dat_list))
for (i in 1:length(SMD)) {
 model_list_PET_PEESE_SMD.sei[i] <- rma.mv(data = SMD[[i]], yi = yi, V = vi, mods = ~ sqrt(esz.var_SMD),random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}


model_est_PET_PEESE_SMD.sei.intercept <- data.frame(MA_case=model_est_SMD$MA_case,
                  mu_SMD=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$beta[1]),
                  SE_SMD=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$se[1]),
                  ll_NHST=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$ci.lb[1]),
                  ul_NHST=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$ci.ub[1]),
                  p_value=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$pval)[c(seq(1,24,2))]) # odd columns for intercept's p-value


model_est_PET_PEESE_SMD.sei.slope <- data.frame(MA_case=model_est_SMD$MA_case,
                  mu_SMD=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$beta[2]),
                  SE_SMD=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$se[2]),
                  ll_NHST=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$ci.lb[2]),
                  ul_NHST=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$ci.ub[2]),
                  p_value=sapply(model_list_PET_PEESE_SMD.sei, function(x) x$pval)[c(seq(2,24,2))]) # even columns for slope's p-value



#----------------------------------------------------------------#
#           second-stage: using PEESE to model variance          #
#----------------------------------------------------------------#


model_list_PET_PEESE_SMD.var <- list() 
for (i in 1:12) {
 model_list_PET_PEESE_SMD.var[i] <- rma.mv(data = SMD[[i]], yi = yi, V = vi, mods = ~ esz.var_SMD,random = list(~1|Study, ~1|Unit_ID), method = "REML", test = "t") %>% list()
}



model_est_PET_PEESE_SMD.var.intercept <- data.frame(MA_case=model_est_SMD$MA_case,
                  mu_SMD=sapply(model_list_PET_PEESE_SMD.var, function(x) x$beta[1]),
                  SE_SMD=sapply(model_list_PET_PEESE_SMD.var, function(x) x$se[1]),
                  ll_NHST=sapply(model_list_PET_PEESE_SMD.var, function(x) x$ci.lb[1]),
                  ul_NHST=sapply(model_list_PET_PEESE_SMD.var, function(x) x$ci.ub[1]),
                  p_value=sapply(model_list_PET_PEESE_SMD.var, function(x) x$pval)[c(seq(1,24,2))]) # odd columns for intercept's p-value





model_est_PET_PEESE_SMD.var.slope <- data.frame(MA_case=model_est_SMD$MA_case,
                  mu_SMD=sapply(model_list_PET_PEESE_SMD.var, function(x) x$beta[2]),
                  SE_SMD=sapply(model_list_PET_PEESE_SMD.var, function(x) x$se[2]),
                  ll_NHST=sapply(model_list_PET_PEESE_SMD.var, function(x) x$ci.lb[2]),
                  ul_NHST=sapply(model_list_PET_PEESE_SMD.var, function(x) x$ci.ub[2]),
                  p_value=sapply(model_list_PET_PEESE_SMD.var, function(x) x$pval)[c(seq(2,24,2))]) # odd columns for slope's p-value




# using PET’s intercept (se as moderator) when slope is not sig but PEEESE’s intercept (variance or se^2 as moderator) if PET’s slope is sig

model_est_PET_PEESE_SMD.sei.intercept$id <- c(1:12)
model_est_PET_PEESE_SMD.sei.slope$id <- c(1:12)
model_est_PET_PEESE_SMD.var.intercept$id <- c(1:12)
model_est_PET_PEESE_SMD.var.slope$id <- c(1:12)


model_est_PET_PEESE_SMD.sei.slope.sig <- model_est_PET_PEESE_SMD.sei.slope %>% subset(p_value < 0.05) 

model_est_PET_PEESE_SMD.sei.slope.nonsig <- model_est_PET_PEESE_SMD.sei.slope %>% subset(p_value > 0.05)

# get location of PET's sig slope and non-sig slope, respectively
location.sig <- which(model_est_PET_PEESE_SMD.sei.slope$p_value < 0.05)
location.nonsig <- which(model_est_PET_PEESE_SMD.sei.slope$p_value > 0.05)


# get the intercpet from PEESE (when PET’s slope is sig) and PET (when PET’s slope is nonsig)

model_est_PET_PEESE_SMD <- rbind(model_est_PET_PEESE_SMD.sei.intercept[location.nonsig,],model_est_PET_PEESE_SMD.var.intercept[location.sig,]) 

model_est_PET_PEESE_SMD <- model_est_PET_PEESE_SMD[order(model_est_PET_PEESE_SMD$id),] # reorder according to the sequences of meta-analyses


# obtain absolute value
model_est_PET_PEESE_SMD2 <- model_est_PET_PEESE_SMD
model_est_PET_PEESE_SMD2$mu_SMD <- abs(model_est_PET_PEESE_SMD$mu_SMD)

model_est_SMD2 <- model_est_SMD
model_est_SMD2$mu_SMD <- abs(model_est_SMD$mu_SMD)



# creat a table for paired comparision of naive estimate (i.e., meta-analytic intercept) and bias-coSMDected estimate (i.e., PET-PEESE)

# estimate <- c(rep('Naive', 15), rep('PET-PEESE', 15))
dummy <- rep("Dummy", 12)

wide.data <- 
  tibble::tibble(
    Naive = model_est_SMD2$mu_SMD,
    `PET-PEESE` = model_est_PET_PEESE_SMD2$mu_SMD,
    Dummy = dummy, ID = 1:12, MA_case = model_est_PET_PEESE_SMD2$MA_case)


my.data   <- 
  wide.data %>%
  tidyr::gather(key = Group, value = Measurement, -ID, -Dummy, -MA_case)


two.group.paired <- 
  my.data %>%
  dabest(Group, Measurement, 
         idx = c("Naive", "PET-PEESE"), 
         paired = TRUE, id.col = ID)

paired.plot.SMD <- two.group.paired %>% 
  mean_diff() %>% 
  plot(#rawplot.ylim = c(-2, 1),
       #effsize.ylim = c(-2, 1),
       #rawplot.markersize = 1,
       #rawplot.groupwidth = 0.4,
      rawplot.ylabel = "Meta-analytic estimate (SMD)",
      effsize.ylabel = "Mean differences (bootstrap resampling)",
      axes.title.fontsize = 14, # default is 14
      palette = c("Dark2")
      )


png(filename = "./Figures/paired.plot.SMD.png", width = 5, height = 4, units = "in", type = "windows", res = 400)
paired.plot.SMD
dev.off()




include.point <- which((wide.data$`PET-PEESE` - wide.data$Naive)<0)

wide.data3 <- wide.data[include.point,]


my.data3 <- 
  wide.data3 %>%
  tidyr::gather(key = Group, value = Measurement, -ID, -Dummy, -MA_case)


two.group.paired3 <- 
  my.data3 %>%
  dabest(Group, Measurement, 
         idx = c("Naive", "PET-PEESE"), 
         paired = TRUE, id.col = ID)

paired.plot3_SMD <- two.group.paired3 %>% 
  mean_diff() %>% 
  plot(#rawplot.ylim = c(-2, 1),
       #effsize.ylim = c(-2, 1),
       #rawplot.markersize = 1,
       #rawplot.groupwidth = 0.4,
      rawplot.ylabel = "Meta-analytic estimate (SMD)",
      effsize.ylabel = "Mean differences (bootstrap resampling)",
      axes.title.fontsize = 14, # default is 14
      palette = c("Dark2")
      )


png(filename = "./Figures/paired.plot3_SMD.png", width = 5, height = 4, units = "in", type = "windows", res = 400)
paired.plot3_SMD
dev.off()



```












### adjusted SMD datasets
```{r}

model_list_SMD
model_list_PET_PEESE_SMD.sei 
model_list_PET_PEESE_SMD.var1_25
model_list_PET_PEESE_SMD.var27_30

# using estimates from model_est_PET_PEESE_SMD if in a correct direction of slope. Otherwise it should use estimates from  model_est_SMD. That is my.data3

model_est_adjusted_SMD <- data.frame(MA_case=model_est_PET_PEESE_SMD$MA_case,
                    mu_SMD=c(model_est_PET_PEESE_SMD$mu_SMD[1],
                             model_est_SMD$mu_SMD[2],
                             model_est_PET_PEESE_SMD$mu_SMD[3],
                             model_est_PET_PEESE_SMD$mu_SMD[4],
                             model_est_SMD$mu_SMD[5],
                             model_est_SMD$mu_SMD[6],
                             model_est_SMD$mu_SMD[7],
                             model_est_SMD$mu_SMD[8],
                             model_est_SMD$mu_SMD[9],
                             model_est_SMD$mu_SMD[10],
                             model_est_PET_PEESE_SMD$mu_SMD[11],
                             model_est_SMD$mu_SMD[12]
                            ),
                    
                    SE_SMD=c(model_est_PET_PEESE_SMD$SE_SMD[1],
                             model_est_SMD$SE_SMD[2],
                             model_est_PET_PEESE_SMD$SE_SMD[3],
                             model_est_PET_PEESE_SMD$SE_SMD[4],
                             model_est_SMD$SE_SMD[5],
                             model_est_SMD$SE_SMD[6],
                             model_est_SMD$SE_SMD[7],
                             model_est_SMD$SE_SMD[8],
                             model_est_SMD$SE_SMD[9],
                             model_est_SMD$SE_SMD[10],
                             model_est_PET_PEESE_SMD$SE_SMD[11],
                             model_est_SMD$SE_SMD[12]
                            ),
                    
                ll_NHST=c(model_est_PET_PEESE_SMD$ll_NHST[1],
                             model_est_SMD$ll_NHST[2],
                             model_est_PET_PEESE_SMD$ll_NHST[3],
                             model_est_PET_PEESE_SMD$ll_NHST[4],
                             model_est_SMD$ll_NHST[5],
                             model_est_SMD$ll_NHST[6],
                             model_est_SMD$ll_NHST[7],
                             model_est_SMD$ll_NHST[8],
                             model_est_SMD$ll_NHST[9],
                             model_est_SMD$ll_NHST[10],
                             model_est_PET_PEESE_SMD$ll_NHST[11],
                             model_est_SMD$ll_NHST[12]
                            ),
                
                  ul_NHST=c(model_est_PET_PEESE_SMD$ul_NHST[1],
                             model_est_SMD$ul_NHST[2],
                             model_est_PET_PEESE_SMD$ul_NHST[3],
                             model_est_PET_PEESE_SMD$ul_NHST[4],
                             model_est_SMD$ul_NHST[5],
                             model_est_SMD$ul_NHST[6],
                             model_est_SMD$ul_NHST[7],
                             model_est_SMD$ul_NHST[8],
                             model_est_SMD$ul_NHST[9],
                             model_est_SMD$ul_NHST[10],
                             model_est_PET_PEESE_SMD$ul_NHST[11],
                             model_est_SMD$ul_NHST[12]
                            ),
                
                  p_value=c(model_est_PET_PEESE_SMD$p_value[1],
                             model_est_SMD$p_value[2],
                             model_est_PET_PEESE_SMD$p_value[3],
                             model_est_PET_PEESE_SMD$p_value[4],
                             model_est_SMD$p_value[5],
                             model_est_SMD$p_value[6],
                             model_est_SMD$p_value[7],
                             model_est_SMD$p_value[8],
                             model_est_SMD$p_value[9],
                             model_est_SMD$p_value[10],
                             model_est_PET_PEESE_SMD$p_value[11],
                             model_est_SMD$p_value[12]
                            )) 




# get locations from model_est_PET_PEESE_SMD.sei.slope.nonsig (models from model_list_PET_PEESE_SMD.sei) and model_est_PET_PEESE_SMD.sei.slope.sig (models from model_list_PET_PEESE_SMD.var)

PET_PEESE_list_SMD <- list(model_list_PET_PEESE_SMD.sei[[1]],
                          model_list_PET_PEESE_SMD.sei[[2]],
                          model_list_PET_PEESE_SMD.sei[[3]],
                          model_list_PET_PEESE_SMD.sei[[4]],
                          model_list_PET_PEESE_SMD.sei[[5]],
                          model_list_PET_PEESE_SMD.sei[[6]],
                          model_list_PET_PEESE_SMD.sei[[7]],
                          model_list_PET_PEESE_SMD.sei[[8]],
                          model_list_PET_PEESE_SMD.sei[[9]],
                          model_list_PET_PEESE_SMD.sei[[10]],
                          model_list_PET_PEESE_SMD.var[[11]],
                          model_list_PET_PEESE_SMD.sei[[12]]
                          )



# get locations from my.data3

model_list_adjusted_SMD <- list(PET_PEESE_list_SMD[[1]],
                                model_list_SMD[[2]],
                               PET_PEESE_list_SMD[[3]],
                               PET_PEESE_list_SMD[[4]],
                               model_list_SMD[[5]],
                               model_list_SMD[[6]],
                               model_list_SMD[[7]],
                               model_list_SMD[[8]],
                               model_list_SMD[[9]],
                               model_list_SMD[[10]],
                               PET_PEESE_list_SMD[[11]],
                               model_list_SMD[[12]]
                               )

  

```









### Funnel plots - SE
```{r}
model_list_RR[[1]]$yi %>% range()
100*I2(model_list_RR[[1]])%>% round(3)
funnel.SE_ma1.1 <- funnel(model_list_RR[[1]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma1.1: ", "I"[total]^2, '=88.7%', ',',  "I"[study]^2, '=8.4%', ',', "I"[residual]^2, '=80.3%',  sep='')),
       digits = c(0,0))
funnel.SE_ma1.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma1.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma1.1
dev.off()


model_list_RR[[2]]$yi %>% range()
100*I2(model_list_RR[[2]]) %>% round(3)
funnel.SE_ma1.2 <- funnel(model_list_RR[[2]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma1.2: ", "I"[total]^2, '=48.4%', ',',  "I"[study]^2, '=33.5%', ',', "I"[residual]^2, '=14.9%',  sep='')),
       digits = c(0,0))
funnel.SE_ma1.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma1.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma1.2
dev.off()


model_list_RR[[3]]$yi %>% range()
100*I2(model_list_RR[[3]]) %>% round(3)
funnel.SE_ma2.1 <- funnel(model_list_RR[[3]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma2.1: ", "I"[total]^2, '=99.7%', ',',  "I"[study]^2, '=60.7%', ',', "I"[residual]^2, '=39.0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma2.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma2.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma2.1
dev.off()


model_list_RR[[4]]$yi %>% range()
100*I2(model_list_RR[[4]]) %>% round(3)
funnel.SE_ma2.2 <- funnel(model_list_RR[[4]], 
       yaxis = "seinv", 
       xlim = c(-5, 5),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma2.2: ", "I"[total]^2, '=99.6%', ',',  "I"[study]^2, '=58.6%', ',', "I"[residual]^2, '=41.0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma2.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma2.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma2.2
dev.off()

# all_FST <- (ggdraw(funnel.SE_ma1.1) + ggdraw(funnel.SE_ma1.2)) /(ggdraw(funnel.SE_ma2.1) + ggdraw(funnel.SE_ma2.2)) + plot_annotation(tag_levels = 'a')
model_list_RR[[5]]$yi %>% range()
100*I2(model_list_RR[[5]]) %>% round(3)
funnel.SE_ma3.1 <- funnel(model_list_RR[[5]], 
       yaxis = "seinv", 
       xlim = c(-10, 10),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma3.1: ", "I"[total]^2, '=87.2%', ',',  "I"[study]^2, '=27.1%', ',', "I"[residual]^2, '=60.1%',  sep='')),
       digits = c(0,0))
funnel.SE_ma3.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma3.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma3.1
dev.off()


model_list_RR[[6]]$yi %>% range()
100*I2(model_list_RR[[6]]) %>% round(3)
funnel.SE_ma4.1 <- funnel(model_list_RR[[6]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma4.1: ", "I"[total]^2, '=89.4%', ',',  "I"[study]^2, '=36.0%', ',', "I"[residual]^2, '=53.4%',  sep='')),
       digits = c(0,0))
funnel.SE_ma4.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma4.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma4.1
dev.off()



model_list_RR[[7]]$yi %>% range()
100*I2(model_list_RR[[7]]) %>% round(3)
funnel.SE_ma5.1 <- funnel(model_list_RR[[7]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma5.1: ", "I"[total]^2, '=99.0%', ',',  "I"[study]^2, '=64.5%', ',', "I"[residual]^2, '=34.5%',  sep='')),
       digits = c(0,0))
funnel.SE_ma5.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma5.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma5.1
dev.off()



model_list_RR[[8]]$yi %>% range()
100*I2(model_list_RR[[8]]) %>% round(3)
funnel.SE_ma6.1 <- funnel(model_list_RR[[8]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma6.1: ", "I"[total]^2, '=99.7%', ',',  "I"[study]^2, '=53.9%', ',', "I"[residual]^2, '=45.9%',  sep='')),
       digits = c(0,0))
funnel.SE_ma6.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma6.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma6.1
dev.off()



model_list_RR[[9]]$yi %>% range()
100*I2(model_list_RR[[9]]) %>% round(3)
funnel.SE_ma6.2 <- funnel(model_list_RR[[9]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma6.2: ", "I"[total]^2, '=98.07%', ',',  "I"[study]^2, '=83.7%', ',', "I"[residual]^2, '=14.3%',  sep='')),
       digits = c(0,0))
funnel.SE_ma6.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma6.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma6.2
dev.off()




model_list_RR[[10]]$yi %>% range()
100*I2(model_list_RR[[10]]) %>% round(3)
funnel.SE_ma6.3 <- funnel(model_list_RR[[10]], 
       yaxis = "seinv", 
       xlim = c(-5, 5),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma6.3: ", "I"[total]^2, '=95.8%', ',',  "I"[study]^2, '=3.3%', ',', "I"[residual]^2, '=92.5%',  sep='')),
       digits = c(0,0))
funnel.SE_ma6.3 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma6.3.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma6.3
dev.off()




model_list_RR[[11]]$yi %>% range()
100*I2(model_list_RR[[11]]) %>% round(3)
funnel.SE_ma6.4 <- funnel(model_list_RR[[11]], 
       yaxis = "seinv", 
       xlim = c(-6, 6),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma6.4: ", "I"[total]^2, '=98.6%', ',',  "I"[study]^2, '=22.3%', ',', "I"[residual]^2, '=76.3%',  sep='')),
       digits = c(0,0))
funnel.SE_ma6.4 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma6.4.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma6.4
dev.off()



model_list_RR[[12]]$yi %>% range()
100*I2(model_list_RR[[12]]) %>% round(3)
funnel.SE_ma6.5 <- funnel(model_list_RR[[12]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma6.5: ", "I"[total]^2, '=91.1%', ',',  "I"[study]^2, '=18.0%', ',', "I"[residual]^2, '=73.1%',  sep='')),
       digits = c(0,0))
funnel.SE_ma6.5 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma6.5.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma6.5
dev.off()



model_list_RR[[13]]$yi %>% range()
100*I2(model_list_RR[[13]]) %>% round(3)
funnel.SE_ma7.1 <- funnel(model_list_RR[[13]], 
       yaxis = "seinv", 
       xlim = c(-1, 1),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma7.1: ", "I"[total]^2, '=86.8%', ',',  "I"[study]^2, '=65.6%', ',', "I"[residual]^2, '=21.1%',  sep='')),
       digits = c(0,0))
funnel.SE_ma7.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma7.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma7.1
dev.off()



model_list_RR[[14]]$yi %>% range()
100*I2(model_list_RR[[14]]) %>% round(3)
funnel.SE_ma7.2 <- funnel(model_list_RR[[14]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma7.2: ", "I"[total]^2, '=54.9%', ',',  "I"[study]^2, '=30.6%', ',', "I"[residual]^2, '=24.2%',  sep='')),
       digits = c(0,0))
funnel.SE_ma7.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma7.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma7.2
dev.off()




model_list_RR[[15]]$yi %>% range()
100*I2(model_list_RR[[15]]) %>% round(3)
funnel.SE_ma8.1 <- funnel(model_list_RR[[15]], 
       yaxis = "seinv", 
       xlim = c(-1, 1),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma8.1: ", "I"[total]^2, '=97.2%', ',',  "I"[study]^2, '=78.6%', ',', "I"[residual]^2, '=18.6%',  sep='')),
       digits = c(0,0))
funnel.SE_ma8.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma8.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma8.1
dev.off()



model_list_RR[[16]]$yi %>% range()
100*I2(model_list_RR[[16]]) %>% round(3)
funnel.SE_ma9.1 <- funnel(model_list_RR[[16]], 
       yaxis = "seinv", 
       xlim = c(-5, 5),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma9.1: ", "I"[total]^2, '=99.0%', ',',  "I"[study]^2, '=38.1%', ',', "I"[residual]^2, '=61.0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma9.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma9.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma9.1
dev.off()



model_list_RR[[17]]$yi %>% range()
100*I2(model_list_RR[[17]]) %>% round(3)
funnel.SE_ma10.1 <- funnel(model_list_RR[[17]], 
       yaxis = "seinv", 
       xlim = c(-3, 3),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma10.1: ", "I"[total]^2, '=39.6%', ',',  "I"[study]^2, '=39.6%', ',', "I"[residual]^2, '=0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma10.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma10.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma10.1
dev.off()




model_list_RR[[18]]$yi %>% range()
100*I2(model_list_RR[[18]]) %>% round(3)
funnel.SE_ma11.1 <- funnel(model_list_RR[[18]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma11.1: ", "I"[total]^2, '=100.0%', ',',  "I"[study]^2, '=8.3%', ',', "I"[residual]^2, '=91.7%',  sep='')),
       digits = c(0,0))
funnel.SE_ma11.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma11.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma11.1
dev.off()





model_list_RR[[19]]$yi %>% range()
100*I2(model_list_RR[[19]]) %>% round(3)
funnel.SE_ma12.1 <- funnel(model_list_RR[[19]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma12.1: ", "I"[total]^2, '=98.3%', ',',  "I"[study]^2, '=90.0%', ',', "I"[residual]^2, '=8.4%',  sep='')),
       digits = c(0,0))
funnel.SE_ma12.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma12.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma12.1
dev.off()



model_list_RR[[20]]$yi %>% range()
100*I2(model_list_RR[[20]]) %>% round(3)
funnel.SE_ma13.1 <- funnel(model_list_RR[[20]], 
       yaxis = "seinv", 
       xlim = c(-1, 1),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma13.1: ", "I"[total]^2, '=0%', ',',  "I"[study]^2, '=0%', ',', "I"[residual]^2, '=0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma13.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma13.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma13.1
dev.off()




model_list_RR[[21]]$yi %>% range()
100*I2(model_list_RR[[21]]) %>% round(3)
funnel.SE_ma13.2 <- funnel(model_list_RR[[21]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma13.2: ", "I"[total]^2, '=0%', ',',  "I"[study]^2, '=0%', ',', "I"[residual]^2, '=0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma13.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma13.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma13.2
dev.off()




model_list_RR[[22]]$yi %>% range()
100*I2(model_list_RR[[22]]) %>% round(3)
funnel.SE_ma14.1 <- funnel(model_list_RR[[22]], 
       yaxis = "seinv", 
       xlim = c(-1, 1),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma14.1: ", "I"[total]^2, '=81%', ',',  "I"[study]^2, '=81%', ',', "I"[residual]^2, '=0%',  sep='')),
       digits = c(0,0))
funnel.SE_ma14.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma14.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma14.1
dev.off()




model_list_RR[[23]]$yi %>% range()
100*I2(model_list_RR[[23]]) %>% round(3)
funnel.SE_ma14.2 <- funnel(model_list_RR[[23]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma14.2: ", "I"[total]^2, '=89.7%', ',',  "I"[study]^2, '=44.1%', ',', "I"[residual]^2, '=45.6%',  sep='')),
       digits = c(0,0))
funnel.SE_ma14.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma14.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma14.2
dev.off()




model_list_RR[[24]]$yi %>% range()
100*I2(model_list_RR[[24]]) %>% round(3)
funnel.SE_ma14.3 <- funnel(model_list_RR[[24]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma14.3: ", "I"[total]^2, '=91.7%', ',',  "I"[study]^2, '=70.0%', ',', "I"[residual]^2, '=21.7%',  sep='')),
       digits = c(0,0))
funnel.SE_ma14.3 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma14.3.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma14.3
dev.off()




model_list_RR[[25]]$yi %>% range()
100*I2(model_list_RR[[25]]) %>% round(3)
funnel.SE_ma15.1 <- funnel(model_list_RR[[25]], 
       yaxis = "seinv", 
       xlim = c(-8, 8),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma15.1: ", "I"[total]^2, '=92.3%', ',',  "I"[study]^2, '=77.6%', ',', "I"[residual]^2, '=14.7%',  sep='')),
       digits = c(0,0))
funnel.SE_ma15.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma15.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma15.1
dev.off()



model_list_RR[[26]]$yi %>% range()
100*I2(model_list_RR[[26]]) %>% round(3)
funnel.SE_ma16.1 <- funnel(model_list_RR[[26]], 
       yaxis = "seinv", 
       xlim = c(-7, 7),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma16.1: ", "I"[total]^2, '=--%', ',',  "I"[study]^2, '=--%', ',', "I"[residual]^2, '=--%',  sep='')),
       digits = c(0,0))
funnel.SE_ma16.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma16.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma16.1
dev.off()



model_list_RR[[27]]$yi %>% range()
100*I2(model_list_RR[[27]]) %>% round(3)
funnel.SE_ma16.2 <- funnel(model_list_RR[[27]], 
       yaxis = "seinv", 
       xlim = c(-6, 6),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma16.2: ", "I"[total]^2, '=98.2%', ',',  "I"[study]^2, '=32.9%', ',', "I"[residual]^2, '=65.3%',  sep='')),
       digits = c(0,0))
funnel.SE_ma16.2 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma16.2.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma16.2
dev.off()




model_list_RR[[28]]$yi %>% range()
100*I2(model_list_RR[[28]]) %>% round(3)
funnel.SE_ma20.1 <- funnel(model_list_RR[[28]], 
       yaxis = "seinv", 
       xlim = c(-2, 2),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma20.1: ", "I"[total]^2, '=99.2%', ',',  "I"[study]^2, '=71.4%', ',', "I"[residual]^2, '=27.8%',  sep='')),
       digits = c(0,0))
funnel.SE_ma20.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma20.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma20.1
dev.off()



model_list_RR[[29]]$yi %>% range()
100*I2(model_list_RR[[29]]) %>% round(3)
funnel.SE_ma23.1 <- funnel(model_list_RR[[29]], 
       yaxis = "seinv", 
       xlim = c(-5, 5),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma23.1: ", "I"[total]^2, '=95.2%', ',',  "I"[study]^2, '=55.7%', ',', "I"[residual]^2, '=39.5%',  sep='')),
       digits = c(0,0))
funnel.SE_ma23.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma23.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma23.1
dev.off()



model_list_RR[[30]]$yi %>% range()
100*I2(model_list_RR[[30]]) %>% round(3)
funnel.SE_ma24.1 <- funnel(model_list_RR[[30]], 
       yaxis = "seinv", 
       xlim = c(-4, 4),
       level = c(90, 95, 99), 
       shade = c("white", "#CC79A7", '#56B4E9'), 
       refline = 0,  pch = 21, legend = F,
       ylab = "Precison (1/SE)", xlab = "Effect size (lnRR)", 
       main = expression(paste("ma24.1: ", "I"[total]^2, '=98.5%', ',',  "I"[study]^2, '=56.1%', ',', "I"[residual]^2, '=42.4%',  sep='')),
       digits = c(0,0))
funnel.SE_ma24.1 <- recordPlot()
png(filename = "./Figures/funnel/funnel.SE_ma24.1.png", width = 5, height = 5, units = "in", type = "windows", res = 400)
funnel.SE_ma24.1
dev.off()



#all_FST <- ggarrange(funnel.SE_ma1.1, funnel.SE_ma1.2, funnel.SE_ma2.1, funnel.SE_ma2.2, nrow = 2, ncol = 2)

#all_FST2 <- funnel.SE_ma1.1 + funnel.SE_ma1.2 + plot_layout(ncol = 2, nrow = 1)

#png(filename = "./Figures/all_FST.png", width = 10, height = 10, units = "in", type = "windows", res = 400)
#all_FST 
#dev.off()


#png(filename = "./Figures/all_FST2.png", width = 10, height = 10, units = "in", type = "windows", res = 400)
#all_FST2 
#dev.off()




  
```






```{r}

funnel(dat_list[[1]]$LRR, dat_list[[1]]$var.LRR, ni = dat_list[[1]]$Unit_ID, yaxis="ni",
       xlim = c(-3, 3),
       refline=model_list_RR[[1]]$beta, xlab = "Effect size (lnRR)")



funnel(model_list_RR[[1]], 
       yaxis = "sei", 
       xlim = c(-3, 3),
       level = c(95, 99), 
       shade = c("white", "gray55"), 
       refline = 0, legend = F, 
       ylab = "Stanard error (SE)", xlab = "Effect size (lnRR)")
legend(x = 1, y = 0, legend = c("0.01 < p < 0.05"), pch = c(15), col = c("gray55"), bty = "n")






```











### Section 3 - original version 
three weighting schemes (i.e. WAAP, PET-PEESE, http://environmentalcomputing.net/meta-analysis/) to evaluate publication bias


```{r}
#***************************************************************#
#                          WAAP approach                        #
#***************************************************************#
# In our case, my understanding is we should call WAAP as random-effects-WAAP, because we do not want to use fixed effects model
# Selecting adequately powered studies
## We only use studies with power >80% or SE < 2.8
WAAP_dat_m1_1_RR <- dat_m1_1 %>% subset(power_RR > 0.8)
WAAP_dat_m1_1_CVR <- dat_m1_1 %>% subset(power_CVR > 0.8) # none data
WAAP_dat_m1_1_VR <- dat_m1_1 %>% subset(power_VR > 0.8) # none data
# Evaluating publication using adequately powered studies
WAAP_m1_1_RR <- with(WAAP_dat_m1_1_RR, rma(yi = RR,
                                         sei = VRR,
                                         #mods = ~sqrt(VRR),
                                         random = list(~1|Study, ~1|Unit_ID),
                                         method = "REML",
                                         test = "t"))

WAAP_m1_1_RR2 <- with(WAAP_dat_m1_1_RR, rma(yi = RR,
                                         sei = VRR,
                                         mods = ~sqrt(VRR),
                                         random = list(~1|Study, ~1|Unit_ID),
                                         method = "REML",
                                         test = "t"))
#***************************************************************#
#                       PET-PEESE approach                      #
#***************************************************************#
basically if the slope is not sig, use PET but if sig, move on to PEESE

PET’s intercept when slope is not sig but PEEESE’s intercept if PET’s slope is sig


# Get precision, i.e. 1/SE
dat_m1_1$SE <- sqrt(dat_m1_1$var.LRR) # note it is SE rather than variance (V), so we should use sqrt(V)
# # PET model - specifing 1/se^2 as weights
# PET.m1_1 <- lm(RR~SE, weights = (1/SE)**2,data=dat_m1_1) # This form (OLS) reverse the intercept and slope coefficient from WLS version. Therefore, intercept from WLS version is the slope from OLS version. So we should not remove intercept (i.e. -1)
# summary(PET.m1_1) # intercept rather than slope is our expected estimate
# 
# # Or we can use two-step approach for PET
# dat_m1_1$t <- dat_m1_1$RR/sqrt(dat_m1_1$VRR)
# dat_m1_1$precision <- 1/sqrt(dat_m1_1$VRR)
# # We got same results with the above
# PET.m1_1_2 <- lm(t~precision, data=dat_m1_1)
# 
# 
# 
# # PET-PEESE model - quadratic model rather than linear model
# PET_PEESE.m1_1 <- lm(RR~VRR, weights =(1/SE)**2,data=dat_m1_1)
# summary(PET_PEESE.m1_1) 
# Or we can use meta-regression with variances (i.e. SE^2) as moderator
PET_PEESE.m1_0 <- rma(data = dat_m1_1, yi = LRR, sei = var.LRR, 
                          #mods = ~SE, # using variance rather than SE
                          random = list(~1|Study, ~1|Unit_ID),
                          method = "REML")
summary(PET_PEESE.m1_0)
PET_PEESE.m1_1 <- rma(data = dat_m1_1, yi = LRR, sei = var.LRR, 
                          mods = ~SE, # using variance rather than SE
                          random = list(~1|Study, ~1|Unit_ID),
                          method = "REML")
summary(PET_PEESE.m1_1)
PET_PEESE.m1_2 <- rma(data = dat_m1_1, yi = LRR, sei = var.LRR, 
                          mods = ~ var.LRR, # using variance rather than SE
                          random = list(~1|Study, ~1|Unit_ID),
                          method = "REML")
summary(PET_PEESE.m1_2)
# Note: I am not sure which approachs you want me to use to evaluate publication bias in this website: http://environmentalcomputing.net/meta-analysis/
#   
# Whatever, I used a regular model to evaluate publication, i.e. Egger regression test
# #***************************************************************#
#                      Egger regression test                    #
#***************************************************************#
# Egger_m1_1_RR <- with(dat_m1_1, rma(yi = RR,
#                                          sei = VRR,
#                                          mods = ~sqrt(VRR),
#                                          random = list(~1|Study, ~1|Unit_ID),
#                                          method = "REML",
#                                          test = "t"))
# 
# summary(Egger_m1_1_RR) # Note that here we should look at slope, rather than intercept, which is a distinction from PET model
# alternative model 
alternative_model <- with(dat_m1_1, rma(yi = LRR,
                                         W = 1/var.LRR,
                                         sei = var.LRR,
                                         random = list(~1|Study, ~1|Unit_ID),
                                         method = "REML"))
summary(alternative_model) 




# or we can do like this
alternative_model2 <- with(dat_m1_1, rma(yi = LRR,
                                         W = 1/sqrt(var.LRR),
                                         sei = var.LRR,
                                         mods = var.LRR,
                                         random = list(~1|Study, ~1|Unit_ID),
                                         method = "REML"))




# my way
alternative_model3 <- with(dat_m1_1, rma(yi = LRR,
                                         W = 1/sqrt(var.LRR),
                                         sei = var.LRR,
                                         mods = sqrt(var.LRR),
                                         random = list(~1|Study, ~1|Unit_ID),
                                         method = "REML"))

```










